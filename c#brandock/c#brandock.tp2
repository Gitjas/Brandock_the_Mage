BACKUP ~C#Brandock/backup~
AUTHOR ~Please post at G3 or Kerzenburgforum, refer to readme.~ 


VERSION ~v1~ 

README ~C#Brandock/readme.brandock.%LANGUAGE%.html~ ~readme.brandock.english.html~


AUTO_TRA ~C#Brandock/tra/autotra/%s~

ALWAYS

/* check for a ready SoD */

ACTION_IF ((FILE_EXISTS ~dlc/sod-dlc.zip~) OR (FILE_EXISTS ~sod-dlc.zip~)) THEN BEGIN
  FAIL @55542
END

/* unify string ref numbers */
ACTION_IF GAME_IS ~bgee~ THEN BEGIN
  OUTER_SPRINT ~eet_2~ ~~
  INCLUDE ~sodrtd/lib/g3_bgee_cpmvars.tpa~
END
ACTION_IF GAME_IS ~eet~ THEN BEGIN
  OUTER_SPRINT ~eet_2~ ~2~
  INCLUDE ~EET/other/cpmvars/eet_cpmvars.tpa~
END


/* continuous chapter for EET */

  ACTION_IF GAME_IS ~eet~ BEGIN
    OUTER_SET bg2_chapter = 12
  END ELSE BEGIN
    OUTER_SET bg2_chapter = 0
  END
  OUTER_FOR (i=1; i<=10; i=i+1) BEGIN
    OUTER_SET bg2_chapter = bg2_chapter + 1
    OUTER_SPRINT name_source ~bg2_chapter_%i%~
    OUTER_SET EVAL ~%name_source%~ = bg2_chapter
  END

/* DavidW's code for unifying the area script patching. With many thanks! */
  DEFINE_ACTION_FUNCTION extend_area_script 
    STR_VAR area=""
            top=""
            bottom=""
BEGIN
    // find the area script from the area file
    COPY_EXISTING "%area%.are" override
           READ_ASCII 0x94 script
    BUT_ONLY
    // if it doesn't exist, give it a default name
    ACTION_IF "%script%" STRING_EQUAL "" BEGIN
          OUTER_INNER_PATCH_SAVE script "%area%" BEGIN
                REPLACE_TEXTUALLY "FW" "_AR" // TUTU naming conventions
          END
		// added: assign area script if needed
          	 COPY_EXISTING "%area%.are" override
                WRITE_ASCIIE 0x94 ~%script%~ #8
    END
    // extend the script
    ACTION_IF "%top%" STRING_COMPARE "" BEGIN
        EXTEND_TOP "%script%.bcs" "%top%" EVALUATE_BUFFER
    END
    ACTION_IF "%bottom%" STRING_COMPARE "" BEGIN
       EXTEND_BOTTOM "%script%.bcs" "%bottom%" EVALUATE_BUFFER
    END
END

/* dream scripts for all games */
  INCLUDE ~c#brandock/lib/g3_dreamscript_cpmvars.tpa~ 


/* some stuff for the BG2-part to make it compatible with the BGT-notation */

  ACTION_IF GAME_IS ~bg2ee~ THEN BEGIN

    OUTER_SPRINT ~BGT_VAR~ ~False()~
    OUTER_SPRINT ~tutu_var~ ~~
    OUTER_SPRINT ~IT_IS_SOD~ ~False()~
    OUTER_SPRINT ~IT_IS_BGII~ ~~
    OUTER_SPRINT ~BG1_BEFORE_TRANSITION~ ~False()~
    OUTER_SPRINT ~AFTER_BG1_TRANSITION~ ~~

    /* BGT Chapters - this doesn't have any significance, it is only needed so the d-files compile */
    OUTER_SPRINT "tutu_prologue" "-1"
    OUTER_SPRINT "tutu_prologue_reset" "-1"
    OUTER_SPRINT "tutu_chapter_1" "-1"
    OUTER_SPRINT "tutu_chapter_2" "-1"
    OUTER_SPRINT "tutu_chapter_3" "-1"
    OUTER_SPRINT "tutu_chapter_4" "-1"
    OUTER_SPRINT "tutu_chapter_5" "-1"
    OUTER_SPRINT "tutu_chapter_6" "-1"
    OUTER_SPRINT "tutu_chapter_7" "-1"

/* NextTriggerObject not known in BGII */
    OUTER_SPRINT "NextTriggerObject_ff_camp" "False()"

    OUTER_SPRINT ~Brandock_MakeGlobalOverride~ ~ActionOverride("C#Brandock",MakeGlobalOverride())~
  END

/* this is valid for BGII and bgt */
  ACTION_IF GAME_IS ~tob~ THEN BEGIN

    OUTER_SPRINT ~BGT_VAR~ ~False()~
    OUTER_SPRINT ~tutu_var~ ~~
    OUTER_SPRINT ~IT_IS_SOD~ ~False()~
    OUTER_SPRINT ~IT_IS_BGII~ ~~ //will be overwritten for BGT below
    OUTER_SPRINT ~BG1_BEFORE_TRANSITION~ ~False()~
    OUTER_SPRINT ~AFTER_BG1_TRANSITION~ ~~

    /* BGT Chapters - this doesn't have any significance, it is only needed so the d-files compile */
    OUTER_SPRINT "tutu_prologue" "-1"
    OUTER_SPRINT "tutu_prologue_reset" "-1"
    OUTER_SPRINT "tutu_chapter_1" "-1"
    OUTER_SPRINT "tutu_chapter_2" "-1"
    OUTER_SPRINT "tutu_chapter_3" "-1"
    OUTER_SPRINT "tutu_chapter_4" "-1"
    OUTER_SPRINT "tutu_chapter_5" "-1"
    OUTER_SPRINT "tutu_chapter_6" "-1"
    OUTER_SPRINT "tutu_chapter_7" "-1"

/* NextTriggerObject not known in BGII */
    OUTER_SPRINT "NextTriggerObject_ff_camp" "False()"

    OUTER_SPRINT ~Brandock_MakeGlobalOverride~ ~ActionOverride("C#Brandock",MakeGlobal())~
  END

/* some of the variables set for "tob" need to be reset for BGT, because BGT is recognized as "tob", too */
  ACTION_IF GAME_IS ~bgt~ THEN BEGIN
    PRINT @55549
    INCLUDE ~c#brandock/lib/g3_bgt_cpmvars.tpa~ 

    OUTER_SPRINT ~eet_var~ ~~

    OUTER_SPRINT ~BG1_transition_area~ ~"c#br03"~
    OUTER_SPRINT ~BG1_transition_coord~ ~[390.250]~ 
    OUTER_SPRINT ~BG1_transition_face~ ~0~ 
    OUTER_SPRINT ~BG1_transition_value~ ~10~
    OUTER_SPRINT ~BG1_transition_script~ ~c#brand2~
    OUTER_SPRINT ~BG1_transition_dlg~ ~c#brand2~

    OUTER_SPRINT ~IT_IS_BGII~ ~Global("ENDOFBG1","GLOBAL",2)~
    OUTER_SPRINT ~BG1_BEFORE_TRANSITION~ ~GlobalLT("ENDOFBG1","GLOBAL",2)~
    OUTER_SPRINT ~AFTER_BG1_TRANSITION~ ~Global("ENDOFBG1","GLOBAL",2)~

    OUTER_SPRINT ~OHDradeelInfo~ ~C#Bandock_DradeelInfo~
    OUTER_SPRINT ~CELLDOOR~ ~c#celldoor~

    OUTER_SPRINT ~NEERA_BANTER~ ~BGEEFAKE~
    OUTER_SPRINT ~FIREBE_Bookqueststate~ ~1~
    OUTER_SPRINT ~Exit5506~ ~Exit6560~ 
    OUTER_SPRINT ~Exit2619~ ~Exit6519~
    OUTER_SPRINT ~Door5506~ ~Door6506~
    OUTER_SPRINT ~Door2619~ ~Door6519~
  END


  /* BG:EE version without SoD ---------------------- */
  ACTION_IF (GAME_IS ~bgee~ AND NOT FILE_EXISTS_IN_GAME ~bd0103.are~) THEN BEGIN
    /* Tell the player it is using bgee */
    PRINT @55550 
    OUTER_SPRINT "NextTriggerObject_ff_camp" "False()"
    OUTER_SPRINT "Brandock_MakeGlobalOverride" ~ActionOverride("C#Brandock",MakeGlobal())~
  END

/* all BG:EE with/without SoD */
  ACTION_IF (GAME_IS ~bgee~) THEN BEGIN
    INCLUDE ~c#brandock/lib/g3_bgee_cpmvars.tpa~
    OUTER_SPRINT "IMOEN_DV_SOD" "imoen"
    OUTER_SPRINT ~IT_IS_BGII~ ~False()~ 
    OUTER_SPRINT ~OHDradeelInfo~ ~OHDradeelInfo~
    OUTER_SPRINT ~FIREBE_Bookqueststate~ ~3~
    OUTER_SPRINT ~CELLDOOR~ ~CELLDOOR~
    OUTER_SPRINT ~Exit5506~ ~Exit5506~ 
    OUTER_SPRINT ~Exit2619~ ~Exit2619~ 
    OUTER_SPRINT ~Door5506~ ~Door5506~
    OUTER_SPRINT ~Door2619~ ~Door2619~
    OUTER_SPRINT ~IMOEN_DV_SOD~ ~IMOEN~

ACTION_IF (MOD_IS_INSTALLED ~c#endlessbg1.tp2~ ~14~) BEGIN
    OUTER_SPRINT ~BG1_BEFORE_TRANSITION~ ~GlobalLT("BD_PLOT","GLOBAL",41)~
    OUTER_SPRINT ~IT_IS_SOD~ ~GlobalGT("bd_plot","global",40)~
    OUTER_SPRINT ~AFTER_BG1_TRANSITION~ ~GlobalGT("bd_plot","global",40)~
END ELSE ACTION_IF (MOD_IS_INSTALLED ~transitions.tp2~ ~0~) BEGIN
    OUTER_SPRINT ~BG1_BEFORE_TRANSITION~ ~GlobalLT("BD_PLOT","GLOBAL",41)~
    OUTER_SPRINT ~IT_IS_SOD~ ~GlobalGT("bd_plot","global",40)~
    OUTER_SPRINT ~AFTER_BG1_TRANSITION~ ~GlobalGT("bd_plot","global",40)~
END ELSE BEGIN
    OUTER_SPRINT ~BG1_BEFORE_TRANSITION~ ~Global("BD_PLOT","GLOBAL",0)~
    OUTER_SPRINT ~IT_IS_SOD~ ~GlobalGT("bd_plot","global",0)~
    OUTER_SPRINT ~AFTER_BG1_TRANSITION~ ~GlobalGT("bd_plot","global",0)~
END
END

/* SoD and EET */
  ACTION_IF (GAME_IS ~bgee eet~ AND FILE_EXISTS_IN_GAME ~bd0103.are~) THEN BEGIN
    /* Tell the player it is using SoD */
    PRINT @55551 
    OUTER_SPRINT ~BG1_transition_area~ ~"BD0010"~ 
    OUTER_SPRINT ~BG1_transition_coord~ ~[608.657]~ 
    OUTER_SPRINT ~BG1_transition_face~ ~N~ 
    OUTER_SPRINT ~BG1_transition_value~ ~6~
    OUTER_SPRINT ~BG1_transition_script~ ~c#brands~
    OUTER_SPRINT ~BG1_transition_dlg~ ~c#brands~

    OUTER_SPRINT "NextTriggerObject_ff_camp" ~NextTriggerObject("ff_camp")~
    OUTER_SPRINT ~Brandock_MakeGlobalOverride~ ~ActionOverride("C#Brandock",MakeGlobalOverride())~
END

/* EET only */
  ACTION_IF GAME_IS ~eet~ THEN BEGIN
    /* Tell the player it is using eet */
    PRINT @55552
	INCLUDE ~EET/other/cpmvars/eet_cpmvars.tpa~
    OUTER_SPRINT ~IT_IS_BGII~ ~Global("ENDOFBG1","GLOBAL",2)~
    OUTER_SPRINT "IMOEN_DV_SOD" "imoen2"

    OUTER_SPRINT ~OHDradeelInfo~ ~OHDradeelInfo~
    OUTER_SPRINT ~FIREBE_Bookqueststate~ ~3~
    OUTER_SPRINT ~CELLDOOR~ ~CELLDOOR~
    OUTER_SPRINT ~Exit5506~ ~Exit5506~
    OUTER_SPRINT ~Exit2619~ ~Exit2619~ 
    OUTER_SPRINT ~Door5506~ ~Door5506~
    OUTER_SPRINT ~Door2619~ ~Door2619~
    OUTER_SPRINT ~IMOEN_DV_SOD~ ~IMOEN2~

ACTION_IF (MOD_IS_INSTALLED ~c#endlessbg1.tp2~ ~14~) BEGIN
    OUTER_SPRINT ~BG1_BEFORE_TRANSITION~ ~OR(2) Global("ENDOFBG1","GLOBAL",0) GlobalLT("BD_PLOT","GLOBAL",41)~
    OUTER_SPRINT ~IT_IS_SOD~ ~Global("ENDOFBG1","GLOBAL",1) GlobalGT("bd_plot","global",40)~
    OUTER_SPRINT ~AFTER_BG1_TRANSITION~ ~OR(2) Global("ENDOFBG1","GLOBAL",2) GlobalGT("bd_plot","global",40)~
END ELSE ACTION_IF (MOD_IS_INSTALLED ~transitions.tp2~ ~0~) BEGIN
    OUTER_SPRINT ~BG1_BEFORE_TRANSITION~ ~OR(2) Global("ENDOFBG1","GLOBAL",0) GlobalLT("BD_PLOT","GLOBAL",41)~
    OUTER_SPRINT ~AFTER_BG1_TRANSITION~ ~OR(2) Global("ENDOFBG1","GLOBAL",2) GlobalGT("bd_plot","global",40)~
    OUTER_SPRINT ~IT_IS_SOD~ ~Global("ENDOFBG1","GLOBAL",1) GlobalGT("bd_plot","global",40)~
END ELSE BEGIN
    OUTER_SPRINT ~BG1_BEFORE_TRANSITION~ ~Global("ENDOFBG1","GLOBAL",0)~
    OUTER_SPRINT ~IT_IS_SOD~ ~Global("ENDOFBG1","GLOBAL",1)~
    OUTER_SPRINT ~AFTER_BG1_TRANSITION~ ~GlobalGT("ENDOFBG1","GLOBAL",0)~
END
  END

/* Some more definitions, mainly to distinguich between classic engine / EE: */
ACTION_IF GAME_IS ~tob~ THEN BEGIN
  OUTER_SPRINT ~HASSPELL_WIZARD_DETECT_INVISIBILITY~ ~LevelGT("C#Brandock",2)~
OUTER_SPRINT ~HASSPELL_WIZARD_HASTE~ ~LevelGT("C#Brandock",4)~
OUTER_SPRINT ~HASSPELL_WIZARD_FIREBALL~ ~LevelGT("C#Brandock",4)~
OUTER_SPRINT ~HASSPELL_WIZARD_TRUE_DISPEL_MAGIC~ ~LevelGT("C#Brandock",4)~
OUTER_SPRINT ~HASSPELL_WIZARD_IMPROVED_INVISIBILITY~ ~LevelGT("C#Brandock",6)~
OUTER_SPRINT ~HASSPELL_WIZARD_MONSTER_SUMMONING_2~ ~LevelGT("C#Brandock",6)~
OUTER_SPRINT ~HASSPELL_WIZARD_PROTECTION_FROM_ACID~ ~LevelGT("C#Brandock",8)~
OUTER_SPRINT ~HASSPELL_WIZARD_PIERCE_SHIELD~ ~LevelGT("C#Brandock",15)~
  OUTER_SPRINT ~HASSPELL_WIZARD_BREACH~ ~LevelGT("C#Brandock",8)~
END

/* we make Breach not available in BG1 */
ACTION_IF GAME_IS ~bgt~ THEN BEGIN
  OUTER_SPRINT ~HASSPELL_WIZARD_BREACH~ ~LevelGT("C#Brandock",8) Global("ENDOFBG1","GLOBAL",2)~
END

/* in EE, we can check whether Brandock has the spell in his spellbook */
ACTION_IF GAME_IS ~bgee bg2ee eet~ THEN BEGIN
  OUTER_SPRINT ~HASSPELL_WIZARD_DETECT_INVISIBILITY~ ~HaveKnownSpell(WIZARD_MAGIC_MISSILE)~
  OUTER_SPRINT ~HASSPELL_WIZARD_HASTE~ ~HaveKnownSpell(WIZARD_HASTE)~
  OUTER_SPRINT ~HASSPELL_WIZARD_FIREBALL~ ~HaveKnownSpell(WIZARD_FIREBALL)~
  OUTER_SPRINT ~HASSPELL_WIZARD_TRUE_DISPEL_MAGIC~ ~HaveKnownSpell(WIZARD_TRUE_DISPEL_MAGIC)~
  OUTER_SPRINT ~HASSPELL_WIZARD_IMPROVED_INVISIBILITY~ ~HaveKnownSpell(WIZARD_IMPROVED_INVISIBILITY)~
  OUTER_SPRINT ~HASSPELL_WIZARD_MONSTER_SUMMONING_2~ ~HaveKnownSpell(WIZARD_MONSTER_SUMMONING_2)~
  OUTER_SPRINT ~HASSPELL_WIZARD_BREACH~ ~HaveKnownSpell(WIZARD_BREACH)~
  OUTER_SPRINT ~HASSPELL_WIZARD_PROTECTION_FROM_ACID~ ~HaveKnownSpell(WIZARD_PROTECTION_FROM_ACID)~
  OUTER_SPRINT ~HASSPELL_WIZARD_PIERCE_SHIELD~ ~HaveKnownSpell(WIZARD_PIERCE_SHIELD)~
END

/* extras needed for 7th party member mode */
  OUTER_SPRINT "NPCname" "Brandock"
  ACTION_IF GAME_IS ~eet bg2ee~ THEN BEGIN
    OUTER_SPRINT ~RunAwayFromNoLeaveArea~ ~RunAwayFromNoLeaveArea~
  END ELSE BEGIN
    OUTER_SPRINT ~RunAwayFromNoLeaveArea~ ~RunAwayFrom~
  END

//////////////////////////////////////////////////////////////////////
/* all following actions are only processed ONCE for the whole mod, independent of un- and reinstalling of single components */

ACTION_IF !FILE_EXISTS ~c#brandock/install/c#brandockinstall.mrk~ BEGIN
 
//CamDawgs CD_STATE_NOTVALID zum Checken der Dialogfähigkeit eines Char
//Thank you very much, CamDawg!
APPEND ~STATE.IDS~ ~0x80101FEF CD_STATE_NOTVALID~ UNLESS ~CD_STATE_NOTVALID~


/* Fake dlg state so the EE NPCs compile  */
  ACTION_IF GAME_IS ~bgt tob~ THEN BEGIN
<<<<<<<< ...inlined/bgeefake.d
BEGIN BGEEFAKE
>>>>>>>>
COMPILE ~...inlined/bgeefake.d~
  END


  /* BGT: dream scripts */
  ACTION_IF GAME_IS ~bgt~ THEN BEGIN /* BGT Versions */
      COPY_EXISTING ~pdialog.2da~ ~override~
      COUNT_2DA_ROWS 8 "cnt_row"
      FOR ( cnt=0; cnt<"%cnt_row%"; cnt=cnt+1 ) BEGIN
        READ_2DA_ENTRY "%cnt%" 0 8 "pd_name"
        PATCH_IF (("%pd_name%" STRING_COMPARE_CASE "AJANTIS")=0) BEGIN
         SET_2DA_ENTRY "%cnt%" 3 8 "AJANTD"
        END
/*
        PATCH_IF (("%pd_name%" STRING_COMPARE_CASE "%IMOEN_DV%")=0) BEGIN
         SET_2DA_ENTRY "%cnt%" 3 8 "IMOEND"
        END
*/
      END
      BUT_ONLY_IF_IT_CHANGES
  END



    /* Copies tra files into the autotra-folder (to leave the originals untouched) */
    DEFINE_ACTION_FUNCTION autotra_workaround BEGIN
      COPY ~C#Brandock/tra/english~  ~C#Brandock/tra/autotra/%LANGUAGE%~
      COPY ~C#Brandock/tra/%LANGUAGE%~  ~C#Brandock/tra/autotra/%LANGUAGE%~
    END

    LAF autotra_workaround END

  /* BG:EE - formatted texts etc. */

  ACTION_DEFINE_ARRAY fl#noconvert BEGIN setup END

  ACTION_DEFINE_ARRAY fl#reload BEGIN game journal END

    LAF HANDLE_CHARSETS
      INT_VAR
        infer_charsets = 1
      STR_VAR
        tra_path = EVAL ~C#Brandock/tra/autotra~
        noconvert_array = fl#noconvert
        reload_array = fl#reload
    END

  COPY ~c#brandock/Install/component.xx~ ~c#brandock/install/c#brandockinstall.mrk~

  END // c#brandockinstall.mrk

//reloading of tras ALWAYS:
  LOAD_TRA ~c#brandock/tra/autotra/english/game.tra~
  LOAD_TRA ~c#brandock/tra/autotra/%LANGUAGE%/game.tra~
  ACTION_IF GAME_IS ~bgee bg2ee eet~ THEN BEGIN
    LOAD_TRA ~c#brandock/tra/autotra/english/game_ee.tra~
    LOAD_TRA ~c#brandock/tra/autotra/%LANGUAGE%/game_ee.tra~
  END
  LOAD_TRA ~c#brandock/tra/autotra/english/journal.tra~
  LOAD_TRA ~c#brandock/tra/autotra/%LANGUAGE%/journal.tra~

END //ALWAYS




LANGUAGE ~English~
         ~english~   
         ~C#Brandock/tra/english/setup.tra~
         ~C#Brandock/tra/english/game.tra~
	 ~C#Brandock/tra/english/journal.tra~


LANGUAGE ~Deutsch~
         ~german~   
         ~C#Brandock/tra/german/setup.tra~
         ~C#Brandock/tra/german/game.tra~
	 ~C#Brandock/tra/german/journal.tra~



BEGIN @55540 /* ~Brandock the Mage, NPC for BG:EE, BGII:EE, EET, and BGT~ */ DESIGNATED 0
LABEL BrandockTheMage-Main
REQUIRE_PREDICATE GAME_IS ~bgt bgee bg2ee tob eet~ @55541
FORBID_COMPONENT ~EET_end.tp2~ ~0~ @55568
FORBID_COMPONENT ~EET_end.tp2~ ~1~ @55568

/* Brandock's dialogue timer */
APPEND ~gtimes.ids~ ~3600 C#BRANDOCK_TIMERLONG~ UNLESS ~C#BRANDOCK_TIMERLONG~
APPEND ~gtimes.ids~ ~1800 C#BRANDOCK_TIMERSHORT~ UNLESS ~C#BRANDOCK_TIMERSHORT~
APPEND ~gtimes.ids~ ~1500 C#BRANDOCK_TIMER_SOD~ UNLESS ~C#BRANDOCK_TIMER_SOD~
APPEND ~gtimes.ids~ ~350 C#BRANDOCK_TIMERSHORT_SOD~ UNLESS ~C#BRANDOCK_TIMERSHORT_SOD~

//Damit Imoen auch was sagen darf [taken from BGII fixpack at G3]
ACTION_IF (GAME_IS ~bgt tob bg2~ AND NOT FILE_EXISTS_IN_GAME ~cdbehbla.pro~) //makes sure the fixpack isn't already installed
 THEN BEGIN
    COPY_EXISTING ~interdia.2da~ ~override~
      SET_2DA_ENTRY 17 1 2 ~BIMOEN2~ // fixes ToB version
      BUT_ONLY_IF_IT_CHANGES
END ELSE BEGIN
  APPEND ~interdia.2da~ ~IMOEN       BIMOEN2~ // fixes SoA version
     UNLESS ~BIMOEN2~
END

/* Journal Entries for BG1 part */
ACTION_IF GAME_IS ~eet bgee~ THEN BEGIN
/* ~Brandock's Possessions~ */
  ADD_JOURNAL TITLE (@10006) @10000 @10009 USING ~C#Brandock/tra/autotra/%LANGUAGE%/journal.tra~
/* ~Brandock's Half-Ogre Troubles~ */
  ADD_JOURNAL TITLE (@10010) @10005 @10008 @10069 @10070 @10071 @10072 USING ~C#Brandock/tra/autotra/%LANGUAGE%/journal.tra~
/* ~Brandock and his Half-Ogre 'Twin'~ */
  ADD_JOURNAL TITLE (@10076) @10045 @10073 @10074 @10075 USING ~C#Brandock/tra/autotra/%LANGUAGE%/journal.tra~
/* ~A Fine Pair of Boots~ */
  ADD_JOURNAL TITLE (@10013) @10002 @10003 @10004 @10011 USING ~C#Brandock/tra/autotra/%LANGUAGE%/journal.tra~
/* ~Brandock Wants to Restore his Book~ */
  ADD_JOURNAL TITLE (@10017) @10019 @10020 @10021 @10022 @10026 @10028 @10044 @10051 @10053 @10055 @10056 @10057 USING ~C#Brandock/tra/autotra/%LANGUAGE%/journal.tra~
/* ~Increase Brandock's Lore Wisdom~ */
  ADD_JOURNAL TITLE (@10029) @10030 USING ~C#Brandock/tra/autotra/%LANGUAGE%/journal.tra~
/* ~Brandock's Scroll Scribing Skills~ */
  ADD_JOURNAL TITLE (@10007) @10012 @10050 @10054 @10062 @10063 @10064 USING ~C#Brandock/tra/autotra/%LANGUAGE%/journal.tra~
END

/* Journal Entries for SoD part */
ACTION_IF GAME_INCLUDES ~sod~ THEN BEGIN
/* ~Quarrel about a Magic Book~ */
  ADD_JOURNAL TITLE (@10082) @10077 @10083 @10084 USING ~C#Brandock/tra/autotra/%LANGUAGE%/journal.tra~
/* ~Eldom's Munition Enchantments~ */
  ADD_JOURNAL TITLE (@10086) @10085 @10087 USING ~C#Brandock/tra/autotra/%LANGUAGE%/journal.tra~
/* ~Eldom's Missing Book Page~ */
  ADD_JOURNAL TITLE (@10089) @10088 @10090 USING ~C#Brandock/tra/autotra/%LANGUAGE%/journal.tra~
END

/* Journal Entries for BGII part ## */
ACTION_IF GAME_IS ~bg2ee eet~ THEN BEGIN
  ADD_JOURNAL @10014 @10018 USING ~C#Brandock/tra/autotra/%LANGUAGE%/journal.tra~
/* ~Brandock's Half-Ogre Troubles~ */
  ADD_JOURNAL TITLE (@10010) @10071 @10072 USING ~C#Brandock/tra/autotra/%LANGUAGE%/journal.tra~
/* ~Brandock Wants to Restore his Book~ */
  ADD_JOURNAL TITLE (@10017) @10058 @10059 @10060 @10061 @10068 @10078 @10079 @10080 @10081 USING ~C#Brandock/tra/autotra/%LANGUAGE%/journal.tra~
/* ~Increase Brandock's Lore Wisdom~ */
  ADD_JOURNAL TITLE (@10029) @10023 @10024 @10031 USING ~C#Brandock/tra/autotra/%LANGUAGE%/journal.tra~
/* ~Brandock Changes the Book of Infinite Spells~ */
  ADD_JOURNAL TITLE (@10067) @10065 @10066 USING ~C#Brandock/tra/autotra/%LANGUAGE%/journal.tra~
/* Funeral for Brandock's Cousin */
  ADD_JOURNAL TITLE (@10025) @10027 @10032 USING ~C#Brandock/tra/autotra/%LANGUAGE%/journal.tra~
/* ~Brandock's Scroll Scribing Skills~ */
  ADD_JOURNAL TITLE (@10007) @10012 @10062 USING ~C#Brandock/tra/autotra/%LANGUAGE%/journal.tra~
END


/* patch dlgs into 2das */

ACTION_IF GAME_IS ~bgee~ THEN BEGIN

/* BG:EE */
APPEND ~pdialog.2da~
~C#Brandock 	C#BrandP 	C#BrandJ 	C#BrandD~
UNLESS ~C#Brandock~

APPEND ~interdia.2da~
~C#Brandock 	C#BrandB~
UNLESS ~C#Brandock~

END

/* SoD */

ACTION_IF (GAME_IS ~bgee~ AND FILE_EXISTS_IN_GAME ~bd0103.are~) THEN BEGIN
APPEND ~bddialog.2da~
~C#Brandock 	C#BrandP 	C#BrandJ 	C#BrandD~
UNLESS ~C#Brandock~

  ACTION_IF !(FILE_EXISTS_IN_GAME ~BDBANTER.2DA~) BEGIN
    COPY ~c#brandock/2da/BDBANTER.2DA~ ~override~ 
  END

  ACTION_IF (FILE_EXISTS_IN_GAME ~BDBANTER.2DA~) BEGIN
	APPEND ~bdbanter.2da~
		~C#Brandock 	C#BrandB~
	UNLESS ~C#Brandock~        
  END 

END //SoD

/* BG1:EET */

ACTION_IF GAME_IS ~eet~ THEN BEGIN
APPEND ~bgdialog.2da~
~C#Brandock 	C#BrandP 	C#BrandJ 	C#BrandD~
UNLESS ~C#Brandock~

APPEND ~bgbanter.2da~
~C#Brandock 	C#BrandB~
UNLESS ~C#Brandock~

/* SoD:EET */

APPEND ~bddialog.2da~
~C#Brandock 	C#BrandP 	C#BrandJ 	C#BrandD~
UNLESS ~C#Brandock~

APPEND ~bdbanter.2da~
~C#Brandock 	C#BrandB~
UNLESS ~C#Brandock~

END //eet

ACTION_IF GAME_INCLUDES ~sod~ THEN BEGIN
/* Create NPCs' Banter files if not present */
COPY_EXISTING ~BDBANTER.2DA~ ~%MOD_FOLDER%/install~
	COUNT_2DA_COLS cols
	COUNT_2DA_ROWS cols rows
	FOR ( row = 2 ; row < rows ; row = row + 1 ) BEGIN
		READ_2DA_ENTRY %row% 0 2 npc_dv
    	READ_2DA_ENTRY %row% 1 2 banterfile
      	INNER_ACTION BEGIN
		ACTION_IF NOT FILE_EXISTS_IN_GAME ~%banterfile%.dlg~ THEN BEGIN
		  <<<<<<<< .../banterfiles-inlined/%banterfile%.d
		  BEGIN %banterfile%
		  >>>>>>>>
		  COMPILE EVALUATE_BUFFER ~.../banterfiles-inlined/%banterfile%.d~ 
		END
      	END
	END
BUT_ONLY
END

/* BGT, BGII, BGII:EE */

ACTION_IF GAME_IS ~tob bg2ee bgt eet~ THEN BEGIN

APPEND ~pdialog.2da~
~C#Brandock 	C#BrandP 	C#BrandJ 	C#BrandD 	C#BrandP 	C#BrandJ 		C#BrandD 	C#Bran25~
UNLESS ~C#Brandock~


APPEND ~interdia.2da~
~C#Brandock 	C#BrandB      C#BrandB~
UNLESS ~C#Brandock~

END


/* general file patching */

/* give DV to cre */

/* BG1 */
ACTION_IF GAME_IS ~bgee eet bgt~ THEN BEGIN

/* Give the ogre in AR2800 (Coastway) a unique DV (possessions quest) */
COPY_EXISTING ~%tutu_scripto%GREUNSH.CRE~ ~override~
WRITE_EVALUATED_ASCII 0x280 ~OGREUNSH~ #32 // script name / DV
WRITE_EVALUATED_ASCII 0x268 ~%tutu_scriptw%TASIGHT~ #8 // Default script


COPY_EXISTING ~%tutu_var%LENDAR.CRE~ ~override~
WRITE_EVALUATED_ASCII 0x280 ~Lendarn~ #32 // script name / DV

/* doppelgangers in Candlekeep: Monk */
COPY_EXISTING ~%tutu_var%POGHM9.CRE~ ~override~
WRITE_EVALUATED_ASCII 0x280 ~POGHM9~ #32 // script name / DV

/* doppelgangers in Candlekeep: Shistal */
ACTION_IF GAME_IS ~bgt bgee~ THEN BEGIN
COPY_EXISTING ~%tutu_var%SHISTA.CRE~ ~override~
WRITE_EVALUATED_ASCII 0x280 ~Shistal~ #32 // script name / DV


END /* ~bgt bgee~ */
END /* ~bgee eet bgt~ */

/* BG2 */
/* Priest of Oghma in Temple (Docks District) */
ACTION_IF GAME_IS ~tob bg2ee eet bgt~ THEN BEGIN
COPY_EXISTING ~DOGHMA.CRE~ ~override~
WRITE_EVALUATED_ASCII 0x280 ~DOGHMA~ #32 // script name / DV

END /* BG2 */


/* general spells */

/* general spells for lore increase below */

/* scroll scribing ability */
COPY ~C#Brandock/spells/c#brscrl.spl~ ~override/c#brscrl.spl~ //should have correct name
SAY UNIDENTIFIED_DESC  @125 
SAY DESC  @125 

/* Quest: Brandock's shapeshifting: Half-Oger */
/* innate ability: polymorph into self */
COPY ~C#Brandock/spells/c#brshnf.spl~ ~override/c#brshnf.spl~ 
SAY UNIDENTIFIED_DESC  @126  
SAY DESC  @126 
/* innate ability: Shapeshift Half-Ogre */
COPY ~C#Brandock/spells/c#brshog.spl~ ~override/c#brshog.spl~
  SAY NAME1 ~Shapeshift Half-Ogre~ 
SAY UNIDENTIFIED_DESC  @127 
SAY DESC  @127 
/* grant the innate ability "c#brshog" -> shapeshift Half-ogre */
COPY ~C#Brandock/spells/c#brsh01.spl~ ~override/c#brsh01.spl~


/* .d files */

/* apply once 'BEGIN c#brandB' because I am using the same file for all games and don't know which ones will get compiled, first */

ACTION_IF GAME_IS ~bgee bgt eet tob bg2ee~ THEN BEGIN
<<<<<<<< ...inlined/begin_c#brand_dlg.d
BEGIN c#brandB
BEGIN c#brmess //Messenger, needed for BG1 and SoD
>>>>>>>>
COMPILE ~...inlined/begin_c#brand_dlg.d~
END

/* Files needed in BG1 + BG2 */
COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/c#brandP.d~
COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_bookwarning.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~

/* BG1 */
ACTION_IF GAME_IS ~bgee bgt eet~ THEN BEGIN
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/c#brando.d~
/* dialogues for main possessions quest are inside c#brandj.d */
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/c#brandj.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_bhaalreaction.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brando_banter_bg1.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/brando_banter.tra~
/* book restore quest: BG1 part */
COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_bookrestore_bg1.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
/* Candlekeep reactions */
COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_candlekeep.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
/* Lorepath: BG1 content */
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_lorepath_bg1.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~


/* Brandock and the half-ogre: BG1 part */
ACTION_IF GAME_IS ~bgee eet~ THEN BEGIN
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_shapeshifter.d~
//     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
	~C#Brandock/dialogue/brandock_shapeshifter_bg1.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
END //bgee+eet
/* BGT: Thalantyr needs extra dialogue state patching */
ACTION_IF GAME_IS ~bgt~ THEN BEGIN
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_shapeshifter_bgtadd.d~
//     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
	~C#Brandock/dialogue/brandock_shapeshifter.d~
//     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
	~C#Brandock/dialogue/brandock_shapeshifter_bg1.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
END //~bgt~


/* Reaction to Taerom, BG:EE: vial */
ACTION_IF GAME_IS ~bgee eet~ BEGIN
<<<<<<<< ...inlined/add_taerom_vial.d

I_C_T ~TAEROM~ 18 C#Brandock_Taerom_Vial
== ~c#brandj~ IF ~OR(2) InParty("C#Brandock") Global("C#BrandockJoined","GLOBAL",2) InMyArea("C#Brandock") !StateCheck("C#Brandock",CD_STATE_NOTVALID)~ THEN @2010 /* ~I am deeply impressed by your and your friend's knowledge, Master Taerom.~ */
== TAEROM IF ~OR(2) InParty("C#Brandock") Global("C#BrandockJoined","GLOBAL",2) InMyArea("C#Brandock") !StateCheck("C#Brandock",CD_STATE_NOTVALID)~ THEN @2011 /* ~It was indeed a fruitful collaboration, young man. And quite to my own advantage.~ */
END

>>>>>>>>
COMPILE EVALUATE_BUFFER ~...inlined/add_taerom_vial.d~ USING ~c#brandock/tra/autotra/%LANGUAGE%/C#BRAND_DIALOGUES.TRA~ 
END 

/* events after Sarevok is dead. BG:EE & BGT with bg1ub: %bartender% is bart8 */
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_shapeshifter_bg1_sod.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
/* Bar Tender in Elfsong Tavern will react to Brandock's presence.
BG:EE: bart8.dlg, AR/BG0705.are %EBaldursGate_ElfsongTavern_L1%
SoD: bdbart01.dlg, bd0109.are
BGT: bart11.dlg AR7705.are. with bg1ub it is bart11.dlg */
  ACTION_IF (GAME_IS ~bgee~) THEN BEGIN
    OUTER_SPRINT ~Tavernarea~ ~AR0705~
  END
  ACTION_IF (GAME_IS ~eet~) THEN BEGIN
    OUTER_SPRINT ~Tavernarea~ ~BG0705~
  END
  ACTION_IF (GAME_IS ~bgt~) THEN BEGIN
    OUTER_SPRINT ~Tavernarea~ ~AR7705~
  END

/* ee and bgt with bg1ub: bartender has bart8.dlg */
ACTION_IF FILE_EXISTS_IN_GAME ~bart8.dlg~ THEN BEGIN
  OUTER_SPRINT %bartender% ~bart8~
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_shapeshifter_bg1_sod_bartender.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
END
/* in original bgt, it is bart11 */
ACTION_IF GAME_IS ~bgt~ THEN BEGIN
  OUTER_SPRINT %bartender% ~bart11~
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_shapeshifter_bg1_sod_bartender.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
END

END //GAME_IS ~bgee bgt eet~


/* SoD (SoD specific dialogues) */
ACTION_IF (GAME_IS ~bgee eet~ AND FILE_EXISTS_IN_GAME ~bd0103.are~) THEN BEGIN
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_sod.d~ 
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_sod_reactions.d~ USING ~C#Brandock/tra/autotra/%LANGUAGE%/brandock_sod.tra~
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_sod_quest.d~ USING ~C#Brandock/tra/autotra/%LANGUAGE%/brandock_sod.tra~
/* Lorepath: SoD content */
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_lorepath_sod.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
/* Brandock and the half-ogre - SoD only part */
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_shapeshifter_sod.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
  OUTER_SPRINT %bartender% ~bdbart01~
  OUTER_SPRINT ~Tavernarea~ ~bd0109~
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_shapeshifter_bg1_sod_bartender.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
  COMPILE EVALUATE_BUFFER ~c#brandock/dialogue/brando_banter_sod.d~
END //SoD

/* BG2 */
ACTION_IF GAME_IS ~bgt eet tob bg2ee~ THEN BEGIN
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_sva_firstmeeting.d~
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_sva.d~
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_sva_sphere.d~
END
/* book restore quest: BG2 part */
ACTION_IF GAME_IS ~bgt tob bg2ee~ THEN BEGIN
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_bookrestore_bg2.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
END
ACTION_IF GAME_IS ~bgt eet tob bg2ee~ THEN BEGIN
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_bookrestore_bg2.d~
			~C#Brandock/dialogue/brandock_bookrestore_eet.d~
			
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
END
ACTION_IF GAME_IS ~bgt eet tob bg2ee~ THEN BEGIN
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brando_banter_bg2.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/brando_banter.tra~
/* Brandock and the half-ogre - BGII only part */
//##  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_shapeshifter_bg2.d~
//##     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~/* Lorepath: BG2 content */
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_lorepath_bg2.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~

/* ToB */
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_tob.d~
END //~bgt eet tob bg2ee~

/* d-files with campaign-crossovers */
/* scroll scribing quest */
ACTION_IF GAME_IS ~bgee~ THEN BEGIN
COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_scrollscribing_BG1.d~
		~C#Brandock/dialogue/brandock_scrollscribing.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
END //~bgee~
ACTION_IF GAME_IS ~bgt eet~ THEN BEGIN
COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_scrollscribing_BG1.d~
		~C#Brandock/dialogue/brandock_scrollscribing_BG2.d~
		~C#Brandock/dialogue/brandock_scrollscribing.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
END //~bgt eet~
ACTION_IF GAME_IS ~tob bg2ee~ AND NOT GAME_IS ~bgt~ THEN BEGIN
COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brandock_scrollscribing_BG2.d~
~C#Brandock/dialogue/brandock_scrollscribing.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~
END //~tob bg2ee~

/* all EE games */
ACTION_IF GAME_IS ~bgee bg2ee eet~ THEN BEGIN
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brando_dorn_conflict.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/brando_banter.tra~
END

/* BG2 EE games */
ACTION_IF GAME_IS ~bg2ee eet~ THEN BEGIN
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/brando_hexxat_conflict.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/brando_banter.tra~
END

/* BGT specific */
ACTION_IF GAME_IS ~bgt~ THEN BEGIN
/* BGT: add "Dradeel told his story" check variable - C#Bandock_DradeelInfo */
	<<<<<<<< ...inlined/c#brando_bg1_add.d
	ADD_TRANS_ACTION ~%tutu_var%DRADEE~ BEGIN 21 END BEGIN END ~SetGlobal("C#Bandock_DradeelInfo","GLOBAL",1)~
	>>>>>>>>
	COMPILE EVALUATE_BUFFER ~...inlined/c#brando_bg1_add.d~
END //bgt


/* other d-files */

/* BGII */
ACTION_IF GAME_IS ~tob eet bg2ee bgt~ THEN BEGIN
/* conversable books */
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/c#brbok1.d~
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/c#brbok2.d~
END //~tob eet bg2ee bgt~



/* general .baf files */

/* Brandock's dream script (triggers upon resting) */
COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brandd.baf~

/* Also add to player1d.bcs so it also works for "familiar Brandock" */
EXTEND_BOTTOM ~player1d.bcs~   ~C#Brandock/scripts/c#brandd_player1.baf~
EVALUATE_BUFFER 

/* general scripts for BG1 part */
ACTION_IF GAME_IS ~bgee bgt eet~ THEN BEGIN
	COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brando.baf~
  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/scripts/c#brando_bg1.baf~ EVALUATE_BUFFER
/* lorepath: BG1 content */
  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/scripts/c#brando_bg1_lorepath.baf~ EVALUATE_BUFFER
  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/scripts/c#brando_bg1_cursedscrolls.baf~ EVALUATE_BUFFER
/* script addition to trigger Brandock's scroll scribing dialogue */
  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/scripts/c#brando_scrollscribing.baf~ EVALUATE_BUFFER
  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/scripts/c#brando_bg1_scrollscribing.baf~ EVALUATE_BUFFER 
  EXTEND_TOP ~c#brando.bcs~   ~C#Brandock/scripts/c#brando_bg1_scrollscribing_et.baf~ EVALUATE_BUFFER
/* Brandock's Half-Ogre quest */
EXTEND_TOP ~c#brando.bcs~   ~C#Brandock/scripts/c#brando_bg1_shapeshifting.baf~ EVALUATE_BUFFER
EXTEND_TOP ~c#brando.bcs~   ~C#Brandock/scripts/c#brando_shapeshifting.baf~ EVALUATE_BUFFER
/* Brandock's Half-Ogre quest: events after Sarevok is dead. Will only trigger here if game stays in BG1 after S. death */
EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/scripts/c#brando_bg1_sod_shapeshifting.baf~ EVALUATE_BUFFER
/* extras needed for 7th party member mode */
EXTEND_BOTTOM ~c#brando.bcs~ ~%MOD_FOLDER%/7thpmm/script_patch/set_7pmm_scripts.baf~ EVALUATE_BUFFER
END

/* general scripts for BGII part */
ACTION_IF GAME_IS ~bg2ee bgt eet tob~ THEN BEGIN
	<<<<<<<< ...inlined/c#brand2.baf
	>>>>>>>>
	COMPILE ~...inlined/c#brand2.baf~
	EXTEND_BOTTOM ~c#brand2.bcs~   ~C#Brandock/scripts/c#brando.baf~ EVALUATE_BUFFER 
	EXTEND_BOTTOM ~c#brand2.bcs~   ~C#Brandock/scripts/c#brando_bg2.baf~ EVALUATE_BUFFER
/* lorepath: BG2 content */
  EXTEND_BOTTOM ~c#brand2.bcs~   ~C#Brandock/scripts/c#brando_bg2_lorepath.baf~ EVALUATE_BUFFER
/* script addition to trigger Brandock's scroll scribing dialogue */
  EXTEND_BOTTOM ~c#brand2.bcs~   ~C#Brandock/scripts/c#brando_scrollscribing.baf~ EVALUATE_BUFFER
/* ##
/* Brandock's Half-Ogre quest */
EXTEND_TOP ~c#brand2.bcs~   ~C#Brandock/scripts/c#brando_bg2_shapeshifting.baf~ EVALUATE_BUFFER
*/
EXTEND_TOP ~c#brand2.bcs~   ~C#Brandock/scripts/c#brando_shapeshifting.baf~ EVALUATE_BUFFER
/* extras needed for 7th party member mode */
EXTEND_BOTTOM ~c#brand2.bcs~ ~%MOD_FOLDER%/7thpmm/script_patch/set_7pmm_scripts.baf~ EVALUATE_BUFFER
END

/* specific additions to scripts for bgt */
ACTION_IF GAME_IS ~bgt~ THEN BEGIN
/* BG1 script */
/* script addition to trigger Brandock's scroll scribing dialogue */
  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/scripts/c#_lvl.baf~ EVALUATE_BUFFER
END

/* specific additions to scripts for BGII & BGT (for original engine) */
ACTION_IF GAME_IS ~tob~ THEN BEGIN
  EXTEND_BOTTOM ~c#brand2.bcs~   ~C#Brandock/scripts/c#_lvl.baf~ EVALUATE_BUFFER
END

/* specific additions to scripts for bgee game *without* SoD */
ACTION_IF (GAME_IS ~bgee~ AND NOT FILE_EXISTS_IN_GAME ~bd0103.are~) THEN BEGIN
  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/scripts/c#_lvl.baf~ EVALUATE_BUFFER
  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/scripts/c#brando_ee.baf~ EVALUATE_BUFFER
END

/* specific additions to scripts for bgee / EET game *with* SoD */
ACTION_IF (GAME_IS ~bgee eet~ AND FILE_EXISTS_IN_GAME ~bd0103.are~) THEN BEGIN
  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/scripts/c#_lvl_ee.baf~ EVALUATE_BUFFER
  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/scripts/c#brando_ee.baf~ EVALUATE_BUFFER

/* contents for Korlasz Tomb - added to BG1 script! */
EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/scripts/c#brando_sod_korlaszcrypt.baf~ EVALUATE_BUFFER

/* specific additions to scripts for sod */
/* create Brandock's SoD override script */
	<<<<<<<< ...inlined/c#brands.baf
	>>>>>>>>
	COMPILE ~...inlined/c#brands.baf~
	EXTEND_BOTTOM ~c#brands.bcs~   ~C#Brandock/scripts/c#brando.baf~  EVALUATE_BUFFER
	EXTEND_BOTTOM ~c#brands.bcs~   ~C#Brandock/scripts/c#brando_sod_reactions.baf~  EVALUATE_BUFFER
	EXTEND_BOTTOM ~c#brands.bcs~   ~C#Brandock/scripts/c#brando_sod.baf~  EVALUATE_BUFFER
	EXTEND_BOTTOM ~c#brands.bcs~   ~C#Brandock/scripts/c#brando_sod_lorepath.baf~  EVALUATE_BUFFER
  EXTEND_BOTTOM ~c#brands.bcs~   ~C#Brandock/scripts/c#brando_bg1_cursedscrolls.baf~ EVALUATE_BUFFER
/* script addition to trigger Brandock's scroll scribing dialogue */
  EXTEND_BOTTOM ~c#brands.bcs~   ~C#Brandock/scripts/c#brando_scrollscribing.baf~ EVALUATE_BUFFER
/* Brandock's Half-Ogre quest: patch possible events after Sarevok's death here, too */
EXTEND_TOP ~c#brands.bcs~   ~C#Brandock/scripts/c#brando_shapeshifting.baf~ EVALUATE_BUFFER
EXTEND_BOTTOM ~c#brands.bcs~   ~C#Brandock/scripts/c#brando_bg1_sod_shapeshifting.baf~ EVALUATE_BUFFER
  EXTEND_BOTTOM ~c#brands.bcs~   ~C#Brandock/scripts/c#_lvl_ee.baf~ EVALUATE_BUFFER
  EXTEND_BOTTOM ~c#brands.bcs~   ~C#Brandock/scripts/c#brando_ee.baf~ EVALUATE_BUFFER
/* extras needed for 7th party member mode */
EXTEND_BOTTOM ~c#brands.bcs~ ~%MOD_FOLDER%/7thpmm/script_patch/set_7pmm_scripts.baf~ EVALUATE_BUFFER

<<<<<<<< ...inlined/C#brandoS_timer.baf
/* Let's reset the timer once it run out without a valid dialogue, so the next reaction dialogue will not trigger right after the incident. */
IF
	InParty("C#Brage")
	CombatCounter(0)
	!See([ENEMY])
	ActionListEmpty()
	!RealGlobalTimerNotExpired("C#BrandockDialogTimer","GLOBAL")
THEN
	RESPONSE #25
		RealSetGlobalTimer("C#BrandockDialogTimer","GLOBAL",800)
	RESPONSE #25
		RealSetGlobalTimer("C#BrandockDialogTimer","GLOBAL",1000)
	RESPONSE #25
		RealSetGlobalTimer("C#BrandockDialogTimer","GLOBAL",1200)
	RESPONSE #25
		RealSetGlobalTimer("C#BrandockDialogTimer","GLOBAL",850)
END	
>>>>>>>>
EXTEND_BOTTOM ~c#brands.bcs~ ~...inlined/C#brandoS_timer.baf~
END

/* additions to script for bg2ee game (EE specific) */
ACTION_IF GAME_IS ~bg2ee eet~ THEN BEGIN
  EXTEND_BOTTOM ~c#brand2.bcs~   ~C#Brandock/scripts/c#_lvl_ee.baf~ EVALUATE_BUFFER 
  EXTEND_BOTTOM ~c#brand2.bcs~   ~C#Brandock/scripts/c#brando_ee.baf~ EVALUATE_BUFFER
END

/* other scripts */

/* general */
/* script of helper cre for scroll scribing */
COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brhelp.baf~
/* cutscene "Fade to Black + Brandock initiates dialogue */
COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brcut5.baf~

/* BG1 */
ACTION_IF GAME_IS ~bgee bgt eet~ THEN BEGIN
/* cutscene "Fade to Black + Elvenhair initiates dialogue */
  COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brcut4.baf~
/* script og Elvenhair's desk */
  COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#bredsk.baf~
END // ~bgee bgt eet~

/* SoD - more scripts for SoD below */
ACTION_IF (GAME_IS ~bgee eet~ AND FILE_EXISTS_IN_GAME ~bd0103.are~) THEN BEGIN
  COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brcugl.baf~
END //SoD

/* BGII */
ACTION_IF GAME_IS ~bg2ee tob eet bgt~ THEN BEGIN
  EXTEND_BOTTOM ~c#brhelp.bcs~   ~C#Brandock/scripts/c#brhelp_bg2.baf~ EVALUATE_BUFFER
END // ~bg2ee tob eet bgt~

/* bams for all games */
COPY ~C#Brandock/bams~ ~Override~


/* store */
COPY ~C#Brandock/stores/c#br0003.sto~ ~Override~
SAY STORE_NAME @6 /* ~Brandock's Bookcase~ */



/* items */

/* all BG1 items will be compiled always in case they are transferred via savegame */

COPY ~C#Brandock/items/c#br0001.itm~ ~override/c#br0001.itm~
SAY NAME1 @7 /* ~Scrumbled Book~ */
SAY NAME2 @7 /* ~Scrumbled Book~ */
SAY UNIDENTIFIED_DESC @8 /* ~This is the remains of what was before a *very* expensive magical book. Some pages are still readible, but it clearly was gnawed on by several small teeth, tearing the pages apart.~ */
SAY IDENTIFIED_DESC @8 /* ~This is the remains of what was before a *very* expensive magical book. Some pages are still readible, but it clearly was gnawed on by several small teeth, tearing the pages apart.~ */

COPY ~C#Brandock/items/c#br0003.itm~ ~override/c#br0003.itm~
SAY NAME1 @6 /* ~Brandock's Bookcase~ */
SAY NAME2 @6 /* ~Brandock's Bookcase~ */
SAY UNIDENTIFIED_DESC @11 /* ~This is Brandock's bookcase. It is for storing books and scrolls.~ */
SAY IDENTIFIED_DESC @11 /* ~This is Brandock's bookcase. It is for storing books and scrolls.~ */

COPY ~C#Brandock/items/c#br0005.itm~ ~override/c#br0005.itm~
SAY NAME1 @4 /* ~Brandock's Robe~ */
SAY NAME2 @4 /* ~Brandock's Robe~ */
SAY UNIDENTIFIED_DESC @5 /* ~This is the warmest robe Brandock could get when travelling far north from his home lands. Not that it is that warm where he comes from, but 'the nights are colder out here, I must say'. Plus, the coat is so thick it actually provides protection against missiles, which comes quite handy for a mage.

STATISTICS:

Equipped abilities:
Cold Resistance: +20%
Armor Class: +1 vs. missile attacks

Weight: 3~ */
SAY IDENTIFIED_DESC @5 /* ~This is the warmest robe Brandock could get when travelling far north from his home lands. Not that it is that warm where he comes from, but 'the nights are colder out here, I must say'. Plus, the coat is so thick it actually provides protection against missiles, which comes quite handy for a mage.

STATISTICS:

Equipped abilities:
Cold Resistance: +20%
Armor Class: +1 vs. missile attacks

Weight: 3~ */

COPY ~C#Brandock/items/c#br0007.itm~ ~override/c#br0007.itm~
SAY NAME1 @9 /* ~Brandock's Restored Book~ */
SAY NAME2 @9 /* ~Brandock's Restored Book~ */
SAY UNIDENTIFIED_DESC @10 /* ~This is the book that transformed after Elvenhair tried to preserve the paper snippets of the destroyed De Simplex Magicae: the first pages are written in Ruathlek, a rune language only known to some sages and Illusionists. The rest of the book is appearently empty, but flipping through the pages they seem to radiate with magic.~ */
SAY IDENTIFIED_DESC @10 /* ~This is the book that transformed after Elvenhair tried to preserve the paper snippets of the destroyed De Simplex Magicae: the first pages are written in Ruathlek, a rune language only known to some sages and Illusionists. The rest of the book is appearently empty, but flipping through the pages they seem to radiate with magic.~ */

/* ink of an octopus */
COPY ~C#Brandock/items/c#broink.itm~ ~override/c#broink.itm~
SAY NAME1 @12 /* ~Ink of an Octopus~ */
SAY NAME2 @12 /* ~Ink of an Octopus~ */
SAY UNIDENTIFIED_DESC @13 /* ~This is ink from an octopus. It is a rather expensive magic ingredient. You should only buy it if you know what you want to use it for.~ */
SAY IDENTIFIED_DESC @13 /* ~This is ink from an octopus. It is a rather expensive magic ingredient. You should only buy it if you know what you want to use it for.~ */

/* cre files */

/* general for all games */

/* helper cre for scroll scribing */
COPY ~C#Brandock/cre/c#brhelp.cre~ ~override/c#brhelp.cre~ //
   SAY NAME1 ~~ 
   SAY NAME2 ~~ 


/* general BG1 contents */

ACTION_IF GAME_IS ~bgee bgt eet~ THEN BEGIN

/* spawn Brandock in BG1 */

LAF extend_area_script STR_VAR area="%CoastWay%" bottom="C#Brandock/scripts/c#brando_ar2800.baf" END

/* help me detect the spot */
COPY ~C#Brandock/cre/c#brspy1.cre~ ~override/c#brspy1.cre~ //
   SAY NAME1 ~~ 
   SAY NAME2 ~~ 
WRITE_EVALUATED_ASCII 0x280 ~c#brspy1~ #8   // Death variable
WRITE_EVALUATED_ASCII 0x2cc ~c#brspy1~ #8   // dialogue
WRITE_EVALUATED_ASCII 0x248 ~c#brspy1~ #8   // Override script
WRITE_EVALUATED_ASCII 0x260 ~~ #8   // General script

/* place invisible creature onto Gorion's death site */
LAF extend_area_script STR_VAR area="%LionsWay%" top="C#Brandock/scripts/c#brando_ar2700.baf" END

/* place invisible cre so Brandock recognizes the carnival */
LAF extend_area_script STR_VAR area="%NashkelCarnival%" bottom="C#Brandock/scripts/c#brando_ar4900.baf" END

END //ACTION_IF GAME_IS ~bgee bgt eet~ 


/* main quest path: Brandock's possessions */

ACTION_IF GAME_IS ~bgee bgt eet~ THEN BEGIN

/* script of "pile" in the cave on Coast Way */

COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brpile.baf~

/* cutscene: Brandock finds his possessions */

COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brcut8.baf~

/* book restore quest path */

/* bookrestore quest */
/* Fish store with octopus ink */
COPY ~C#Brandock/stores/c#brfish.sto~ ~Override~
SAY STORE_NAME @14 /* ~Fish Store~ */

/* fisherman in Ulgoth's Beard */
COPY ~C#Brandock/cre/c#brfish.cre~ ~override/c#brfish.cre~ 
   SAY NAME1 @15 /* ~Fisherman~ */
   SAY NAME2 @15 /* ~Fisherman~ */
WRITE_EVALUATED_ASCII 0x280 ~c#brfish~ #8   // Death variable
WRITE_EVALUATED_ASCII 0x2cc ~c#brfish~ #8   // dialogue
WRITE_EVALUATED_ASCII 0x248 ~c#brfish~ #8   // Override script

/* place fisherman in Ulgoth's Beard */
LAF extend_area_script STR_VAR area="%UlgothsBeard%" bottom="C#Brandock/scripts/c#brando_ar1000.baf" END

/* cutscene: book restoration */
COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brcu11.baf~

END //GAME_IS ~bgee bgt eet~

/* For BGT: add mapnote to Elvenhair's house */
ACTION_IF GAME_IS ~bgt~ THEN BEGIN

<<<<<<<< ...inlined/mapnote_elvenhair.baf
IF 
	!Dead("C#Brandock")
	GlobalGT("C#Br_BookRestore","GLOBAL",0)
	Global("C#Brandock_MNElvenhair","MYAREA",0)
THEN
	RESPONSE #100
		AddMapNote([2030.2940],@1022)
		SetGlobal("C#Brandock_MNElvenhair","MYAREA",1)
END

>>>>>>>>
LAF extend_area_script STR_VAR area="%Beregost%" bottom="...inlined/mapnote_elvenhair.baf" END

END //ACTION_IF GAME_IS ~bgt~ THEN BEGIN

/* BG1 side-quest: shoes!  */

COPY ~C#Brandock/items/c#br0002.itm~ ~override/c#br0002.itm~
SAY NAME1 @16 /* ~Fine Pair of Boots~ */
SAY NAME2 @16 /* ~Fine Pair of Boots~ */
SAY UNIDENTIFIED_DESC @17 /* ~This is a pair of boots, and quite an expensive one, as it is. It was visibly dragged through the dirt, but with a brush and some enthousiasm it may be restored to its former appearance.~ */
SAY IDENTIFIED_DESC @17 /* ~This is a pair of boots, and quite an expensive one, as it is. It was visibly dragged through the dirt, but with a brush and some enthousiasm it may be restored to its former appearance.~ */

COPY ~C#Brandock/items/c#br0006.itm~ ~override/c#br0006.itm~
SAY NAME1 @18 /* ~Delicious Salmon~ */
SAY NAME2 @18 /* ~Delicious Salmon~ */
SAY UNIDENTIFIED_DESC @19 /* ~This is a piece of delicious, juicy salmon.~ */
SAY IDENTIFIED_DESC @20 /* ~This is a piece of delicious, juicy salmon.

STATISTICS:

Special: Restores 6 Hit Points.

Weight: 1~ */

ACTION_IF GAME_IS ~bgee bgt eet~ THEN BEGIN

/* servant in AR3300, in front of servant quarters */
COPY ~C#Brandock/cre/c#brserv.cre~ ~override/c#brserv.cre~ //
WRITE_EVALUATED_ASCII 0x280 ~c#brserv~ #8   // Death variable
WRITE_EVALUATED_ASCII 0x2cc ~c#brserv~ #8   // dialogue

LAF extend_area_script STR_VAR area="%Beregost%" bottom="C#Brandock/scripts/c#brando_ar3300.baf" END

END //~bgee bgt eet~

/* Brandock and the half-ogre / shapeshifting quest */

/* general files */

/* half-ogre weapon */
COPY ~C#Brandock/items/c#brmawe.itm~ ~override/c#brmawe.itm~

/* Brandock as a half-ogre */
COPY 	~C#Brandock/Cre/c#brhaog.cre~ ~override/c#brhaog.cre~
SAY NAME1 @500 /* ~Brandock~ */
SAY NAME2 @500 /* ~Brandock~ */
SAY MORALE @501 /* ~~ [c#bran01] */
SAY HAPPY @502 /* ~~ */
SAY UNHAPPY_ANNOYED @503 /* ~~ [c#bran21] */
SAY UNHAPPY_SERIOUS @504 /* ~~ [c#bran26] */
SAY UNHAPPY_BREAKING @505 /* ~~ [c#bran02] */ 
SAY LEADER @506 /* ~~ [c#bran08] */
SAY TIRED @507 /* ~~ [c#bran09] */  
SAY BORED @508 /* ~~ [c#bran10] */
SAY BATTLE_CRY1 @509 /* ~~ [c#bran03] */  
SAY BATTLE_CRY2 @510 /* ~~ [c#bran05] */ 
SAY BATTLE_CRY3 @511 /* ~~ [c#bran06] */ 
SAY BATTLE_CRY4 @512 /* ~~ [c#bran07] */  
SAY BATTLE_CRY5 @513 /* ~~ [c#bran04] */
SAY DAMAGE @514 /* ~~ [c#bran25] */
SAY DYING @515 /* ~~ [c#bran22] */
SAY HURT @516 /* ~~ [c#bran24] */  
SAY AREA_FOREST @517 /* ~Ich liebe den Duft von Moos und Kiefernadeln.~ [c#bran28] */
SAY AREA_CITY @518 /* ~In der Stadt sind immer so viele Leute auf einem Haufen!~ [c#bran29] */  
SAY AREA_DUNGEON @519 /* ~Irgendwie ist es hier unheimlich.~ [c#bran30] */ 
SAY AREA_DAY @520 /* ~Ich mag es, wenn die Sonne scheint! Außer direkt in mein Gesicht, natürlich.~ [c#bran31] */ 
SAY AREA_NIGHT @521 /* ~Nachts ist es immer so... dunkel.~ [c#bran32] */ 
SAY SELECT_COMMON1 @522 /* ~~ [c#bran11] */  
SAY SELECT_COMMON2 @523 /* ~~ [c#bran12] */  
SAY SELECT_COMMON3 @524 /* ~~ [c#bran14] */
SAY SELECT_COMMON4 @534 /* ~M-hm?~ [c#bran33] */  
SAY SELECT_COMMON5 @535 /* ~Ich höre?~ [c#bran34] */  
SAY SELECT_COMMON6 @536 /* ~[als freundliche Aufforerung] Sagt, was Ihr wollt!~ [c#bran35] */
SAY SELECT_ACTION1 @525 /* ~~ [c#bran15] */ 
SAY SELECT_ACTION2 @526 /* ~~ [c#bran13] */ 
SAY SELECT_ACTION3 @527 /* ~~ [c#bran16] */ 
SAY SELECT_ACTION4 @528 /* ~~ [c#bran17] */  
SAY SELECT_ACTION5 @529 /* ~~ [c#bran18] */  
SAY SELECT_ACTION6 @530 /* ~~ [c#bran19] */  
SAY SELECT_ACTION7 @531 /* ~~ [c#bran20] */  
SAY REACT_TO_DIE_GENERAL @532 /* ~~ [c#bran23] */ 
SAY SELECT_RARE1 @537 /* ~Bei den Göttern! Erschreckt mich doch nicht so! Was wollt Ihr?~ [c#bran36] */ 
SAY CRITICAL_HIT @538 /* ~[triumphierend] Ja!!~ [c#bran37] */ 
SAY CRITICAL_MISS @539 /* ~Verdammt, daneben!~ [c#bran38] */ 
SAY TARGET_IMMUNE @540 /* ~Meine Waffe scheint nichts zu bewirken.~ [c#bran39] */ 
SAY INVENTORY_FULL @541 /* ~[entschuldigend] Tut mir Leid, aber das passte wirklich nicht mehr in meine Tasche.~ [c#bran40] */ 
SAY SPELL_DISRUPTED @542 /* ~Ach, Mist! Jetzt bin ich rausgekommen.~ [c#bran41] */ 
SAY BIO ~This is Brandock in shape of a half-ogre. Asked about his past, Brandock looks at you and growls: 'Really, <CHARNAME>? Now?'~


COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brcut6.baf~
COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brcut7.baf~


ACTION_IF GAME_IS ~bgee bgt eet~ THEN BEGIN
COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brhao2.baf~

COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brcut1.baf~
COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brcut2.baf~
COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brcut3.baf~
/* ~Make Cutscene in Thalantyr's Abode Skippable~ */
ACTION_IF GAME_IS ~bgee eet~ THEN BEGIN
COMPILE EVALUATE_BUFFER ~c#brandock/scripts/c#brskp1.baf~

COPY_EXISTING ~c#brcut3.BCS~ ~override~
	DECOMPILE_AND_PATCH BEGIN
		SPRINT textToReplace ~\(MultiPlayerSync()\)~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~\1 
		SetAreaScript("c#brskp1",OVERRIDE)
		SetGlobal("C#BR_CUTSCENE_BREAKABLE","GLOBAL",1) 				SetCutSceneBreakable(TRUE)~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
		SPRINT textToReplace ~\(SmallWait(10)\)~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~\1 
		SetCutSceneBreakable(FALSE)
		SetGlobal("C#BR_CUTSCENE_BREAKABLE","GLOBAL",0)
		SetAreaScript("",OVERRIDE)~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
	END
BUT_ONLY
END
COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brcut9.baf~
COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brcu10.baf~

COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#br02.baf~

EXTEND_TOP ~THALANTR.bcs~ ~C#Brandock/scripts/thalantr_add.baf~
      EVALUATE_BUFFER

LAF extend_area_script STR_VAR area="%HighHedge%" bottom="C#Brandock/scripts/c#brando_ar3200.baf" END

LAF extend_area_script STR_VAR area="%HighHedge_ThalanthyrsAbode%" bottom="C#Brandock/scripts/c#brando_ar3202.baf" END

LAF extend_area_script STR_VAR area="%Candlekeep_Catacombs_L2%" bottom="C#Brandock/scripts/c#brando_ar2619.baf" END

LAF extend_area_script STR_VAR area="%CandlekeepCaves%" bottom="C#Brandock/scripts/c#brando_ar5506.baf" END

COPY_EXISTING ~%tutu_var%THALAN.CRE~ ~override/C#BRTHAL.CRE~
WRITE_EVALUATED_ASCII 0x280 ~C#BRTHAL~ #32 // script name / DV
WRITE_EVALUATED_ASCII 0x2cc ~C#BRTHAL~ #8
WRITE_EVALUATED_ASCII 0x250 ~~ #8   // Class script
WRITE_EVALUATED_ASCII 0x258 ~~ #8   // Race script
WRITE_EVALUATED_ASCII 0x258 ~~ #8   // Default script

COPY ~C#Brandock/cre/c#brmeli.cre~ ~override/c#brmeli.cre~ //Melicamp for dialogue only
   SAY NAME1 #19346 //~Melicamp the chicken~
   SAY NAME2 #19346 
WRITE_EVALUATED_ASCII 0x280 ~c#brmeli~ #8   // Death variable
WRITE_EVALUATED_ASCII 0x2cc ~c#brmeli~ #8   // dialogue
WRITE_EVALUATED_ASCII 0x248 ~c#brmeli~ #8   // Override script

COPY ~C#Brandock/Cre/c#brhao2.cre~ ~override/c#brhao2.cre~ //Half-Ogre
WRITE_EVALUATED_ASCII 0x280 ~c#brhao2~ #8   // Death variable
WRITE_EVALUATED_ASCII 0x2cc ~c#brhao2~ #8   // dialogue
WRITE_EVALUATED_ASCII 0x248 ~c#brhao2~ #8   // Override script

COPY_EXISTING ~FIREBE.CRE~ ~override/C#BRFIRE.CRE~
WRITE_EVALUATED_ASCII 0x280 ~C#BRFIRE~ #32 // script name / DV
WRITE_EVALUATED_ASCII 0x2cc ~C#BRFIRE~ #8
WRITE_EVALUATED_ASCII 0x248 ~C#BRFIRE~ #8   // Override script
WRITE_EVALUATED_ASCII 0x250 ~initdlg~ #8   // Class script
WRITE_EVALUATED_ASCII 0x258 ~~ #8   // Race script
WRITE_EVALUATED_ASCII 0x258 ~~ #8   // Default script
	REMOVE_CRE_ITEMS

COPY_EXISTING ~AOLN.CRE~ ~override/C#BRRANG.CRE~
   SAY NAME1 @35 /* ~Ranger~ */
   SAY NAME2 @35
WRITE_EVALUATED_ASCII 0x280 ~C#BRRANG~ #32 // script name / DV
WRITE_EVALUATED_ASCII 0x2cc ~C#BRRANG~ #8
WRITE_EVALUATED_ASCII 0x248 ~C#BRRANG~ #8   // Override script
//WRITE_EVALUATED_ASCII 0x250 ~~ #8   // Class script: initdlg
WRITE_EVALUATED_ASCII 0x258 ~~ #8   // Race script
//WRITE_EVALUATED_ASCII 0x258 ~~ #8   // Default script: wtarsgt

COPY ~C#Brandock/cre/c#brhabr.cre~ ~override/c#brhabr.cre~ //
   SAY NAME1 @36 /* ~Malm~ */
   SAY NAME2 @36 
WRITE_EVALUATED_ASCII 0x280 ~c#brhabr~ #8   // Death variable
WRITE_EVALUATED_ASCII 0x2cc ~c#brhabr~ #8   // dialogue
WRITE_EVALUATED_ASCII 0x248 ~c#brhabr~ #8   // Override script
	REMOVE_CRE_ITEMS

COPY ~C#Brandock/cre/c#brfedg.cre~ ~override/c#brfedg.cre~
/* spell to turn doppelganger Elvenhair into a doppelganger */
COPY ~C#Brandock/spells/c#brfedg.spl~ ~override/c#brfedg.spl~
/* silent spell: polymorph half-ogre */
COPY ~C#Brandock/spells/c#brsh02.spl~ ~override/c#brsh02.spl~
/* silent spell: polymorph back */
COPY ~C#Brandock/spells/c#brsh03.spl~ ~override/c#brsh03.spl~ 

/* events after Sarevok is dead - will trigger in BG1 if it's BGT or with a mod that lets the game remain in BG1
OR: will trigger in SoD  */

/* FF mercenary to release Malm */
COPY ~C#Brandock/cre/c#brhaff.cre~ ~override/c#brhaff.cre~
WRITE_EVALUATED_ASCII 0x280 ~c#brhaff~ #8   // Death variable
WRITE_EVALUATED_ASCII 0x2cc ~c#brhaff~ #8   // dialogue
WRITE_EVALUATED_ASCII 0x248 ~c#brhaff~ #8   // Override script

/* drunk */
COPY ~C#Brandock/cre/c#brhadr.cre~ ~override/c#brhadr.cre~ 
WRITE_EVALUATED_ASCII 0x280 ~c#brhadr~ #8   // Death variable
WRITE_EVALUATED_ASCII 0x2cc ~c#brhadr~ #8   // dialogue
WRITE_EVALUATED_ASCII 0x248 ~c#brhadr~ #8   // Override script
	REMOVE_CRE_ITEMS

/* clean up FF Headquarters after scene in Palace */
/* will only be applied if EndlessBG1 didn't already do it  (checks for "c#stdst2.bcs") */
INCLUDE ~C#Brandock/tpa/cleanup_ff_hq.tpa~

/* despawn Malm in the Temple of the Morninglord */
EXTEND_BOTTOM ~%Temple_SongoftheMorning%.bcs~ ~C#Brandock/scripts/c#brando_ar3402.baf~
EVALUATE_BUFFER

/* spawns Malm in prison %SWBaldursGate_FlamingFistHQ_L1% */
EXTEND_BOTTOM ~%SWBaldursGate_FlamingFistHQ_L1%.bcs~ ~C#Brandock/scripts/c#brando_bg1_sod_shapeshifting_ffhq.baf~
EVALUATE_BUFFER

/* spawns Malm in prison bd0104.are for SoD */
ACTION_IF (GAME_IS ~bgee eet~ AND FILE_EXISTS_IN_GAME ~bd0103.are~) THEN BEGIN
EXTEND_BOTTOM ~bd0104.bcs~ ~C#Brandock/scripts/c#brando_sod_shapeshifting_ffhq.baf~
  EXTEND_BOTTOM ~bd0104.bcs~ ~C#Brandock/scripts/c#brando_bg1_sod_shapeshifting_ffhq.baf~
EVALUATE_BUFFER
END //SoD

COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brcu12.baf~

ACTION_IF GAME_IS ~bgt~ THEN BEGIN

<<<<<<<< .../brando_inlined_bd0706_add.baf
/* BGT only: spawn Josh already */
IF 
	!InMyArea("c#brhaff")
	GlobalLT("ENDOFBG1","GLOBAL",2)
	Global("bd_plot","GLOBAL",0)
	Global("C#Brando_VisitedMalm","GLOBAL",3)
	Global("C#Brandock_SpawnMalmFF","MYAREA",0)
THEN
	RESPONSE #100
            SetGlobal("C#Brandock_SpawnMalmFF","MYAREA",1)
	    CreateCreature("c#brhaff",[875.660],12) 
END
>>>>>>>>
EXTEND_BOTTOM ~%SWBaldursGate_FlamingFistHQ_L1%.bcs~ ~.../brando_inlined_bd0706_add.baf~

END //bgt


END //ACTION_IF GAME_IS ~bgee bgt eet~


/* Brandock's scroll + book scribing */
/* scroll scribing quest - BGII items */

ACTION_IF GAME_IS ~tob eet bg2ee bgt~ THEN BEGIN

/* "durable" scrolls (with 3 charges) */

COPY_EXISTING ~scrl1e.itm~ ~override/c#br1e.itm~
SAY NAME1 @0 /* ~Durable Scroll of Dispel Magic~ */
SAY NAME2 @0 /* ~Durable Scroll of Dispel Magic~ */
WRITE_BYTE 0x38 1 // stackability
WRITE_BYTE 0x94 3 // charges

COPY_EXISTING ~scrl1g.itm~ ~override/c#br1g.itm~
SAY NAME1 @3 /* ~Durable Scroll of Fireball~ */
SAY NAME2 @3 /* ~Durable Scroll of Fireball~ */
WRITE_BYTE 0x38 1 // stackability
WRITE_BYTE 0x94 3 // charges

COPY_EXISTING ~scrl1h.itm~ ~override/c#br1h.itm~
SAY NAME1 @27 /* ~Durable Scroll of Haste~ */
SAY NAME2 @27 /* ~Durable Scroll of Haste~ */
WRITE_BYTE 0x38 1 // stackability
WRITE_BYTE 0x94 3 // charges

COPY_EXISTING ~scrl1u.itm~ ~override/c#br1u.itm~
SAY NAME1 @28 /* ~Durable Scroll of Confusion~ */
SAY NAME2 @28 /* ~Durable Scroll of Confusion~ */
WRITE_BYTE 0x38 1 // stackability
WRITE_BYTE 0x94 3 // charges

COPY_EXISTING ~scrl1y.itm~ ~override/c#br1y.itm~
SAY NAME1 @29 /* ~Durable Scroll of Improved Invisibility~ */
SAY NAME2 @29 /* ~Durable Scroll of Improved Invisibility~ */
WRITE_BYTE 0x38 1 // stackability
WRITE_BYTE 0x94 3 // charges

COPY_EXISTING ~scrl2a.itm~ ~override/c#br2a.itm~
SAY NAME1 @30 /* ~Durable Scroll of Monster Summoning II~ */
SAY NAME2 @30 /* ~Durable Scroll of Monster Summoning II~ */
WRITE_BYTE 0x38 1 // stackability
WRITE_BYTE 0x94 3 // charges

COPY_EXISTING ~scrl6u.itm~ ~override/c#br6u.itm~
SAY NAME1 @31 /* ~Durable Scroll of Breach~ */
SAY NAME2 @31 /* ~Durable Scroll of Breach~ */
WRITE_BYTE 0x38 1 // stackability
WRITE_BYTE 0x94 3 // charges

COPY_EXISTING ~scrl6y.itm~ ~override/c#br6y.itm~
SAY NAME1 @32 /* ~Durable Scroll of Protection From Acid~ */
SAY NAME2 @32 /* ~Durable Scroll of Protection From Acid~ */
WRITE_BYTE 0x38 1 // stackability
WRITE_BYTE 0x94 3 // charges

COPY_EXISTING ~scrl77.itm~ ~override/c#br77.itm~
SAY NAME1 @33 /* ~Durable Scroll of Magic Missile~ */
SAY NAME2 @33 /* ~Durable Scroll of Magic Missile~ */
WRITE_BYTE 0x38 1 // stackability
WRITE_BYTE 0x94 3 // charges

COPY_EXISTING ~scrl90.itm~ ~override/c#br90.itm~
SAY NAME1 @34 /* ~Durable Scroll of Invisibility~ */
SAY NAME2 @34 /* ~Durable Scroll of Invisibility~ */
WRITE_BYTE 0x38 1 // stackability
WRITE_BYTE 0x94 3 // charges

COPY_EXISTING ~scrl9a.itm~ ~override/c#br9a.itm~
SAY NAME1 @102 /* ~Durable Scroll of Pierce Shield~ */
SAY NAME2 @102 /* ~Durable Scroll of Pierce Shield~ */
WRITE_BYTE 0x38 1 // stackability
WRITE_BYTE 0x94 3 // charges


/* book pages - the restored De Simplex Magicae */
OUTER_SET BookString = RESOLVE_STR_REF (@114)
APPEND itemdial.2da ~c#brbo01 %BookString% c#brbok1~ UNLESS ~c#brbo01~
APPEND itemdial.2da ~c#brbo02 %BookString% c#brbok1~ UNLESS ~c#brbo02~
APPEND itemdial.2da ~c#brbo03 %BookString% c#brbok1~ UNLESS ~c#brbo03~
APPEND itemdial.2da ~c#brbo04 %BookString% c#brbok1~ UNLESS ~c#brbo04~
APPEND itemdial.2da ~c#brbo05 %BookString% c#brbok1~ UNLESS ~c#brbo05~
APPEND itemdial.2da ~c#brbo06 %BookString% c#brbok1~ UNLESS ~c#brbo06~
APPEND itemdial.2da ~c#brbo07 %BookString% c#brbok1~ UNLESS ~c#brbo07~
APPEND itemdial.2da ~c#brbo08 %BookString% c#brbok1~ UNLESS ~c#brbo08~
APPEND itemdial.2da ~c#brbo09 %BookString% c#brbok1~ UNLESS ~c#brbo09~
APPEND itemdial.2da ~c#brbo10 %BookString% c#brbok1~ UNLESS ~c#brbo10~
APPEND itemdial.2da ~c#brboA1 %BookString% c#brbok2~ UNLESS ~c#brboA1~
APPEND itemdial.2da ~c#brboA2 %BookString% c#brbok2~ UNLESS ~c#brboA2~
APPEND itemdial.2da ~c#brboA3 %BookString% c#brbok2~ UNLESS ~c#brboA3~
APPEND itemdial.2da ~c#brboA4 %BookString% c#brbok2~ UNLESS ~c#brboA4~
APPEND itemdial.2da ~c#brboA5 %BookString% c#brbok2~ UNLESS ~c#brboA5~
APPEND itemdial.2da ~c#brboA6 %BookString% c#brbok2~ UNLESS ~c#brboA6~
APPEND itemdial.2da ~c#brboA7 %BookString% c#brbok2~ UNLESS ~c#brboA7~
APPEND itemdial.2da ~c#brboA8 %BookString% c#brbok2~ UNLESS ~c#brboA8~
APPEND itemdial.2da ~c#brboA9 %BookString% c#brbok2~ UNLESS ~c#brboA9~
APPEND itemdial.2da ~c#brboAA %BookString% c#brbok2~ UNLESS ~c#brboAA~

COPY ~C#Brandock/items/c#brbo01.itm~ ~override/c#brbo01.itm~
SAY NAME1 @103 /* ~De Simplex Magicae~ */
SAY NAME2 @103
SAY UNIDENTIFIED_DESC @104 /* ~This is a spell page Brandock wrote into the restored De Simplex Magicae. The magic of the book lets the page remain unharmed and the spell on it recharge once a day. 

The spell on this page is:

Fireball (Evocation) 
Level: 3
Range: Visual range of caster 
Duration: Instantaneous 
Casting Time: 3 
Area of Effect: 15-foot radius
Saving Throw: 1/2 

A fireball is an explosive burst of flame, which detonates with a low roar and delivers damage proportional to the level of the wizard who cast it - 1d6 points of damage for each level of experience of the spellcaster (up to a maximum of 10d6). The wizard points his finger and speaks the range (distance and height) at which the fireball is to burst. A streak flashes from the pointing digit and, unless it impacts upon a material body or solid barrier prior to attaining the prescribed range, blossoms into the fireball (an early impact results in an early detonation). Creatures failing their saving throws each suffer full damage from the blast. Those who roll successful saving throws manage to dodge, fall flat, or roll aside, each receiving half.~ */
SAY IDENTIFIED_DESC @104
WRITE_ASCII 0x3a ~C#BR0007~  #8  // inventory BAM
COPY ~C#Brandock/items/c#brbo02.itm~ ~override/c#brbo02.itm~
SAY NAME1 @103 /* ~De Simplex Magicae~ */
SAY NAME2 @103 /* ~De Simplex Magicae~ */
SAY UNIDENTIFIED_DESC @105 /* ~This is a spell page Brandock wrote into the restored De Simplex Magicae. The magic of the book lets the page remain unharmed and the spell on it recharge once a day. 

The spell on this page is:

Minor Sequencer (Invocation/Evocation) 
Level: 4
Range: 0
Duration: Permanent
Casting Time: 1 round 
Area of Effect: Special 
Saving Throw: None 

This spell allows a mage to store spells and access them from his special ability button.  This ability, the sequencer, can store two spells to be released simultaneously,  both of which must be of 2nd level or lower.  A mage can only possess one minor spell sequencer at a time, and the sequencer may not be given to other players.  Once the sequencer is used, the special ability icon disappears.~ */
SAY IDENTIFIED_DESC @105
WRITE_ASCII 0x3a ~C#BR0007~  #8  // inventory BAM
COPY ~C#Brandock/items/c#brbo03.itm~ ~override/c#brbo03.itm~
SAY NAME1 @103 /* ~De Simplex Magicae~ */
SAY NAME2 @103 /* ~De Simplex Magicae~ */
SAY UNIDENTIFIED_DESC @106 /* ~This is a spell page Brandock wrote into the restored De Simplex Magicae. The magic of the book lets the page remain unharmed and the spell on it recharge once a day. 

The spell on this page is:

Breach (Abjuration) 
Level: 5
Range: Visual sight of caster 
Duration: Instant
Casting Time: 5
Area of Effect: Target Creature
Saving Throw: None

When this spell is cast at a creature, it breaches and dispels all of the specific and combat protections on the target creature.  Here is a complete list of all the specific protection spells that are dispelled by breach:  Shield, Protection Circle, Resist Fear, Protection From Fire/Cold, Fireshield, Protection From Acid, Protection From Electricity, Protection From Magic Energy, Protection From The Elements, and Protection From Energy.   The combat protection spells dispelled by this spell are: Protection From Normal Missiles, Protection From Normal Weapons, Protection From Magic Weapons, Stoneskin, Armor, Ghost Armor, Spirit Armor, Absolute Immunity, Mantle, and Improved Mantle.  The target's magic resistance, if he has any, does not affect this spell.~ */
SAY IDENTIFIED_DESC @106
WRITE_ASCII 0x3a ~C#BR0007~  #8  // inventory BAM
COPY ~C#Brandock/items/c#brbo04.itm~ ~override/c#brbo04.itm~
SAY NAME1 @103 /* ~De Simplex Magicae~ */
SAY NAME2 @103 /* ~De Simplex Magicae~ */
SAY UNIDENTIFIED_DESC @107 /* ~This is a spell page Brandock wrote into the restored De Simplex Magicae. The magic of the book lets the page remain unharmed and the spell on it recharge once a day. 

The spell on this page is:

Spell Deflection (Abjuration)
Level: 6
Range: 0 
Duration: 3 rounds/level
Casting Time: 6
Area of Effect: The caster 
Saving Throw: None 

This powerful abjuration spell causes any spells cast against the wizard to be absorbed and consumed.  This affects a total of 10 spell levels.  This includes spells cast from scrolls and innate spell-like abilities, but excludes the following: area effects that are not centered directly upon the wizard as well as area effects that are stationary, such as cloud kill and stinking cloud.  As long as the spell is cast directly at the wizard it will be absorbed.  Something to note is that as long as there are levels remaining then the spell will be absorbed.  For example, if there is only 1 level left and a 3rd-level spell is cast at the wizard, the spell will be absorbed while canceling the spell deflection.  It is not affected by a dispel magic.~ */
SAY IDENTIFIED_DESC @107
WRITE_ASCII 0x3a ~C#BR0007~  #8  // inventory BAM
COPY ~C#Brandock/items/c#brbo05.itm~ ~override/c#brbo05.itm~
SAY NAME1 @103 /* ~De Simplex Magicae~ */
SAY NAME2 @103 /* ~De Simplex Magicae~ */
SAY UNIDENTIFIED_DESC @108 /* ~This is a spell page Brandock wrote into the restored De Simplex Magicae. The magic of the book lets the page remain unharmed and the spell on it recharge once a day. 

The spell on this page is:

Mass Invisibility 
(Illusion/Phantasm) 
Level: 7
Range: Visual sight of caster 
Duration: 1 round/level
Casting Time: 7
Area of Effect: 15-foot radius
Saving Throw: None 

Upon casting this spell the wizard causes all friendly creatures within the area of effect to be affected by the spell Improved Invisibility.  This spell is similar to the invisibility spell, but the recipient is able to attack, either by missile discharge, melee combat, or spellcasting, and remain unseen. Note, however, that there are sometimes telltale traces, a shimmering, so that an observant opponent can attack the invisible spell recipient. These traces are only noticeable when specifically looked for (after the invisible character has made his presence known).  Attacks against the invisible character suffer -4 penalties to the attack rolls, and the invisible character's saving throws are made with a +4 bonus.~ */
SAY IDENTIFIED_DESC @108
WRITE_ASCII 0x3a ~C#BR0007~  #8  // inventory BAM
COPY ~C#Brandock/items/c#brbo06.itm~ ~override/c#brbo06.itm~
SAY NAME1 @103 /* ~De Simplex Magicae~ */
SAY NAME2 @103 /* ~De Simplex Magicae~ */
SAY UNIDENTIFIED_DESC @109 /* ~This is a spell page Brandock wrote into the restored De Simplex Magicae. The magic of the book lets the page remain unharmed and the spell on it recharge once a day. 

The spell on this page is:

Summon Efreeti (Conjuration/Summoning) 
Level: 7
Range: 40 yards 
Duration: 8 rounds + 1 round/level
Casting Time: 1 round
Area of Effect: Special 
Saving Throw: None

With this spell, the conjurer can cajole an efreeti, a massive genie with powerful abilities, to leave the elemental plane of fire and enter the Prime Material.  The efreeti will serve for the duration indicated above, attacking the enemies of the conjurer.  Mages are warned to be careful of this spell, for a mistreated efreeti will turn on his master at the first available opportunity.~ */
SAY IDENTIFIED_DESC @109
WRITE_ASCII 0x3a ~C#BR0007~  #8  // inventory BAM
COPY ~C#Brandock/items/c#brbo07.itm~ ~override/c#brbo07.itm~
SAY NAME1 @103 /* ~De Simplex Magicae~ */
SAY NAME2 @103 /* ~De Simplex Magicae~ */
SAY UNIDENTIFIED_DESC @110 /* ~This is a spell page Brandock wrote into the restored De Simplex Magicae. The magic of the book lets the page remain unharmed and the spell on it recharge once a day. 

The spell on this page is:

Bigby's Clenched Fist (Evocation) 
Level: 8
Range: Visual range of caster
Duration: 4 Rounds  
Casting Time: 8 
Area of Effect: 1 creature
Saving Throw: Special

This spell causes a giant disembodied hand to squeeze and constrict the target once per round for up to four rounds. It initially smashes the target for 3D6 damage with no save. The target is held. In the second round, the target can save vs. paralyzation at -2 to escape. If they fail to save, the hand does 4D6 damage. The following round, the target can save vs. paralyzation with no penalty. If they make the save, they are free to move, if they fail, the spell does 6D6 damage and holds them for 2 rounds. After the 4th round, the spell is finished. Magic resistance will stop the spell.~ */
SAY IDENTIFIED_DESC @110
WRITE_ASCII 0x3a ~C#BR0007~  #8  // inventory BAM
COPY ~C#Brandock/items/c#brbo08.itm~ ~override/c#brbo08.itm~
SAY NAME1 @103 /* ~De Simplex Magicae~ */
SAY NAME2 @103 /* ~De Simplex Magicae~ */
SAY UNIDENTIFIED_DESC @111 /* ~This is a spell page Brandock wrote into the restored De Simplex Magicae. The magic of the book lets the page remain unharmed and the spell on it recharge once a day. 

The spell on this page is:

Pierce Shield (Abjuration)
Level: 8
Range: Visual sight of caster
Duration: Instantaneous
Casting Time: 8
Area of Effect: Special
Saving Throw: None 

When this spell is cast it launches a massive attack on an enemy wizard's spell defenses.  The target's magic resistance will be lowered by 10% + 1% per level of the caster.  Next pierce shield will cancel one spell protection of any level.  For example, if this spell was cast by a 15th-level wizard the target creature would lose 25% magic resistance from his current total, reducing it to 0 if less than that remains, as well as cancelling one spell protection if the mage currently has one.  The list of spells that this includes is: Minor Spell Deflection, Minor Spell Turning, Spell Deflection, Minor Globe of Invulnerability, Spell Immunity, Globe Of Invulnerability, Spell Turning, Spell Shield, and Spell Trap.  Magic resistance does not effect this spell, nor do any of the spell protections.  The resistance remains lowered for 1 round per level of the caster.  It cannot be dispelled.~ */
SAY IDENTIFIED_DESC @111
WRITE_ASCII 0x3a ~C#BR0007~  #8  // inventory BAM
COPY ~C#Brandock/items/c#brbo09.itm~ ~override/c#brbo09.itm~
SAY NAME1 @103 /* ~De Simplex Magicae~ */
SAY NAME2 @103 /* ~De Simplex Magicae~ */
SAY UNIDENTIFIED_DESC @112 /* ~This is a spell page Brandock wrote into the restored De Simplex Magicae. The magic of the book lets the page remain unharmed and the spell on it recharge once a day. 

The spell on this page is:

Bigby's Crushing Hand (Evocation) 
Level: 9
Range: Visual range of caster
Duration: 3 Rounds  
Casting Time: 9
Area of Effect: 1 creature
Saving Throw: Special

This spell creates a huge disembodied fist that crushes the target and pins them to the ground. In the first round, the spell does 2D10 damage. The victim can save at -4 vs. paralyzation to avoid being pinned. If they fail, the hand does 3D10 damage the next round. The victim can again save vs. paralyzation at -2. If they fail to save, the hand does a final 4D10 damage and disappears.~ */
SAY IDENTIFIED_DESC @112
WRITE_ASCII 0x3a ~C#BR0007~  #8  // inventory BAM
COPY ~C#Brandock/items/c#brbo10.itm~ ~override/c#brbo10.itm~
SAY NAME1 @103 /* ~De Simplex Magicae~ */
SAY NAME2 @103 /* ~De Simplex Magicae~ */
SAY UNIDENTIFIED_DESC @113 /* ~This is a spell page Brandock wrote into the restored De Simplex Magicae. The magic of the book lets the page remain unharmed and the spell on it recharge once a day. 

The spell on this page is:

Chain Contingency (Evocation)
Level: 9
Range: 0
Duration: Special
Casting Time: 1 round
Area of Effect: The Caster
Saving Throw: None

Chain contingency channels some of the magical energy of the mage and releases it only under certain circumstances.  Basically, the mage chooses three spells, which will be released under certain conditions, such as being hit by an enemy.  When this condition occurs all three spells are cast immediately.  Spells of 8th level or lower may be used in the contingency.~ */
SAY IDENTIFIED_DESC @113

/* book of Infinite Spells */
WRITE_ASCII 0x3a ~C#BR0007~  #8  // inventory BAM
COPY ~C#Brandock/items/c#brboAA.itm~ ~override/c#brboAA.itm~
SAY UNIDENTIFIED_DESC @115 /* ~This ancient tome creaks as you open it.  Each page of the Book of Infinite Spells contains a spell described in layman's terms, easy enough for a thief, a cleric or even a fighter to understand and cast it.  Each spell on a page can be cast once per day.

Brandock changed the magic of the book, so now you can turn the pages back and forth - at least between the ones you opened for the original tome.

The spell on this page is:

Fireball (Evocation) 
Level: 3
Range: Visual range of caster 
Duration: Instantaneous 
Casting Time: 3 
Area of Effect: 15-foot radius
Saving Throw: 1/2 

A fireball is an explosive burst of flame, which detonates with a low roar and delivers damage proportional to the level of the wizard who cast it - 1d6 points of damage for each level of experience of the spellcaster (up to a maximum of 10d6). The wizard points his finger and speaks the range (distance and height) at which the fireball is to burst. A streak flashes from the pointing digit and, unless it impacts upon a material body or solid barrier prior to attaining the prescribed range, blossoms into the fireball (an early impact results in an early detonation). Creatures failing their saving throws each suffer full damage from the blast. Those who roll successful saving throws manage to dodge, fall flat, or roll aside, each receiving half.~ */
SAY IDENTIFIED_DESC @115
COPY ~C#Brandock/items/c#brboA1.itm~ ~override/c#brboA1.itm~
SAY UNIDENTIFIED_DESC @116 /* ~This ancient tome creaks as you open it.  Each page of the Book of Infinite Spells contains a spell described in layman's terms, easy enough for a thief, a cleric or even a fighter to understand and cast it.  Each spell on a page can be cast once per day.

Brandock changed the magic of the book, so now you can turn the pages back and forth - at least between the ones you opened for the original tome.

The spell on this page is:

Invisibility (Illusion/Phantasm) 
Level: 2
Range: Touch 
Duration: Special 
Casting Time: 2 
Area of Effect: Creature touched 
Saving Throw: None 

This spell causes the creature touched to vanish from sight and be undetectable by normal vision or even infravision. Of course, the invisible creature is not magically silenced, and certain other conditions can render the creature detectable. Even allies cannot see the invisible creature or his gear, unless these allies can normally see invisible things or employ magic to do so.  Items dropped or put down by the invisible creature become visible, items picked up disappear if tucked into the clothing or pouches worn by the creature. The spell remains in effect until it is magically broken or dispelled, until the recipient attacks any creature, or until 24 hours have passed. The invisible being cannot open doors, talk, eat, climb stairs, etc., and if he attacks, he immediately becomes visible, although the invisibility enables him to attack first.~ */
SAY IDENTIFIED_DESC @116
COPY ~C#Brandock/items/c#brboA2.itm~ ~override/c#brboA2.itm~
SAY UNIDENTIFIED_DESC @117 /* ~This ancient tome creaks as you open it.  Each page of the Book of Infinite Spells contains a spell described in layman's terms, easy enough for a thief, a cleric or even a fighter to understand and cast it.  Each spell on a page can be cast once per day.

Brandock changed the magic of the book, so now you can turn the pages back and forth - at least between the ones you opened for the original tome.

The spell on this page is:

Protection From Evil (Abjuration) 
Level: 1
Range: Touch 
Duration: 2 rounds/level
Casting Time: 1
Area of Effect: Creature touched 
Saving Throw: None 

When this spell is cast, it creates a magical barrier around the recipient at a distance of one foot. The barrier moves with the recipient and has two major effects: First, all attacks made by evil or evilly enchanted creatures against the protected creature receive a penalty of - 2 to each attack roll, and second, any saving throws caused by such attacks are made by the protected creature with a +2 bonus.~ */
SAY IDENTIFIED_DESC @117
WRITE_ASCII 0x3a ~C#BR0007~  #8  // inventory BAM
SAY UNIDENTIFIED_DESC @118 /* ~This ancient tome creaks as you open it.  Each page of the Book of Infinite Spells contains a spell described in layman's terms, easy enough for a thief, a cleric or even a fighter to understand and cast it.  Each spell on a page can be cast once per day.

Brandock changed the magic of the book, so now you can turn the pages back and forth - at least between the ones you opened for the original tome.

The spell on this page is:

True Seeing (Divination) 
Level: 5
Sphere: Divination
Range: 0
Duration: 1 turn
Casting Time: 8
Area of Effect: 120-foot radius
Saving Throw: None 

When this spell is cast, an area roughly 120 feet in radius around the caster will be effected.  Instantly and once each round for 1 turn after this spell is cast, all hostile illusion/phantasm spells in the area of effect will be dispelled.  The spells that are affected by this are: Reflected Image, Invisibility, Mirror Image, Non-detection, Improved Invisibility, Shadow Door, Mislead, Project Image, and Simulacrum.  The area of effect is roughly a 120-foot radius around the caster.  The target's magic resistance, if any, does not come into effect with this spell.  This spell only affects enemies, thus it is unable to dispel the invisibility from a party member.~ */
SAY IDENTIFIED_DESC @118
COPY ~C#Brandock/items/c#brboA4.itm~ ~override/c#brboA4.itm~
SAY UNIDENTIFIED_DESC @119 /* ~This ancient tome creaks as you open it.  Each page of the Book of Infinite Spells contains a spell described in layman's terms, easy enough for a thief, a cleric or even a fighter to understand and cast it.  Each spell on a page can be cast once per day.

Brandock changed the magic of the book, so now you can turn the pages back and forth - at least between the ones you opened for the original tome.

The spell on this page is:

Farsight (Divination)
Level: 4
Range: Special
Duration: 3 rounds + 1 round/level
Casting Time: 4 
Area of Effect: Special
Saving Throw: None 

When Farsight is cast, the caster is able to view an area of an unexplored map.  After casting the spell, simply click on a section of the map that you want to view.  For the duration of the spell, the caster can spy on that area, noting creatures and fortifications.~ */
SAY IDENTIFIED_DESC @119
COPY ~C#Brandock/items/c#brboA5.itm~ ~override/c#brboA5.itm~
SAY UNIDENTIFIED_DESC @120 /* ~This ancient tome creaks as you open it.  Each page of the Book of Infinite Spells contains a spell described in layman's terms, easy enough for a thief, a cleric or even a fighter to understand and cast it.  Each spell on a page can be cast once per day.

Brandock changed the magic of the book, so now you can turn the pages back and forth - at least between the ones you opened for the original tome.

The spell on this page is:

Spell Turning (Abjuration) 
Level: 7
Range: 0
Duration: 3 rounds/level
Casting Time: 7
Area of Effect: The caster 
Saving Throw: None 

This powerful abjuration spell causes the spells cast against the wizard to rebound upon the original caster.  This effects a total of 12 spell levels, for example 4 3rd-level, or 1 6th and 1 7th-level, etc..  This includes spells cast from scrolls and innate spell-like abilities, but excludes the following: area effects that are not centered directly upon the wizard as well as area effects that are stationary such as cloud kill and stinking cloud.  As long as the spell is cast directly at the wizard it will be reflected back upon the caster.  Something to note is that as long as there are levels remaining then the spell will be reflected.  For example if there is only 1 level left and a 3rd-level spell is cast at the wizard, the spell will be reflected while canceling the spell turning.  This spell will not protect the caster from dispel magic.  However it will not be affected by dispel magic either.~ */
SAY IDENTIFIED_DESC @120
COPY ~C#Brandock/items/c#brboA6.itm~ ~override/c#brboA6.itm~
SAY UNIDENTIFIED_DESC @121 /* ~This ancient tome creaks as you open it.  Each page of the Book of Infinite Spells contains a spell described in layman's terms, easy enough for a thief, a cleric or even a fighter to understand and cast it.  Each spell on a page can be cast once per day.

Brandock changed the magic of the book, so now you can turn the pages back and forth - at least between the ones you opened for the original tome.

The spell on this page is:

Wyvern Call (Conjuration/Summoning) 
Level: 6
Range: 40 yards 
Duration: 1 round/level
Casting Time: 1 round
Area of Effect: Special 
Saving Throw: None 

When this spell is cast the wizard opens up a magical channel that will summon a wyvern to his aid.  This creature will be totally under his mental control with no chance of it turning on him except, of course, through magical means like charm monster.  The creature will remain under the wizard's control, and will live and die at his command until the spell duration expires.~ */
SAY IDENTIFIED_DESC @121
COPY ~C#Brandock/items/c#brboA7.itm~ ~override/c#brboA7.itm~
SAY UNIDENTIFIED_DESC @122 /* ~This ancient tome creaks as you open it.  Each page of the Book of Infinite Spells contains a spell described in layman's terms, easy enough for a thief, a cleric or even a fighter to understand and cast it.  Each spell on a page can be cast once per day.

Brandock changed the magic of the book, so now you can turn the pages back and forth - at least between the ones you opened for the original tome.

The spell on this page is:

Stinking Cloud (Evocation) 
Level: 2
Range: 30 yards 
Duration: 1 turn
Casting Time: 2 
Area of Effect: 15-foot radius
Saving Throw: Special 

When a stinking cloud is cast, the wizard creates a billowing mass of nauseous vapors up to 30 yards away from his position. Any creature caught within the cloud must roll a successful saving throw vs. poison or be reeling and fall down for 1-2 rounds.  Those who make successful saving throws can leave the cloud without suffering any ill effects, although those remaining in the cloud must continue to save each round.  A dispel magic will remove the nasea on a particular character, but if they remain in the cloud then they are still subject to its effects.~ */
SAY IDENTIFIED_DESC @122
COPY ~C#Brandock/items/c#brboA8.itm~ ~override/c#brboA8.itm~
SAY UNIDENTIFIED_DESC @123 /* ~This ancient tome creaks as you open it.  Each page of the Book of Infinite Spells contains a spell described in layman's terms, easy enough for a thief, a cleric or even a fighter to understand and cast it.  Each spell on a page can be cast once per day.

Brandock changed the magic of the book, so now you can turn the pages back and forth - at least between the ones you opened for the original tome.

The spell on this page is:

Lightning Bolt (Evocation) 
Level: 3
Range: 40 yards + 10 yards/level
Duration: Instantaneous 
Casting Time: 3 
Area of Effect: Special 
Saving Throw: 1/2

Upon casting this spell, the wizard releases a powerful stroke of electrical energy that inflicts 1d6 points of damage per level of the spellcaster (maximum damage of 10d6) to each creature within its area of effect. A successful saving throw vs. spell reduces this damage to half (round fractions down). The bolt begins at a range and height decided by the caster and streaks outward in a direct line from the casting wizard (e.g., if a 40-foot bolt was started at 180 feet from the wizard, the far end of bolt would reach 220 feet (180 + 40).  If the lightning bolt intersects with a wall it will bounce until it reaches its full length.~ */
SAY IDENTIFIED_DESC @123
COPY ~C#Brandock/items/c#brboA9.itm~ ~override/c#brboA9.itm~
SAY UNIDENTIFIED_DESC @124 /* ~This ancient tome creaks as you open it.  Each page of the Book of Infinite Spells contains a spell described in layman's terms, easy enough for a thief, a cleric or even a fighter to understand and cast it.  Each spell on a page can be cast once per day.

Brandock changed the magic of the book, so now you can turn the pages back and forth - at least between the ones you opened for the original tome.

The spell on this page is:

Burning Hands (Alteration) 
Level: 1
Range: 5 feet  
Duration: Instantaneous 
Casting Time: 1 
Area of Effect: 60 degree arc
Saving Throw: 1/2

When the wizard casts this spell, a jet of searing flame shoots from his fingertips. His hands must be held so as to send forth a fanlike sheet of flames: the wizard's thumbs must touch each other and fingers must be spread. The burning hands send out flame jets of five-foot length in a horizontal arc of about 60 degrees in front of the wizard. Any creature in the area of the flames suffers 1d3 hit points of damage, plus 2 points for each level of the spellcaster, to a maximum of 1d3 + 20 points of fire damage. Those successfully saving vs. spell receive half damage.~ */
SAY IDENTIFIED_DESC @124

 
END //ACTION_IF GAME_IS ~tob eet bg2ee bgt~



/* "lore path": Brandock's lore will increase if he studies books */

/* spells: needed for all games */
/* Lore increasing by 1 */
COPY ~C#Brandock/spells/c#brlob1.spl~ ~override/c#brlob1.spl~ 
SAY NAME1 @21 /* ~Lore Bonus +1~ */
SAY NAME2 @21 /* ~Lore Bonus +1~ */
   LPF ALTER_SPELL_EFFECT
   INT_VAR
     match_opcode  = 139   // Display String
     parameter1    = RESOLVE_STR_REF(@24)  // 
   END

/* Lore increasing by 2 */
COPY ~C#Brandock/spells/c#brlob2.spl~ ~override/c#brlob2.spl~ 
SAY NAME1 @22 /* ~Lore Bonus +2~ */
SAY NAME2 @22 /* ~Lore Bonus +2~ */
   LPF ALTER_SPELL_EFFECT
   INT_VAR
     match_opcode  = 139   // Display String
     parameter1    = RESOLVE_STR_REF(@25)  // 
   END

/* Lore increasing by 3 */
COPY ~C#Brandock/spells/c#brlob3.spl~ ~override/c#brlob3.spl~ 
SAY NAME1 @23 /* ~Lore Bonus +3~ */
SAY NAME2 @23 /* ~Lore Bonus +3~ */
   LPF ALTER_SPELL_EFFECT
   INT_VAR
     match_opcode  = 139   // Display String
     parameter1    = RESOLVE_STR_REF(@26)  // 
   END

/* fade to black with Brandock stating that it was interesting (lore path): needed for all games */
COMPILE EVALUATE_BUFFER ~C#Brandock/scripts/c#brftb.baf~


/* transition from BG1 */

/* EET, BG:EE: Transition AFTER Korlasz' Dungeon */

ACTION_IF (GAME_IS ~bgee eet~ AND FILE_EXISTS_IN_GAME ~bd0103.are~) THEN BEGIN
  EXTEND_TOP ~bd0103.bcs~   ~C#Brandock/scripts/c#brando_sod_bd0103.baf~    EVALUATE_BUFFER
/* Brandock was dead but in party: resurrection and move to BD0010 */
  EXTEND_TOP ~bd0103.bcs~   ~C#Brandock/scripts/c#brando_bg1_transition.baf~    EVALUATE_BUFFER

/* he will say a line after Korlasz' crypt is cleared */
/* needs to be called twice: for bdimeon 53 and 54 */
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/c#brando_bg1end_sod.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/brandock_sod.tra~

/* spawn him in BD0010.are */

  EXTEND_BOTTOM ~bd0010.bcs~   ~C#Brandock/scripts/c#brando_sod_bd0010.baf~    EVALUATE_BUFFER
END


/* BGT: to BGII */

/* BGT transition */

/* Brandock leaves the group by himself before Duke Belt sends the group to Athkatla */

ACTION_IF GAME_IS ~bgt~ THEN BEGIN
  OUTER_SPRINT ~BELTBRD_or_BELT~ ~BELTBRD~
  OUTER_SPRINT ~BELTBRD12_BELT8~ ~12~
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/c#brando_bg1end_bg2.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~

/* Brandock was dead but in party: resurrection and move to C#br03.are - ++has to be compiled AFTER c#brando_bg2_ar0602.baf */
  EXTEND_TOP ~ARAM00.bcs~   ~C#Brandock/scripts/c#brando_bg1_transition.baf~    EVALUATE_BUFFER
END

/* EET: to BGII */

/* Transition to BGII: EET. this is for the case that the player skips SoD (partly or completely) in EET. Transition from normal SoD will be done after the return from Avernus via dialogue. 
This is to make sure the NPC doesn't count as "dead" if he was upon transition. */
ACTION_IF GAME_IS ~eet~ THEN BEGIN
  EXTEND_TOP ~K#TELBGT.bcs~ ~c#brandock/scripts/c#brando_direct_eet_transition.baf~ 
EVALUATE_BUFFER
END //~eet~

/* transition from SoD to BGII for EET */
/* [done] transition from SoD to BGII [done in dialogue after brandock received his letter ] */

/* detection: did player1 take Brandock's book case with him? */
ACTION_IF GAME_IS ~eet~ THEN BEGIN
  LAF extend_area_script STR_VAR area="ar0602" bottom="C#Brandock/scripts/c#brando_bg2_ar0602_eet.baf" END
END

/* failsafe in case Brandock's books were stuck in PC's inventory (because item handling doesn't really work in 7th party member mode) and player has a tweak to import all items into BGII */
ACTION_IF GAME_IS ~eet bgt~ THEN BEGIN
  LAF extend_area_script STR_VAR area="ar0603" top="C#Brandock/scripts/c#brando_bg2_ar0603.baf" END
END


/* SoD and BG1 */

/* messenger -for Brandock's letter from home and - for letter from Thalantyr */
ACTION_IF (GAME_IS ~bgee eet bgt~) THEN BEGIN
  COPY ~c#brandock/cre/c#brmess.cre~ ~override/c#brmess.cre~
WRITE_ASCII 0x2cc ~c#brmess~  #8  // dialogue
WRITE_ASCII 0x280 ~c#brmess~ #32  // death variable
WRITE_ASCII 0x280 ~c#brmess~ #32  // Override script
WRITE_BYTE 0x2c 27 // Metal color
WRITE_BYTE 0x2d 66 // Minor color
WRITE_BYTE 0x2e 59 // Major color
WRITE_BYTE 0x2f 12 // Skin color
WRITE_BYTE 0x30 16 // Leather color
WRITE_BYTE 0x31 30 // Armor color
WRITE_BYTE 0x32 41 // Hair color

END



/* SoD */
ACTION_IF (GAME_INCLUDES ~sod~) THEN BEGIN

/* items */
/* missing book page for quest "book quarrel" */
COPY_EXISTING ~bdure2a.itm~ ~override/c#brsql1.itm~
SAY NAME1 @1294 /* ~Old Torn Out Book Page~ */
SAY NAME2 @1294 /* ~Old Torn Out Book Page~ */
SAY UNIDENTIFIED_DESC @1295 /* ~This seems to be the missing page from Eldom's magic book he asked you to find. They give instructions how to enchant +3 munition by using up lower enchanted charges. 
You see hand written notes along the page, the most obvious one being "This is of *no* use without the book it's from!!!" scribbled in big letters on the top.~ */
SAY IDENTIFIED_DESC @1295

/* cres */
/* refugees for bd1000.are quest "book quarrel" */
COPY ~c#brandock/cre/c#brsqu1.cre~ ~override/c#brsqu1.cre~ //
   SAY NAME1 @1296 /* ~Mander~ */ 
   SAY NAME2 @1296 /* ~Mander~ */  
WRITE_EVALUATED_ASCII 0x280 ~c#brsqu1~ #8   // Death variable
WRITE_EVALUATED_ASCII 0x2cc ~c#brsqu1~ #8   // dialogue
WRITE_EVALUATED_ASCII 0x248 ~c#brsqu1~ #8   // Override script

COPY_EXISTING ~c#brandock/cre/c#brsqu2.cre~ ~override/c#brsqu2.cre~ //
   SAY NAME1 @1297 /* ~Eldom~ */
   SAY NAME2 @1297 /* ~Eldom~ */
WRITE_EVALUATED_ASCII 0x280 ~c#brsqu2~ #8   // Death variable
WRITE_EVALUATED_ASCII 0x2cc ~c#brsqu2~ #8   // dialogue
WRITE_EVALUATED_ASCII 0x248 ~c#brsqu2~ #8   // Override script


/* SoD: scripts */

/* quest "book quarrel" enchantment cutscene */
COMPILE EVALUATE_BUFFER ~c#brandock/scripts/c#brsquc.baf~


//Extend existing Scripts for SoD

/* quest "book quarrel" area extentions */
EXTEND_BOTTOM ~bd1000.bcs~ ~c#brandock/scripts/c#brando_sod_bd1000_quest.baf~
  EVALUATE_BUFFER
EXTEND_BOTTOM ~bd2000.bcs~ ~c#brandock/scripts/c#brando_sod_bd2000_quest.baf~
  EVALUATE_BUFFER
EXTEND_BOTTOM ~bd3000.bcs~ ~c#brandock/scripts/c#brando_sod_bd3000_quest.baf~
  EVALUATE_BUFFER
EXTEND_BOTTOM ~bd4000.bcs~ ~c#brandock/scripts/c#brando_sod_bd4000_quest.baf~
  EVALUATE_BUFFER
EXTEND_BOTTOM ~bd7100.bcs~ ~c#brandock/scripts/c#brando_sod_bd7100_quest.baf~
  EVALUATE_BUFFER
EXTEND_BOTTOM ~bdrayphu.bcs~ ~c#brandock/scripts/c#brando_sod_bdrayphu.baf~
  EVALUATE_BUFFER

/* after Korlasz is defeated: DisplayStringHead */
EXTEND_BOTTOM ~bd0120.bcs~ ~c#brandock/scripts/c#brando_sod_bd0120.baf~
  EVALUATE_BUFFER
EXTEND_BOTTOM ~bd0130.bcs~ ~c#brandock/scripts/c#brando_sod_bd0120.baf~
  EVALUATE_BUFFER

/* comment after defeating the first enemies */
EXTEND_TOP ~bd0120.bcs~ ~c#brandock/scripts/c#brando_sod_bd0120_et.baf~
  EVALUATE_BUFFER

/* Change camps if not in party */
/* Brandock is in front of Ducal Palace if told to wait */
/* or Player marches onto the battle without recruiting NPCs in Baldur' Gate: Brandock will be in front of the palace */
EXTEND_TOP ~bd0101.bcs~ ~c#brandock/scripts/c#brando_sod_bd0101.baf~
  EVALUATE_BUFFER
/* war camps */
EXTEND_TOP ~bd1000.bcs~ ~c#brandock/scripts/c#brando_sod_bd1000.baf~
  EVALUATE_BUFFER
	/* Patch your NPC's "Move Camp" variable to the original game's script block (bd1000.bcs) */
COPY_EXISTING ~bd1000.BCS~ ~override~
	DECOMPILE_AND_PATCH BEGIN
		SPRINT textToReplace ~\(SetGlobal("bd_move_npcs","bd1000",1)\)~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~\1 SetGlobal("C#Brandock_MoveCamp","bd1000",1)~ 
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
	END
BUT_ONLY
EXTEND_TOP ~bd3000.bcs~ ~c#brandock/scripts/c#brando_sod_bd3000.baf~
  EVALUATE_BUFFER
	/* Patch your NPC's "Move Camp" variable to the original game's script block (bd3000.bcs) */
COPY_EXISTING ~bd3000.BCS~ ~override~
	DECOMPILE_AND_PATCH BEGIN
		SPRINT textToReplace ~\(SetGlobal("bd_move_npcs","bd3000",1)\)~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~\1 SetGlobal("C#Brandock_MoveCamp","bd3000",1)~ 
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
		SPRINT textToReplace ~\(SetGlobal("bd_move_voghiln","bd3000",0)\)~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~\1 SetGlobal("C#Brandock_MoveCamp","bd3000",0)~ 
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
	END
BUT_ONLY
EXTEND_TOP ~bd7100.bcs~ ~c#brandock/scripts/c#brando_sod_bd7100.baf~
  EVALUATE_BUFFER
	/* Patch your NPC's "Move Camp" variable to the original game's script block (bd7100.bcs) */
COPY_EXISTING ~bd7100.BCS~ ~override~
	DECOMPILE_AND_PATCH BEGIN
		SPRINT textToReplace ~\(SetGlobal("bd_move_npcs","bd7100",1)\)~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~\1 SetGlobal("C#Brandock_MoveCamp","bd7100",1)~ 
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
	END
BUT_ONLY

/* return to camp if kicked out */
EXTEND_TOP ~bdparty.bcs~ ~c#brandock/scripts/c#brando_sod_bdparty.baf~
  EVALUATE_BUFFER

/* Brandock is kicked in hell dimension - teleport to other areas */
EXTEND_TOP ~bdcut59b.bcs~ ~c#brandock/scripts/c#brando_sod_bdcut59b.baf~
  EVALUATE_BUFFER
EXTEND_TOP ~bdcut58.bcs~ ~c#brandock/scripts/c#brando_sod_bdcut58.baf~
  EVALUATE_BUFFER

/* SoD: general game events */

/* March out of BG city: make Brandock move when the coalition start marching out of BG city */
EXTEND_TOP ~bdcut08.bcs~ ~c#brandock/scripts/c#brando_sod_bdcut08.baf~
  EVALUATE_BUFFER

/* PC gave Bridgefort Castle to the crusaders */
/* & Battle at Bridgefort starts */
EXTEND_TOP ~bd2000.bcs~ ~c#brandock/scripts/c#brando_sod_bd2000.baf~
  EVALUATE_BUFFER

/* (T3) Comment on closed vault door (to portal) in Dragonspear Castle Interior */
EXTEND_BOTTOM ~bdvaultd.bcs~ ~c#brandock/scripts/c#brando_sod_bdvaultd.baf~
EVALUATE_BUFFER

/* portal opened */
EXTEND_TOP ~bd4300.bcs~ ~c#brandock/scripts/c#brando_sod_bd4300.baf~
  EVALUATE_BUFFER

/* inside Avernus */
EXTEND_BOTTOM ~bd4400.bcs~ ~c#brandock/scripts/c#brando_sod_bd4400.baf~
  EVALUATE_BUFFER

/* Hell elevator - Brandock comments */
EXTEND_BOTTOM ~bd4601.bcs~ ~c#brandock/scripts/c#brando_sod_bd4601.baf~
  EVALUATE_BUFFER

/* Warning about tangled Wyrms */
EXTEND_BOTTOM ~bd5100aw.bcs~ ~c#brandock/scripts/c#brando_sod_bd5100aw.baf~
  EVALUATE_BUFFER

/* Fugue portal - reaction to enemies ## funktioniert das? */
EXTEND_BOTTOM ~bd5300.bcs~ ~c#brandock/scripts/c#brando_sod_bd5300.baf~
  EVALUATE_BUFFER


/* React in case crusaders in cages are killed by spikes (bd7230.are) */
//bdlever2.BCS
COPY_EXISTING ~bdlever2.BCS~ ~override~
	DECOMPILE_AND_PATCH BEGIN
		SPRINT textToReplace ~\(Kill("bdkharmy")\)~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~SetGlobal("C#Brando_SoDKillSpikes","bd7230",1) \1~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
	END
BUT_ONLY

/* React in case Morentherene is killed with a dagger (bd7210.are) */
//bdmorent.BCS
COPY_EXISTING ~bdmorent.BCS~ ~override~
	DECOMPILE_AND_PATCH BEGIN
		SPRINT textToReplace ~\(Kill(Myself)\)~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~SetGlobal("C#Brando_SoDMorenDag","MYAREA",1) \1~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
	END
BUT_ONLY

/* (T3) Comment in random area (Canyon Ambush) bd0063.are */
EXTEND_BOTTOM ~bd0063.bcs~ ~%MOD_FOLDER%/scripts/c#brando_sod_bd0063.baf~
EVALUATE_BUFFER

/* (T3) Move NPC to entrance of the Allied Siege Camp (Crusade battle) */
EXTEND_BOTTOM ~bdasc3.bcs~ ~%MOD_FOLDER%/scripts/c#brando_sod_bdasc3.baf~
  EVALUATE_BUFFER

/* (T3) Comment when battle starts in Kanaglym (bd5300.are, Underground River) */
EXTEND_BOTTOM ~bd5300.bcs~ ~%MOD_FOLDER%/scripts/c#brando_sod_bd5300_commenting.baf~
EVALUATE_BUFFER

/* Comment in Dragonspear Castle Exterior */
EXTEND_BOTTOM ~bdbark01.bcs~ ~%MOD_FOLDER%/scripts/c#brando_sod_bdbark01_commenting.baf~
EVALUATE_BUFFER


/* Move the PC in the cutscene of the plotting nobles in Three Old Kegs (bdc116d.bcs) */
EXTEND_BOTTOM ~bdc116d.bcs~ ~%MOD_FOLDER%/scripts/c#brando_sod_bdc116d.baf~
EVALUATE_BUFFER

END //SoD



/* BGII */

ACTION_IF GAME_IS ~bg2ee tob bgt eet~ THEN BEGIN

/* new BGII game or tob, bgii:ee: spawn Brandock in C#br03.are */
// happens in c#br03.baf compiled below
/* Add map note to AR0400 */
  EXTEND_BOTTOM ~AR0400.bcs~ ~C#Brandock/scripts/c#brando_bg2_ar0400.baf~ EVALUATE_BUFFER

/* Ebrel's spellbook */

COPY ~C#Brandock/items/c#br2001.itm~ ~override/c#br2001.itm~
SAY NAME1 @100 /* ~Ebrel's Spellbook~ */
SAY NAME2 @100 /* ~Ebrel's Spellbook~ */
SAY IDENTIFIED_DESC @101 /* ~This is a spellbook that belonged to one of the Cowled Wizards who were killed by Irenicus at the Promenade. The name 'Ebrel Furborrow' is written inside.~ */

/* Place Ebrel's spellbook in Waukeen's Promenade */

  EXTEND_BOTTOM ~AR0700.bcs~ ~C#Brandock/scripts/c#brando_bg2_ar0700.baf~ EVALUATE_BUFFER


END //ACTION_IF GAME_IS ~bg2ee tob bgt eet~//


/* transition to ToB */

ACTION_IF GAME_IS ~bg2ee tob bgt eet~ THEN BEGIN

  EXTEND_BOTTOM ~AR4000.bcs~ ~C#Brandock/scripts/c#brando_bg2_ar4000.baf~ EVALUATE_BUFFER


  EXTEND_BOTTOM ~AR4500.bcs~ ~C#Brandock/scripts/c#brando_bg2_ar4500.baf~ EVALUATE_BUFFER

END


/* other BGII content */

ACTION_IF GAME_IS ~bg2ee tob bgt eet~ BEGIN

/* Give the Homeless Woman in AR0400 (Slums) a unique DV: */
COPY_EXISTING ~HOMELESS.CRE~ ~override/HOMELESS.CRE~
WRITE_EVALUATED_ASCII 0x280 ~HOMELESS~ #32 // script name / DV

/* Give the Landlord in AR0400 (Slums) a unique DV: */
COPY_EXISTING ~LANDLORD.CRE~ ~override/LANDLORD.CRE~
WRITE_EVALUATED_ASCII 0x280 ~LANDLORD~ #32 // script name / DV

//  epilogues:
EXTEND_TOP ~AR6200.bcs~ ~C#Brandock/scripts/epilog_AR6200.baf~

/* ToB Epilogue - one for now */
COPY ~C#Brandock/2da/c#brepxx.2da~ ~override/c#brep01.2da~
REPLACE ~99999~ @90000

END //GAME_IS ~bg2ee tob bgt eet~


/* +++++ PID - compile as last .d-file +++++ */


ACTION_IF GAME_IS ~bgee~ THEN BEGIN
	COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/c#brandj_PID.d~
		~C#Brandock/dialogue/c#brandj_PID_bg1.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brandj_PID.tra~
END
ACTION_IF (GAME_IS ~bg2ee tob~ AND !GAME_IS ~bgt~) THEN BEGIN
	COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/c#brandj_PID.d~
		~C#Brandock/dialogue/c#brandj_PID_bg2.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brandj_PID.tra~
END
ACTION_IF GAME_IS ~bgt eet~ THEN BEGIN
	COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/c#brandj_PID.d~
		~C#Brandock/dialogue/c#brandj_PID_bg2.d~
		~C#Brandock/dialogue/c#brandj_PID_bg1.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brandj_PID.tra~
END



/* +++++ areas and area modifications +++++ */


/* areas */

/* BG1 */

ACTION_IF GAME_IS ~bgee bgt eet~ THEN BEGIN
  COPY ~C#Brandock/areas/bg1/c#br01~ ~Override~	

/* entrance & exit */

COPY_EXISTING ~c#br01.are~ ~override~
  LAUNCH_PATCH_FUNCTION  ~fj_are_structure~
    INT_VAR
    fj_type         = 2    //travel
    fj_box_left     = 113  //kleinstes x
    fj_box_top      = 545  //kleinstes y
    fj_box_right    = 236  //größtes x
    fj_box_bottom   = 638   //größtes y
    fj_cursor_idx   = 30   //door
    fj_vertex_0     = 113 + (545 << 16)   //kleinstes x +  kleinstes y
    fj_vertex_1     = 236 + (545 << 16)   //größtes x + kleinstes y
    fj_vertex_2     = 236 + (638 << 16)   //größtes x + größtes y
    fj_vertex_3     = 113 + (638 << 16)   //kleinstes x + größtes y
    STR_VAR
    fj_structure_type   = region
    fj_name             = c#br01Ex
    fj_destination_area = EVAL ~%CoastWay%~
    fj_destination_name = c#br01Ex
  END


//trigger point with script
  LPF ~fj_are_structure~
    INT_VAR
    fj_type         = 1    //trigger
    fj_box_left    = 160
    fj_box_top     = 200
    fj_box_right   = 220
    fj_box_bottom  = 228
    fj_cursor_idx   = 2  //"take something"
    fj_vertex_0    = 160 + (215 << 16) //I don't need that many vertexes because the area does not get highlighted by "tab"
    fj_vertex_1    = 170 + (200 << 16)
    fj_vertex_2    = 175 + (200 << 16)
    fj_vertex_3    = 220 + (202 << 16)
    fj_vertex_4    = 220 + (215 << 16)
    fj_vertex_5    = 195 + (225 << 16)
    fj_vertex_6    = 170 + (228 << 16)
    fj_vertex_7    = 160 + (215 << 16)
    STR_VAR
    fj_structure_type   = region
    fj_name             = c#brpile
    fj_reg_script   = c#brpile
  END
BUT_ONLY

COPY ~C#Brandock/areas/bg1/c#br02~ ~Override~	

/* entrance & exit */

COPY_EXISTING ~c#br02.are~ ~override~
  LAUNCH_PATCH_FUNCTION  ~fj_are_structure~
    INT_VAR
    fj_type         = 2    //travel
    fj_box_left     = 409  //kleinstes x
    fj_box_top      = 276  //kleinstes y
    fj_box_right    = 619  //größtes x
    fj_box_bottom   = 424   //größtes y
    fj_cursor_idx   = 30   //door
    fj_vertex_0     = 409 + (379 << 16)   //kleinstes x +  kleinstes y
    fj_vertex_1     = 557 + (276 << 16)   //größtes x + kleinstes y
    fj_vertex_2     = 619 + (324 << 16)   //größtes x + größtes y
    fj_vertex_3     = 468 + (424 << 16)   //kleinstes x + größtes y
    STR_VAR
    fj_structure_type   = region
    fj_name             = ExAR2619
    fj_destination_area = EVAL ~%Candlekeep_Catacombs_L2%~
    fj_destination_name = EVAL ~%Exit5506%~ //Exit6560 (BGT) Exit5506 (BG:EE/EET)
  END
  LAUNCH_PATCH_FUNCTION  ~fj_are_structure~
    INT_VAR
    fj_type         = 2    //travel
    fj_box_left     = 83  //kleinstes x
    fj_box_top      = 39  //kleinstes y
    fj_box_right    = 239  //größtes x
    fj_box_bottom   = 153   //größtes y
    fj_cursor_idx   = 30   //door
    fj_vertex_0     = 117 + (153 << 16)   //kleinstes x +  kleinstes y
    fj_vertex_1     = 239 + (71 << 16)   //größtes x + kleinstes y
    fj_vertex_2     = 199 + (39 << 16)   //größtes x + größtes y
    fj_vertex_3     = 83 + (115 << 16)   //kleinstes x + größtes y
    STR_VAR
    fj_structure_type   = region
    fj_name             = ExAR5506
    fj_destination_area = EVAL ~%CandlekeepCaves%~
    fj_destination_name = EVAL ~%Exit2619%~ //Exit6519 (BGT) Exit2619 (BG:EE/EET)
  END
  LAUNCH_PATCH_FUNCTION  ~fj_are_structure~
    INT_VAR
    fj_loc_x       = 429    //x
    fj_loc_y       = 289   //y
    fj_orientation = 6
    STR_VAR
    fj_structure_type = entrance
    fj_name           = Exit2619
  END
  LAUNCH_PATCH_FUNCTION  ~fj_are_structure~
    INT_VAR
    fj_loc_x       = 236    //x
    fj_loc_y       = 153   //y
    fj_orientation = 14
    STR_VAR
    fj_structure_type = entrance
    fj_name           = Exit5506
  END
BUT_ONLY

  ACTION_IF NOT FILE_EXISTS_IN_GAME ~c#thal.are~ THEN BEGIN
    COPY ~C#Brandock/areas/bg1/c#thal/areafiles~ ~Override~
    ACTION_IF GAME_IS ~bgt~ THEN BEGIN
      COPY ~C#Brandock/areas/bg1/c#thal/tis_bg2~ ~Override~
    END
    ACTION_IF GAME_IS ~bgee eet~ THEN BEGIN
      COPY ~C#Brandock/areas/bg1/c#thal/tis_ee~ ~Override~
    END
  END
END

/* adaption of tis-name (in the wed-file) for BGT & EET */
ACTION_IF GAME_IS ~bgt eet~ THEN BEGIN
 COPY_EXISTING ~c#br01.wed~ ~override~
        SPRINT tis_name "%GnollStronghold_XvartCave%"
        READ_LONG 16 overlay_off
        WRITE_ASCIIE overlay_off + 0 + 4 ~%tis_name%~ (8)
END

/* MOS-files for bgt */
ACTION_IF GAME_IS ~bgt~ BEGIN
  COPY ~C#Brandock/areas/mos_bgt/c#br01.MOS~ ~Override/c#br01.MOS~
  COPY ~C#Brandock/areas/mos_bgt/c#br01.MOS~ ~Override/c#br02.MOS~
  COPY ~C#Brandock/areas/mos_bgt/c#thal.MOS~ ~Override/c#thal.MOS~
END

/* area modifications - BG1 */

ACTION_IF GAME_IS ~bgee bgt eet~ THEN BEGIN

/* add entrance to cave  */


COPY_EXISTING ~%CoastWay%.are~ ~override~
  LAUNCH_PATCH_FUNCTION  ~fj_are_structure~
    INT_VAR
    fj_type         = 2    //travel
    fj_box_left     = 4500  //kleinstes x
    fj_box_top      = 1400  //kleinstes y
    fj_box_right    = 4670  //größtes x
    fj_box_bottom   = 1565   //größtes y
    fj_cursor_idx   = 30   //door
    fj_vertex_0     = 4500 + (1400 << 16)   //kleinstes x +  kleinstes y
    fj_vertex_1     = 4670 + (1400 << 16)   //größtes x + kleinstes y
    fj_vertex_2     = 4670 + (1565 << 16)   //größtes x + größtes y
    fj_vertex_3     = 4500 + (1565 << 16)   //kleinstes x + größtes y
    STR_VAR
    fj_structure_type   = region
    fj_name             = c#br01Tr
    fj_destination_area = c#br01
    fj_destination_name = c#br01En
  END


  LAUNCH_PATCH_FUNCTION  ~fj_are_structure~
    INT_VAR
    fj_loc_x       = 4570    //x
    fj_loc_y       = 1575   //y
    fj_orientation = 0   //S
    STR_VAR
    fj_structure_type = entrance
    fj_name           = c#br01Ex
  END
BUT_ONLY


/* add detection proximity trigger */
/* this is the CELLDOOR info trigger from BG:EE. I just used the same coodinates because it's as good as any. */
//proximity trigger
COPY_EXISTING ~%SWBaldursGate_FlamingFistHQ_L1%.are~ ~override~
  LPF ~fj_are_structure~
    INT_VAR
    fj_type         = 0    //proximity trigger
    fj_box_left    = 1382
    fj_box_top     = 215
    fj_box_right   = 1425
    fj_box_bottom  = 276
    fj_vertex_0    = 1382 + (270 << 16) 
    fj_vertex_1    = 1425 + (276 << 16)
    fj_vertex_2    = 1425 + (222 << 16)
    fj_vertex_3    = 1382 + (215 << 16)
    STR_VAR
    fj_structure_type   = region
    fj_name             = c#celldoor
  END
BUT_ONLY

/* add new travel region to catacombs L2 */
COPY_EXISTING ~%Candlekeep_Catacombs_L2%.are~ ~override~
  LAUNCH_PATCH_FUNCTION  ~fj_are_structure~
    INT_VAR
    fj_type         = 2    //travel
    fj_box_left     = 77  //kleinstes x
    fj_box_top      = 882  //kleinstes y
    fj_box_right    = 246  //größtes x
    fj_box_bottom   = 1088   //größtes y
    fj_cursor_idx   = 30   //door
    fj_vertex_0     = 246 + (965 << 16)   
    fj_vertex_1     = 77 + (1088 << 16)   
    fj_vertex_2     = 77 + (992 << 16)   
    fj_vertex_3     = 129 + (959 << 16)   
    fj_vertex_4     = 246 + (882 << 16)   
    STR_VAR
    fj_structure_type   = region
    fj_name             = c#br02Ex
    fj_destination_area = c#br02
    fj_destination_name = Exit2619
  END
BUT_ONLY

/* add new travel region to candlekeep cave */
COPY_EXISTING ~%CandlekeepCaves%.are~ ~override~
  LAUNCH_PATCH_FUNCTION  ~fj_are_structure~
    INT_VAR
    fj_type         = 2    //travel
    fj_box_left     = 655  //kleinstes x
    fj_box_top      = 44  //kleinstes y
    fj_box_right    = 722  //größtes x
    fj_box_bottom   = 103   //größtes y
    fj_cursor_idx   = 30   //door
    fj_vertex_0     = 669 + (44 << 16)   
    fj_vertex_1     = 655 + (44 << 16)   
    fj_vertex_2     = 655 + (103 << 16)   
    fj_vertex_3     = 722 + (103 << 16)    
    fj_vertex_4     = 722 + (44 << 16)   
    STR_VAR
    fj_structure_type   = region
    fj_name             = c#br02Ex
    fj_destination_area = c#br02
    fj_destination_name = Exit5506
  END
BUT_ONLY

/* add info trigger to Elvenhair's desk */
//trigger point with script
COPY_EXISTING ~%Beregost_FirebeadsHouse_L1%.are~ ~override~
  LPF ~fj_are_structure~
    INT_VAR
    fj_type         = 1    //trigger
    fj_box_left    = 144
    fj_box_top     = 345
    fj_box_right   = 238
    fj_box_bottom  = 414
    fj_cursor_idx   = 22
    fj_vertex_0    = 188 + (413 << 16)
    fj_vertex_1    = 206 + (414 << 16)
    fj_vertex_2    = 238 + (393 << 16)
    fj_vertex_3    = 187 + (345 << 16)
    fj_vertex_4    = 144 + (368 << 16)
    STR_VAR
    fj_structure_type   = region
    fj_name             = c#brdesk
    fj_reg_script   = c#bredsk
  END
BUT_ONLY

END //ACTION_IF GAME_IS ~bgee bgt eet~ THEN BEGIN


/* areas - BGII */

ACTION_IF GAME_IS ~bg2ee tob bgt eet~ THEN BEGIN
COPY ~C#Brandock/areas/bg2~ ~Override~

/* mos */
ACTION_IF GAME_IS ~tob bgt~ BEGIN
  COPY ~C#Brandock/areas/mos_bgt/c#br03.MOS~ ~Override/c#br03.MOS~
END

COMPILE ~C#Brandock/scripts/c#br03.baf~ EVALUATE_BUFFER
COMPILE ~C#Brandock/scripts/c#br03ip.baf~

/* add entrance to brandock's cousin's house to AR0400 slums */

COPY_EXISTING ~AR0400.are~ ~override~ 
  LAUNCH_PATCH_FUNCTION  ~fj_are_structure~
    INT_VAR
    fj_type         = 2    //travel
    fj_box_left     = 35  //kleinstes x
    fj_box_top      = 1100  //kleinstes y
    fj_box_right    = 130  //größtes x
    fj_box_bottom   = 1250   //größtes y
    fj_cursor_idx   = 30   //door
    fj_vertex_0     = 35 + (1100 << 16)   //kleinstes x +  kleinstes y
    fj_vertex_1     = 130 + (1100 << 16)   //größtes x + kleinstes y
    fj_vertex_2     = 130 + (1250 << 16)   //größtes x + größtes y
    fj_vertex_3     = 35 + (1250 << 16)   //kleinstes x + größtes y
    STR_VAR
    fj_structure_type   = region
    fj_name             = c#br03Tr
    fj_destination_area = c#br03
    fj_destination_name = C#br03en
  END

/* add entrance from C#BR03 to AR0400.are */
  LAUNCH_PATCH_FUNCTION  ~fj_are_structure~
    INT_VAR
    fj_loc_x       = 195    //x
    fj_loc_y       = 1175   //y
    fj_orientation = 12   //O
    STR_VAR
    fj_structure_type = entrance
    fj_name           = c#br03Ex
  END
BUT_ONLY


/* Waukeens Promenade - create "container" and put Ebrel's ring inside */


COPY_EXISTING ~AR0700.ARE~ ~override~
  LPF fj_are_structure
  INT_VAR
    fj_loc_x          = 2455
    fj_loc_y          = 900
    fj_type           = 8         // non-visible
    fj_box_left       = 2445
    fj_box_top        = 881
    fj_box_right      = 2469
    fj_box_bottom     = 910
    fj_vertex_0       = 2462 | (910 << 16)
    fj_vertex_1       = 2445 | (893 << 16)
    fj_vertex_2       = 2448 | (886 << 16)
    fj_vertex_3       = 2456 | (889 << 16)
    fj_vertex_4       = 2462 | (881 << 16)
    fj_vertex_5       = 2469 | (888 << 16)
    fj_vertex_6       = 2464 | (898 << 16)
    fj_vertex_7       = 2467 | (908 << 16)
  STR_VAR
    fj_structure_type = "container"
    fj_name           = "C#Rubble"
  END




END //~bg2ee tob bgt eet~



/* +++++ Brandock cre things +++++ */

/* sounds */

ACTION_IF FILE_EXISTS ~c#brandock/sounds/%LANGUAGE%/c#bran01.ogg~ THEN BEGIN
  LAF HANDLE_AUDIO 
	STR_VAR audio_path = EVAL ~c#brandock/sounds/%LANGUAGE%~ 
		oggdec_path = ~c#brandock/sounds~ 
		sox_path = ~c#brandock/sounds~ END 
END

ACTION_IF FILE_EXISTS ~C#Brandock/sounds/%LANGUAGE%/c#bran01.wav~ THEN BEGIN
  COPY ~C#Brandock/sounds/%LANGUAGE%~ ~override~
END 

ACTION_IF NOT FILE_EXISTS ~c#brandock/sounds/%LANGUAGE%/c#bran01.ogg~ AND
NOT FILE_EXISTS ~C#Brandock/sounds/%LANGUAGE%/c#bran01.wav~ THEN BEGIN
  LAF HANDLE_AUDIO 
	STR_VAR audio_path = EVAL ~c#brandock/sounds/english~ 
		oggdec_path = ~c#brandock/sounds~ 
		sox_path = ~c#brandock/sounds~ END 
END

// use new macro to handle all audio installation


/* mute Brandock's "start dialogue" sound */
  COPY ~C#Brandock/Sounds/C#ABLANK.wav~ ~override~

/* Default Portrait */

ACTION_IF GAME_IS ~bg2 tob bgt~ BEGIN

COPY ~C#Brandock/Portrait/bg2/C#BrandL.bmp~ ~override~
COPY ~C#Brandock/Portrait/bg2/C#BrandM.bmp~ ~override~
COPY ~C#Brandock/Portrait/bg2/C#BrandS.bmp~ ~override~

END

ACTION_IF GAME_IS ~bgee~ BEGIN

COPY ~C#Brandock/Portrait/bgee/C#BrandL.bmp~ ~override~
COPY ~C#Brandock/Portrait/bgee/C#BrandM.bmp~ ~override/C#BrandM.bmp~
COPY ~C#Brandock/Portrait/bgee/C#BrandM.bmp~ ~override/C#BrandS.bmp~

END

ACTION_IF GAME_IS ~bg2ee eet~ BEGIN

COPY ~C#Brandock/Portrait/bg2ee/C#BrandL.bmp~ ~override~
COPY ~C#Brandock/Portrait/bg2ee/C#BrandM.bmp~ ~override/C#BrandM.bmp~
COPY ~C#Brandock/Portrait/bg2ee/C#BrandM.bmp~ ~override/C#BrandS.bmp~

END

/* cres */
/* all cres are level one but get XP according to the PC's level.
c#bran01.cre is for BG1
c#bran02.cre is for a new SoD game and knows more spells
*/

COPY 	~C#Brandock/Cre/c#bran01.cre~ ~override/c#bran01.cre~
SAY NAME1 @500 /* ~Brandock~ */
SAY NAME2 @500 /* ~Brandock~ */
SAY MORALE @501 /* ~~ [c#bran01] */
SAY HAPPY @502 /* ~~ */
SAY UNHAPPY_ANNOYED @503 /* ~~ [c#bran21] */
SAY UNHAPPY_SERIOUS @504 /* ~~ [c#bran26] */
SAY UNHAPPY_BREAKING @505 /* ~~ [c#bran02] */ 
SAY LEADER @506 /* ~~ [c#bran08] */
SAY TIRED @507 /* ~~ [c#bran09] */  
SAY BORED @508 /* ~~ [c#bran10] */
SAY BATTLE_CRY1 @509 /* ~~ [c#bran03] */  
SAY BATTLE_CRY2 @510 /* ~~ [c#bran05] */ 
SAY BATTLE_CRY3 @511 /* ~~ [c#bran06] */ 
SAY BATTLE_CRY4 @512 /* ~~ [c#bran07] */  
SAY BATTLE_CRY5 @513 /* ~~ [c#bran04] */
SAY DAMAGE @514 /* ~~ [c#bran25] */
SAY DYING @515 /* ~~ [c#bran22] */
SAY HURT @516 /* ~~ [c#bran24] */  
SAY AREA_FOREST @517 /* ~Ich liebe den Duft von Moos und Kiefernadeln.~ [c#bran28] */
SAY AREA_CITY @518 /* ~In der Stadt sind immer so viele Leute auf einem Haufen!~ [c#bran29] */  
SAY AREA_DUNGEON @519 /* ~Irgendwie ist es hier unheimlich.~ [c#bran30] */ 
SAY AREA_DAY @520 /* ~Ich mag es, wenn die Sonne scheint! Außer direkt in mein Gesicht, natürlich.~ [c#bran31] */ 
SAY AREA_NIGHT @521 /* ~Nachts ist es immer so... dunkel.~ [c#bran32] */ 
SAY SELECT_COMMON1 @522 /* ~~ [c#bran11] */  
SAY SELECT_COMMON2 @523 /* ~~ [c#bran12] */  
SAY SELECT_COMMON3 @524 /* ~~ [c#bran14] */
SAY SELECT_COMMON4 @534 /* ~M-hm?~ [c#bran33] */  
SAY SELECT_COMMON5 @535 /* ~Ich höre?~ [c#bran34] */  
SAY SELECT_COMMON6 @536 /* ~[als freundliche Aufforderung] Sagt, was Ihr wollt!~ [c#bran35] */
SAY SELECT_ACTION1 @525 /* ~~ [c#bran15] */ 
SAY SELECT_ACTION2 @526 /* ~~ [c#bran13] */ 
SAY SELECT_ACTION3 @527 /* ~~ [c#bran16] */ 
SAY SELECT_ACTION4 @528 /* ~~ [c#bran17] */  
SAY SELECT_ACTION5 @529 /* ~~ [c#bran18] */  
SAY SELECT_ACTION6 @530 /* ~~ [c#bran19] */  
SAY SELECT_ACTION7 @531 /* ~~ [c#bran20] */  
SAY REACT_TO_DIE_GENERAL @532 /* ~~ [c#bran23] */ 
SAY SELECT_RARE1 @537 /* ~Bei den Göttern! Erschreckt mich doch nicht so! Was wollt Ihr?~ [c#bran36] */ 
SAY CRITICAL_HIT @538 /* ~[triumphierend] Ja!!~ [c#bran37] */ 
SAY CRITICAL_MISS @539 /* ~Verdammt, daneben!~ [c#bran38] */ 
SAY TARGET_IMMUNE @540 /* ~Meine Waffe scheint nichts zu bewirken.~ [c#bran39] */ 
SAY INVENTORY_FULL @541 /* ~[entschuldigend] Tut mir Leid, aber das passte wirklich nicht mehr in meine Tasche.~ [c#bran40] */ 
SAY SPELL_DISRUPTED @542 /* ~Ach, Mist! Jetzt bin ich rausgekommen.~ [c#bran41] */ 
SAY BIO @533 /* ~When asked about his past, BRANDOCK DEEPWATER smiles apologetically and talks about his plans to become an acknowledged wizard. "There is not much to know about me", he adds. "I come from a normal family of farmers and carpenters - no magic talent, except for some distant mother's cousin."~ */

ADD_KNOWN_SPELL ~SPWI210~ #1 ~wizard~ //Resist Fear
ADD_KNOWN_SPELL ~SPWI212~ #1 ~wizard~ //Mirror Image
ADD_KNOWN_SPELL ~SPWI116~ #0 ~wizard~ //Sleep



ACTION_IF (GAME_IS ~bgee eet~ AND FILE_EXISTS_IN_GAME ~bd0103.are~) THEN BEGIN
/* c#bran02.cre is for a new SoD start: more spells memorized */
COPY_EXISTING ~c#bran01.CRE~ ~override/c#bran02.cre~
  ADD_KNOWN_SPELL ~SPWI106~ #0 ~wizard~ //Blindness
  ADD_KNOWN_SPELL ~SPWI114~ #0 ~wizard~ //Shield
  ADD_KNOWN_SPELL ~SPWI201~ #1 ~wizard~ //Blurr
  ADD_KNOWN_SPELL ~SPWI205~ #1 ~wizard~ //Horror
  ADD_KNOWN_SPELL ~SPWI207~ #1 ~wizard~ //Knock
  ADD_KNOWN_SPELL ~SPWI215~ #1 ~wizard~ //Web
  ADD_KNOWN_SPELL ~SPWI304~ #2 ~wizard~ //Fireball
  ADD_KNOWN_SPELL ~SPWI305~ #2 ~wizard~ //Haste
  ADD_KNOWN_SPELL ~SPWI309~ #2 ~wizard~ //Monster Summoning
  ADD_KNOWN_SPELL ~SPWI311~ #2 ~wizard~ //Protection from normal missiles
  ADD_KNOWN_SPELL ~SPWI326~ #2 ~wizard~ //Dispel Magic
  ADD_KNOWN_SPELL ~SPWI405~ #3 ~wizard~ //Improved Invisibility
  ADD_KNOWN_SPELL ~SPWI406~ #3 ~wizard~ //Minor Globe of Invulnerability
  ADD_KNOWN_SPELL ~SPWI407~ #3 ~wizard~ //Monster Summoning II
  ADD_KNOWN_SPELL ~SPWI408~ #3 ~wizard~ //Stoneskin
  ADD_KNOWN_SPELL ~SPWI502~ #4 ~wizard~ //Cloudkill
  ADD_KNOWN_SPELL ~SPWI513~ #4 ~wizard~ //Breach
  ADD_KNOWN_SPELL ~SPWI519~ #4 ~wizard~ //Spell Shield

/* items: */
  ADD_CRE_ITEM ~clck09~ #0 #0 #0 ~IDENTIFIED~ ~ARMOR~
//  ADD_CRE_ITEM ~C#BR0004~ #0 #0 #0 ~IDENTIFIED~ ~CLOAK~
  ADD_CRE_ITEM ~STAF02~ #0 #0 #0 ~IDENTIFIED~ ~weapon1~
  ADD_CRE_ITEM ~SLNG02~ #0 #0 #0 ~IDENTIFIED~ ~weapon2~ EQUIP
  ADD_CRE_ITEM ~BULL02~ #40 #0 #0 ~IDENTIFIED~ ~quiver1~
  ADD_CRE_ITEM ~BULL02~ #40 #0 #0 ~IDENTIFIED~ ~quiver2~
BUT_ONLY_IF_IT_CHANGES
END

ACTION_IF GAME_IS ~tob bgt bg2ee eet~ BEGIN
/* c#bran03.cre is for a new SoA start: more spells memorized */
COPY_EXISTING ~c#bran01.CRE~ ~override/c#bran03.cre~
  ADD_KNOWN_SPELL ~SPWI106~ #0 ~wizard~ //Blindness
  ADD_KNOWN_SPELL ~SPWI114~ #0 ~wizard~ //Shield
  ADD_KNOWN_SPELL ~SPWI201~ #1 ~wizard~ //Blurr
  ADD_KNOWN_SPELL ~SPWI205~ #1 ~wizard~ //Horror
  ADD_KNOWN_SPELL ~SPWI207~ #1 ~wizard~ //Knock
  ADD_KNOWN_SPELL ~SPWI215~ #1 ~wizard~ //Web
  ADD_KNOWN_SPELL ~SPWI304~ #2 ~wizard~ //Fireball
  ADD_KNOWN_SPELL ~SPWI305~ #2 ~wizard~ //Haste
  ADD_KNOWN_SPELL ~SPWI309~ #2 ~wizard~ //Monster Summoning
  ADD_KNOWN_SPELL ~SPWI311~ #2 ~wizard~ //Protection from normal missiles
  ADD_KNOWN_SPELL ~SPWI326~ #2 ~wizard~ //Dispel Magic
  ADD_KNOWN_SPELL ~SPWI405~ #3 ~wizard~ //Improved Invisibility
  ADD_KNOWN_SPELL ~SPWI406~ #3 ~wizard~ //Minor Globe of Invulnerability
  ADD_KNOWN_SPELL ~SPWI407~ #3 ~wizard~ //Monster Summoning II
  ADD_KNOWN_SPELL ~SPWI408~ #3 ~wizard~ //Stoneskin
  ADD_KNOWN_SPELL ~SPWI502~ #4 ~wizard~ //Cloudkill
  ADD_KNOWN_SPELL ~SPWI513~ #4 ~wizard~ //Breach
  ADD_KNOWN_SPELL ~SPWI519~ #4 ~wizard~ //Spell Shield

  ADD_KNOWN_SPELL ~SPWI308~ #2 ~wizard~ //Lightning Bolt
  ADD_KNOWN_SPELL ~SPWI312~ #2 ~wizard~ //Slow
  ADD_KNOWN_SPELL ~SPWI418~ #3 ~wizard~ //Fire Shield (Red)
  ADD_KNOWN_SPELL ~SPWI505~ #4 ~wizard~ //Shadow Door
  ADD_KNOWN_SPELL ~SPWI508~ #4 ~wizard~ //Chaos
  ADD_KNOWN_SPELL ~SPWI607~ #5 ~wizard~ //Mislead
  ADD_KNOWN_SPELL ~SPWI609~ #5 ~wizard~ //True Sight
  ADD_KNOWN_SPELL ~SPWI625~ #5 ~wizard~ //Stone To Flesh
  ADD_KNOWN_SPELL ~SPWI703~ #6 ~wizard~ //Project Image

/* items: */
  ADD_CRE_ITEM ~CLCK13~ #0 #0 #0 ~IDENTIFIED~ ~ARMOR~
//  ADD_CRE_ITEM ~C#BR0004~ #0 #0 #0 ~IDENTIFIED~ ~CLOAK~
  ADD_CRE_ITEM ~STAF02~ #0 #0 #0 ~IDENTIFIED~ ~weapon1~
  ADD_CRE_ITEM ~SLNG02~ #0 #0 #0 ~IDENTIFIED~ ~weapon2~ EQUIP
  ADD_CRE_ITEM ~BULL02~ #40 #0 #0 ~IDENTIFIED~ ~quiver1~
  ADD_CRE_ITEM ~BULL02~ #40 #0 #0 ~IDENTIFIED~ ~quiver2~
  ADD_CRE_ITEM ~BULL03~ #40 #0 #0 ~IDENTIFIED~ ~quiver3~
BUT_ONLY_IF_IT_CHANGES
END


/* give items to BG1 cre - needs to be done here so the items are not on the SoD + BGII cres, too */

ACTION_IF GAME_IS ~bgee eet bgt~ BEGIN
COPY_EXISTING ~c#bran01.CRE~ ~override~
/* items: */
  ADD_CRE_ITEM ~STAF01~ #0 #0 #0 ~IDENTIFIED~ ~weapon1~
  ADD_CRE_ITEM ~SLNG01~ #0 #0 #0 ~IDENTIFIED~ ~weapon2~ EQUIP
  ADD_CRE_ITEM ~BULL01~ #40 #0 #0 ~IDENTIFIED~ ~quiver1~
  ADD_CRE_ITEM ~BULL01~ #40 #0 #0 ~IDENTIFIED~ ~quiver2~
  ADD_CRE_ITEM ~BULL01~ #40 #0 #0 ~IDENTIFIED~ ~quiver3~
  ADD_CRE_ITEM ~c#br0003~ #1 #0 #0 ~IDENTIFIED~ ~inv1~
BUT_ONLY_IF_IT_CHANGES
END


/* extras needed for 7th party member mode */
INCLUDE ~%MOD_FOLDER%/7thpmm/c#7thpmm_thingies.tpa~


///////////////////////////////////////////////////////////////
/* Crossmod */
//////////////////////////////////////////////////////////////

BEGIN @55579 /* ~Brandock the Mage: Crossmod Content~ */ DESIGNATED 10 
LABEL BrandockTheMage-Crossmod
REQUIRE_COMPONENT ~c#brandock.tp2~ ~0~ @55543

/* EndlessBG1 - handled individually */
ACTION_IF (GAME_INCLUDES ~sod~ AND MOD_IS_INSTALLED ~c#endlessbg1.tp2~ ~0~) BEGIN 
PRINT @55580 /* ~EndlessBG1 detected.~ */

/* direct transition to BGII */
// Get state @8 for BELT %BELTBRD12_BELT8% 
/* ~I see. Still, the city is in your debt. Fare well, Hero of Baldur's Gate.~ */
  OUTER_SET BELTBRD12_BELT8 = STATE_WHICH_SAYS 8 IN ~c#endlessbg1/translations/%s/DIALOGUES.TRA~ FROM ~BELT~
  OUTER_SPRINT ~BELTBRD_or_BELT~ ~BELT~
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/c#brando_bg1end_bg2.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/c#brand_dialogues.tra~

/* transition to SoD for "Korlasz Tomb is in BG1" */
ACTION_IF (MOD_IS_INSTALLED ~c#endlessbg1.tp2~ ~14~) BEGIN
// Get state @215 for BELT %belt_ebg1_215%
/* @215 /* ~A well earned rest. Make yourself at home on the top floor of the palace as much as you like.~ */ */
  OUTER_SET belt_ebg1_215 = STATE_WHICH_SAYS 215 IN ~c#endlessbg1/translations/%s/DIALOGUES.TRA~ FROM ~BELT~
  COMPILE EVALUATE_BUFFER ~C#Brandock/dialogue/c#brando_bg1end_sod.d~
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/brandock_sod.tra~
<<<<<<<< ...inlined/ebg1_goodbye_sod.d
I_C_T BELT %belt_ebg1_215% C#Brandock_BG1Leaving
== C#BrandJ IF ~OR(2) InParty("C#Brandock") Global("C#BrandockJoined","GLOBAL",2)
	InMyArea("C#Brandock") 
!StateCheck("C#Brandock",CD_STATE_NOTVALID)
/* remain silent in case possessions weren't collected */
GlobalGT("C#Brandock_Possessions","GLOBAL",0)~ THEN @3 /* ~<CHARNAME>, I think this is a good time to say good bye. We both reached our goals. Sarevok is stopped, and I learned a lot about wielding magic... I will stay in the region and continue to study the De Simplex Magicae with Master Elvenhair's help. I'll come and visit you before I'll return home for good. It should be easy to find you - hero of Baldur's Gate!~ */ 
END
>>>>>>>>
COMPILE EVALUATE_BUFFER ~...inlined/ebg1_goodbye_sod.d~ USING ~C#Brandock/tra/autotra/%LANGUAGE%/brandock_sod.tra~
END //~c#endlessbg1.tp2~ ~14~

END /* EndlessBG1 */


/* BG1 */

ACTION_IF GAME_IS ~bgee eet bgt~ THEN BEGIN

/* Ascalon's Breagar */
ACTION_IF FILE_EXISTS_IN_GAME ~ACBREB.dlg~ THEN BEGIN 
PRINT @55555 /* ~Breagar detected.~ */

// Get state for ACBREJ %ACBREJ_270% 
/* @270 = ~Whatever. The iron deposits are far from being depleted and if our enemies have found a way to extract the Orothiar deposits, they sit on virtually unlimited iron ore.~ */
OUTER_SET ACBREJ_270 = STATE_WHICH_SAYS 270 IN ~ACBre/tra/autotra/%s/acarea.tra~ FROM ~ACBREJ~

  COMPILE EVALUATE_BUFFER ~c#brandock/crossmod/brando_crossmod_breagar.d~ 
  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/crossmod/brando_crossmod_breagar_bg1.baf~
END 

/* Ascalon's Questpack */
/* The Great Karlini (Ygnazius Bombastus III) */
ACTION_IF FILE_EXISTS_IN_GAME ~ACQ17001.dlg~ THEN BEGIN 
PRINT @55556 /* ~Ascalon's Questpack: Der große Karlini detected.~ */
// Get state for Ygnazius ACQ17001 %ygnatz_47% 
/* ~That's to my liking, my liking! Let's waste no more time and whooshy-whooshy set off! The Ulcaster Ruins are waiting!~ */
OUTER_SET ygnatz_47 = STATE_WHICH_SAYS 47 IN ~AC_QUEST/tra/autotra/%s/ACQ17000.tra~ FROM ~ACQ17001~
  COMPILE EVALUATE_BUFFER ~c#brandock/crossmod/brando_crossmod_ac_quest_17.d~ USING ~C#Brandock/tra/autotra/%LANGUAGE%/brando_crossmod_ac_quest.tra~
  EXTEND_BOTTOM ~C#Brando.bcs~ ~c#brandock/crossmod/brando_crossmod_ac_quest_17.baf~ EVALUATE_BUFFER
END //Ascalon's Questpack: Ignazius Bombastus detected.

/* Ascalon's Questpack: Von Wölfen und Männern */
ACTION_IF FILE_EXISTS_IN_GAME ~ACQ16001.dlg~ THEN BEGIN 
PRINT @55573 /* ~Ascalon's Questpack: Von Wölfen und Männern detected.~ */
// Get state for THALAN %thalan_80% 
/* @80   = ~Wenn man der Welt wirklich einen Gefallen tun wollte, dann würde man den Werwolf töten und seine Leiche zu mir schaffen. Vielleicht kann ich durch die Obduktion wertvolle Erkenntnisse gewinnen, für den Fall, dass es den nächsten armen Hund trifft.~ */
OUTER_SET thalan_80 = STATE_WHICH_SAYS 80 IN ~AC_QUEST/tra/autotra/%s/ACQ16000.tra~ FROM ~THALAN~
  COMPILE EVALUATE_BUFFER ~c#brandock/crossmod/brando_crossmod_ac_quest_16.d~ USING ~C#Brandock/tra/autotra/%LANGUAGE%/brando_crossmod_ac_quest.tra~
END //Ascalon's Questpack: Von Wölfen und Männern


/* Balduran's Seatower */
ACTION_IF FILE_EXISTS_IN_GAME ~bstrmage.dlg~ THEN BEGIN 
PRINT @55576 /* ~Balduran's Seatower detected.~ */
  COMPILE EVALUATE_BUFFER ~c#brandock/crossmod/brando_crossmod_bst.d~
  EXTEND_BOTTOM ~C#Brando.bcs~ ~c#brandock/crossmod/brando_crossmod_bst.baf~ EVALUATE_BUFFER
END //bst


/* bg1npc, Quest & Interjections */
ACTION_IF FILE_EXISTS_IN_GAME ~X#TOME.itm~ THEN BEGIN 
PRINT @55557 /* ~bg1npc, Quest and Interjections detected.~ */

// Get state for ~%IMOEN_JOINED%~ %BG1NPC_IM201% 
/* @201  = ~Though, this stuff IS kinda complicated...~ */
OUTER_SET BG1NPC_IM201 = STATE_WHICH_SAYS 201 IN ~bg1npc/tra/%s/x#imoen.tra~ FROM ~%IMOEN_JOINED%~
  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/crossmod/bg1npc.baf~ EVALUATE_BUFFER
  COMPILE EVALUATE_BUFFER ~c#brandock/crossmod/brando_crossmod_bg1npc_BG1.d~ 
END //~bg1npc, Quest and Interjections 


/* bg1re - necromancer's trouble */
ACTION_IF FILE_EXISTS_IN_GAME ~C#q11nec.dlg~ THEN BEGIN 
PRINT @55569 /* ~bg1re "Necromancer's Trouble" detected.~ */
  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/crossmod/brando_crossmod_bg1re_necromancer.baf~ EVALUATE_BUFFER 

// Get state for C#q11nec %C#q11nec_78% 
/* ~Beth and I fell in love, she caught an incurable disease. I promised her to heal her - she died, since then I have been researching how to raise her... Raise her in good health.~ */
OUTER_SET C#q11nec_78 = STATE_WHICH_SAYS 78 IN ~bg1re/tra/autotra/%s/necromancer.tra~ FROM ~C#q11nec~

COMPILE EVALUATE_BUFFER ~C#Brandock/crossmod/brando_crossmod_bg1re_necromancer.d~ USING ~C#Brandock/tra/autotra/%LANGUAGE%/brando_crossmod_bg1re.tra~
END /* bg1re - necromancer's trouble */

/* bg1re - Dinner with Thalantyr */
ACTION_IF FILE_EXISTS_IN_GAME ~C#LCTH01.dlg~ THEN BEGIN 
PRINT @55570 /* ~bg1re "Dinner with Thalantyr" detected.~ */

// Get state for ~Thalan~ %Thalan_78% 
/* ~Then it is settled. Come to me tomorrow. But bear with me - I have not been in sophisticated company for a long time.~ */
OUTER_SET Thalan_78 = STATE_WHICH_SAYS 78 IN ~bg1re/tra/autotra/%s/c#_thalantyr.tra~ FROM ~Thalan~

// Get state for ~Thalan~ %Thalan_340% 
/* ~Well then... Follow me. (May the gods help me.)~ */
OUTER_SET Thalan_340 = STATE_WHICH_SAYS 340 IN ~bg1re/tra/autotra/%s/c#_thalantyr.tra~ FROM ~Thalan~

COMPILE EVALUATE_BUFFER ~C#Brandock/crossmod/brando_crossmod_bg1re_dinner_thalantyr.d~ USING ~C#Brandock/tra/autotra/%LANGUAGE%/brando_crossmod_bg1re.tra~

  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/crossmod/brando_crossmod_bg1re_dinner_thalantyr.baf~ EVALUATE_BUFFER

  EXTEND_BOTTOM ~%WBaldursGate_RagefastsHouse%.bcs~   ~C#Brandock/crossmod/brando_crossmod_bg1re_dinner_thalantyr_ar0126.baf~ EVALUATE_BUFFER

END /* bg1re - Dinner with Thalantyr */


/* bg1ub - mysterious vial */
ACTION_IF GAME_IS ~bgt~ BEGIN
ACTION_IF (MOD_IS_INSTALLED ~bg1ub.TP2~ "1") THEN BEGIN
PRINT @55558 /* ~bg1ub - mysterious vial detected.~ */
// Get state for Thalantyr %thalantyr_30% 
/* ~A remarkable compound. It must have taken a skilled alchemist to concoct this. I may be able to formulate an antidote to salvage some of the current iron stocks, although I doubt it will be sufficient to resolve the crisis. Leave it with me, and I will contact Taerom if I have any success.~ */
OUTER_SET thalantyr_30 = STATE_WHICH_SAYS 30 IN ~bg1ub/tra/%s/ubvial.tra~ FROM ~THALAN~

<<<<<<<< ...inlined/bg1ub_vial.d
//%thalantyr_30%
I_C_T ~THALAN~ %thalantyr_30% C#Brandock_Mysterious_Vial
== ~c#brandj~ IF ~OR(2) InParty("C#Brandock") Global("C#BrandockJoined","GLOBAL",2) InMyArea("C#Brandock") !StateCheck("C#Brandock",CD_STATE_NOTVALID)~ THEN @2015 
== ~THALAN~ IF ~OR(2) InParty("C#Brandock") Global("C#BrandockJoined","GLOBAL",2) InMyArea("C#Brandock") !StateCheck("C#Brandock",CD_STATE_NOTVALID)~ THEN @2016
END

>>>>>>>>
COMPILE EVALUATE_BUFFER ~...inlined/bg1ub_vial.d~ USING ~c#brandock/tra/autotra/%LANGUAGE%/C#BRAND_DIALOGUES.TRA~ 
END /* bg1ub - mysterious vial */
END //bgt


/* bgqe - need to check every component individually */

/* bgqe - slimequest */
ACTION_IF FILE_EXISTS_IN_GAME ~C#Q01001.dlg~ THEN BEGIN 
PRINT @55588 /* ~bgqe - slimequest detected.~ */
  COMPILE EVALUATE_BUFFER ~c#brandock/crossmod/brando_crossmod_bgqe_slimequest.d~
END //babysitting quest

/* bgqe - babysitting quest */
ACTION_IF FILE_EXISTS_IN_GAME ~C#Q03008.dlg~ THEN BEGIN 
PRINT @55559 /* ~bgqe - babysitting quest detected.~ */
  COMPILE EVALUATE_BUFFER ~c#brandock/crossmod/brando_crossmod_bgqe_babysitting.d~
END //babysitting quest

/* bgqe - Nashkell Monster */
ACTION_IF FILE_EXISTS_IN_GAME ~C#Q04004.dlg~ THEN BEGIN 
PRINT @55560 /* ~bgqe - Nashkell Monster detected.~ */
  COMPILE EVALUATE_BUFFER ~c#brandock/crossmod/brando_crossmod_bgqe_nashkelmonster.d~


  /* more content for bgqe v21 and higher */
  ACTION_IF FILE_EXISTS_IN_GAME ~c#bgqe_21.mrk~ THEN BEGIN
	<<<<<<<< ...inlined/brandock_nashkelmonster_add.d
	I_C_T C#Q04007 3 C#BR_C#Q04007_3
== ~c#brandj~ IF ~OR(2) InParty("C#Brandock") Global("C#BrandockJoined","GLOBAL",2) InMyArea("C#Brandock") !StateCheck("C#Brandock",CD_STATE_NOTVALID)~ THEN @1021
END
	>>>>>>>>
	COMPILE EVALUATE_BUFFER ~...inlined/brandock_nashkelmonster_add.d~
  END

END //Nashkell Monster


/* Brage */
ACTION_IF FILE_EXISTS_IN_GAME ~c#bragej.dlg~ THEN BEGIN 
PRINT @55561 /* ~Brage's Redemption detected.~ */

// Get state @3524 for c#brandj %brandj_DIAL3524% 
/* ~[Brandock]Uuh, ich kann es nicht fassen, dass sich jemand die Mühe macht, eine verfluchte Schriftrolle zu kreieren, die den Anwender so schädigt! Wozu soll die gut sein?! Manchmal schäme ich mich für meine Magierkollegen, <CHARNAME>. So eine Verschwendung von magischen Ressourcen, und wofür - damit sich jemand irgendwo eins ins Fäustchen lachen kann, weil sich jemand damit selbst schädigt?~ */
  OUTER_SET brandj_DIAL3524 = STATE_WHICH_SAYS 3524 IN ~c#brandock/tra/autotra/%s/C#BRAND_DIALOGUES.TRA~ FROM ~c#brandj~
  COMPILE EVALUATE_BUFFER ~c#brandock/crossmod/brage_brandock.d~
END /* Brage */

/* Finch */
ACTION_IF FILE_EXISTS_IN_GAME ~BSUFINCH.dlg~ THEN BEGIN 
PRINT @55591 /* ~Finch NPC detected.~ */

// Get state @463 for c#brandj %assassin_beregost_463% 
/* ~(waves his arms) That man *attacked* us inside a tavern! And *no one* cares! I think I could use a drink. If only I would. Drink, I mean. (sigh).~ */
  OUTER_SET assassin_beregost_463 = STATE_WHICH_SAYS 463 IN ~c#brandock/tra/autotra/%s/C#BRAND_DIALOGUES.TRA~ FROM ~c#brandj~
ACTION_IF GAME_IS ~bgee eet~ THEN BEGIN
// Get state @800 for SUFINCHJ %finch_800%
/* ~Couldn't you have been polite just a little longer? You've ruined it! What will the priests think of me now?~ */
  OUTER_SET finch_800 = STATE_WHICH_SAYS 800 IN ~FinchNPC/tra/bgee/%s/sufinch.tra~ FROM ~SUFINCHJ~
END ELSE BEGIN  
  OUTER_SET finch_800 = STATE_WHICH_SAYS 800 IN ~FinchNPC/tra/%s/sufinch.tra~ FROM ~SUFINCHJ~
END
COMPILE EVALUATE_BUFFER ~c#brandock/crossmod/brando_crossmod_finch.d~
EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/crossmod/brando_crossmod_finch.baf~ EVALUATE_BUFFER
END /* Finch */

/* Framed */
ACTION_IF FILE_EXISTS_IN_GAME ~#LF_CKWO.ITM~ THEN BEGIN 
PRINT @55578 /* ~Framed Mod detected.~ */
/* @1097 = ~And now we are here, in front of these impressive walls.~ */
OUTER_SET brandj_1097 = STATE_WHICH_SAYS 1097 IN ~C#Brandock/tra/autotra/%s/C#BRAND_DIALOGUES.TRA~ FROM ~c#brandj~
/* @1078 = ~And we are going there. To say I'm nervous is, well... a huge understatement.~ */
OUTER_SET brandj_1078 = STATE_WHICH_SAYS 1078 IN ~C#Brandock/tra/autotra/%s/C#BRAND_DIALOGUES.TRA~ FROM ~c#brandj~
/* @1165 = ~Well, we can't save the ones they already killed. And we walked the catacombs, there were no more living people, or we would have found them! But we killed all doppelgangers down in the catacombs.~ */
OUTER_SET brandj_1165 = STATE_WHICH_SAYS 1165 IN ~C#Brandock/tra/autotra/%s/C#BRAND_DIALOGUES.TRA~ FROM ~c#brandj~
/* @1173 = ~(sigh) To know that Candlekeep was about to be infiltrated by doppelgangers! The mighty library... I need to ponder this, <CHARNAME>. And what this must mean to you, I can only guess!~ */
OUTER_SET brandj_1173 = STATE_WHICH_SAYS 1173 IN ~C#Brandock/tra/autotra/%s/C#BRAND_DIALOGUES.TRA~ FROM ~c#brandj~
/* @2148  = ~Stay and browse the library for as long as you like. This is once again your home, if you so wish.~ */
OUTER_SET TETHTO2_2148 = STATE_WHICH_SAYS 2148 IN ~framed/languages/%s/framed.TRA~ FROM ~TETHTO2~
  COMPILE EVALUATE_BUFFER ~c#brandock/crossmod/brando_crossmod_framed.d~
  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/crossmod/brando_crossmod_framed.baf~ EVALUATE_BUFFER
END /* Framed */

/* Gavin BG1 */
ACTION_IF FILE_EXISTS_IN_GAME ~BB!GAVIN.dlg~ THEN BEGIN 
PRINT @55562 /* ~Gavin BG1 detected.~ */
  COMPILE EVALUATE_BUFFER ~c#brandock/crossmod/brando_crossmod_gavin_BG1.d~
END /* Gavin BG1 */

/* Lure of Sirine's Call */
ACTION_IF FILE_EXISTS_IN_GAME ~J#Lig2.are~ THEN BEGIN 
PRINT @55575 /* ~Lure of Sirine's Call detected.~ */
  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/crossmod/brando_crossmod_LoSC.baf~
END /* Lure of Sirine's Call */

/* Northern Tales of the Sword Coast */
ACTION_IF FILE_EXISTS_IN_GAME ~NTHASDAR.dlg~ THEN BEGIN 
PRINT @55577 /* ~Northern Tales of the Sword Coast - Main component detected.~ */
  COMPILE EVALUATE_BUFFER ~c#brandock/crossmod/brando_crossmod_ntotsc.d~
  EXTEND_BOTTOM ~C#Brando.bcs~ ~c#brandock/crossmod/brando_crossmod_ntotsc.baf~ EVALUATE_BUFFER
END //ntotsc

/* Stone of Askavar */
ACTION_IF FILE_EXISTS_IN_GAME ~pirn.cre~ THEN BEGIN
PRINT @55574 /* ~Stone of Askavar detected.~ */
  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/crossmod/brando_crossmod_soa.baf~
EVALUATE_BUFFER
END //SoA

/* The Calling */
ACTION_IF FILE_EXISTS_IN_GAME ~cdbracer.itm~ THEN BEGIN
PRINT @55563 /* ~The Calling detected.~ */
  COMPILE EVALUATE_BUFFER ~C#Brandock/crossmod/the_calling.d~
  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/crossmod/the_calling.baf~
EVALUATE_BUFFER
END //TheCalling

/* SotSC - Shades of the Sword Coast */
ACTION_IF FILE_EXISTS_IN_GAME ~L#HIGBO.dlg~ THEN BEGIN 
PRINT @55571 /* ~Shades of the Sword Coast detected.~ */

  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/crossmod/brando_crossmod_sotsc.baf~ EVALUATE_BUFFER 
  COMPILE EVALUATE_BUFFER ~c#brandock/crossmod/brando_crossmod_sotsc.d~
END //Shades of the Sword Coast



/* Valerie */
/* not approved yet but I can't reach Tempest. Will be changed or removed if requested. */

ACTION_IF FILE_EXISTS_IN_GAME ~t2val.cre~ THEN BEGIN 
PRINT @55564 /* ~Valerie detected.~ */
  COMPILE EVALUATE_BUFFER ~C#Brandock/crossmod/brando_crossmod_valerie_BG1.d~
  EXTEND_BOTTOM ~c#brando.bcs~   ~C#Brandock/crossmod/valerie.baf~
EVALUATE_BUFFER

END //ACTION_IF FILE_EXISTS_IN_GAME ~t2val.cre~


END //ACTION_IF GAME_IS ~bgee bgt~



/* SoD */

ACTION_IF (GAME_IS ~bgee eet~ AND FILE_EXISTS_IN_GAME ~bd0103.are~) THEN BEGIN


/* Ajantis SoD */
ACTION_IF FILE_EXISTS_IN_GAME ~C#AjSoDG.dlg~ THEN BEGIN
PRINT @55589 /* Ajantis SoD detected. */ 
  COMPILE EVALUATE_BUFFER ~c#brandock/crossmod/ajantis_brandock_sod.d~
END /* Ajantis SoD */

/* Brage SoD content */
ACTION_IF FILE_EXISTS_IN_GAME ~c#bragej.dlg~ THEN BEGIN 
/* @69 ~[uncle]Well, that's - that's great, no? Seems like you could sing it to her, then.~ */
  OUTER_SET c#besq02_69 = STATE_WHICH_SAYS 69 IN ~c#brage/tra/autotra/%s/quest_sod.tra~ FROM ~c#besq02~
/* @78 [Uncle]Singing it would be the smartest thing to do, I think. */
  OUTER_SET c#besq02_78 = STATE_WHICH_SAYS 78 IN ~c#brage/tra/autotra/%s/quest_sod.tra~ FROM ~c#besq02~
/* @126  = ~[Tilda]What?! You are... you are so mean! You can't do that... (sob)~ */
  OUTER_SET c#besq0a_126 = STATE_WHICH_SAYS 126 IN ~c#brage/tra/autotra/%s/quest_sod.tra~ FROM ~c#besq0a~
  COMPILE EVALUATE_BUFFER ~c#brandock/crossmod/brage_brandock_sod.d~ USING ~C#Brandock/tra/autotra/%LANGUAGE%/brage_brandock.tra~
  EXTEND_BOTTOM ~c#brands.bcs~ ~c#brandock/crossmod/brage_brandock_sod_banter.baf~
    EVALUATE_BUFFER 
END /* Brage */


/* Gavin */

ACTION_IF FILE_EXISTS_IN_GAME ~b!gavin.cre~ THEN BEGIN
/* spider cave */
EXTEND_BOTTOM ~bd0114.bcs~ ~c#brandock/crossmod/c#brando_sod_bd0114.baf~
  EVALUATE_BUFFER

END //~b!gavin.cre~

/* Imoen 4 Ever */

ACTION_IF FILE_EXISTS_IN_GAME ~c#imback.bcs~ THEN BEGIN
PRINT @55565 /* ~Imoen 4 Ever SoD component "Give Imoen dialogue content during chapters 8 to 12" detected.~ */
  COMPILE EVALUATE_BUFFER ~c#brandock/crossmod/brando_crossmod_I4E_sod_main.d~
END //I4E


/* The Boareskyr Bridge Scene */
ACTION_IF (MOD_IS_INSTALLED ~c#sodboabri/setup-c#sodboabri.tp2~ ~0~) THEN BEGIN
PRINT @55587 /* The Boareskyr Bridge Scene mod detected. */

// Get state for c#stff24 %after_incident_at_bridge_10% (in c#sodboabri/dialogues/bhaalheritage_boareskyr_bridge.d)
/* @76  = ~[FF Healer (female)]Everyone saw the sign of Bhaal painting itself on the ground around you. I fear what happened here will be the source of much speculation and rumors. Let us move on and leave this place.~
*/
OUTER_SET after_incident_at_bridge_10 = STATE_WHICH_SAYS 76 IN ~c#sodboabri/translations/autotra/%s/dialogues.tra~ FROM ~c#stff24~
  COMPILE EVALUATE_BUFFER ~C#Brandock/crossmod/brando_crossmod_boareskyrbridge.d~ 
     USING ~C#Brandock/tra/autotra/%LANGUAGE%/brandock_sod.tra~
END

/* Transitions */

ACTION_IF (MOD_IS_INSTALLED ~transitions/setup-transitions.tp2~ ~0~) THEN BEGIN
PRINT @55581 /* ~Transitions Mod detected.~ */
  COMPILE EVALUATE_BUFFER ~c#brandock/crossmod/brando_crossmod_transitions.d~
	USING ~c#brandock/tra/autotra/%LANGUAGE%/brandock_sod.tra~
  EXTEND_TOP ~c#brando.bcs~ ~c#brandock/crossmod/brando_crossmod_transitions.baf~ 
EVALUATE_BUFFER
  EXTEND_TOP ~c#brands.bcs~ ~c#brandock/crossmod/brando_crossmod_transitions.baf~
    EVALUATE_BUFFER 
/* Brandock should not remain dead in case he was upon transition */
  EXTEND_TOP ~#L_CUT09.bcs~ ~c#brandock/crossmod/brando_crossmod_transitions_eet.baf~ 
    EVALUATE_BUFFER
END

END //ACTION_IF [SoD]




/* BGII */


ACTION_IF GAME_IS ~tob bg2ee bgt eet~ THEN BEGIN

/* Alternatives */

  ACTION_IF FILE_EXISTS_IN_GAME ~B!ASTER.dlg~ THEN BEGIN
PRINT @55566 /* ~Alternatives detected.~ */

/* add Brandock to Brega's dialogue - PC needs witness */
/* this will grab the correct state from the language alternatives is installed in - this is great! */
/* @853  = ~Something I can put my hands on. A document, a witness, something more than your word against his.~ */
    OUTER_SET brega_state_853 = STATE_WHICH_SAYS 853 IN ~alternatives/%s/DIALOGUE.tra~ FROM ~HABREGA.dlg~

    COMPILE EVALUATE_BUFFER ~C#Brandock/crossmod/brando_crossmod_alternatives.d~
    EXTEND_BOTTOM ~C#Brand2.bcs~ ~C#Brandock/crossmod/brando_crossmod_alternatives.baf~ EVALUATE_BUFFER
  END /* Alternatives */


/* NPC Strongholds */
  ACTION_IF FILE_EXISTS_IN_GAME ~ksimteos.bcs~ THEN BEGIN
PRINT @55567 /* ~NPC Strongholds detected.~ */
    OUTER_SET teos_state_1 = STATE_WHICH_SAYS 2001 IN ~npc_strongholds/%s/npc_strongholds.tra~ FROM ~MGTEOS01.dlg~

    OUTER_SET teos_state_2 = STATE_WHICH_SAYS 2009 IN ~npc_strongholds/%s/npc_strongholds.tra~ FROM ~MGTEOS01.dlg~
    COMPILE EVALUATE_BUFFER ~C#Brandock/crossmod/brando_crossmod_npcstrongholds.d~
    EXTEND_BOTTOM ~C#Brand2.bcs~ ~C#Brandock/crossmod/brando_crossmod_npcstrongholds.baf~
  END /* NPC Strongholds */

/* Solaufein's Rescue */
  ACTION_IF FILE_EXISTS_IN_GAME ~c#solauj.dlg~ THEN BEGIN
PRINT @55572 /* ~Solaufein's Rescue detected.~ */
// Get state for BIMOEN25 %BIMOEN25_1119% 
/* ~Beth and I fell in love, she caught an incurable disease. I promised her to heal her - she died, since then I have been researching how to raise her... Raise her in good health.~ */
OUTER_SET BIMOEN25_1119 = STATE_WHICH_SAYS 1119 IN ~c#solaufein/translations/autotra/%s/C#SOLATRA.TRA~ FROM ~BIMOEN25~

    COMPILE EVALUATE_BUFFER ~C#Brandock/crossmod/brando_crossmod_c#solaufein.d~
END //Solaufein's Rescue



END //~tob bg2ee bgt eet~

///////////////////////////////////////////////////////////
// Install alternate portraits, also from Acifer    //
/////////////////////////////////////////////////////////


BEGIN @55545 /* ~Alternative #1: Very Friendly, by Acifer~ */ DESIGNATED 20 
LABEL BrandockTheMage-Portrait_Friendly
	SUBCOMPONENT @55544 
REQUIRE_COMPONENT ~c#brandock.tp2~ ~0~ @55543

ACTION_IF GAME_IS ~bg2 tob bgt~ BEGIN

COPY ~C#Brandock/Portrait/Alt1/bg2/C#BrandL.bmp~ ~override~
COPY ~C#Brandock/Portrait/Alt1/bg2/C#BrandM.bmp~ ~override~
COPY ~C#Brandock/Portrait/Alt1/bg2/C#BrandS.bmp~ ~override~

END

ACTION_IF GAME_IS ~bgee~ BEGIN

COPY ~C#Brandock/Portrait/Alt1/bgee/C#BrandL.bmp~ ~override~
COPY ~C#Brandock/Portrait/Alt1/bgee/C#BrandM.bmp~ ~override/C#BrandM.bmp~
COPY ~C#Brandock/Portrait/Alt1/bgee/C#BrandM.bmp~ ~override/C#BrandS.bmp~

END

ACTION_IF GAME_IS ~bg2ee eet~ BEGIN

COPY ~C#Brandock/Portrait/Alt1/bg2ee/C#BrandL.bmp~ ~override~
COPY ~C#Brandock/Portrait/Alt1/bg2ee/C#BrandM.bmp~ ~override/C#BrandM.bmp~
COPY ~C#Brandock/Portrait/Alt1/bg2ee/C#BrandM.bmp~ ~override/C#BrandS.bmp~

END




BEGIN @55546 /* ~Alternative #2: Mischievous, by Acifer~ */ DESIGNATED 21 
LABEL BrandockTheMage-Portrait_Mischievous
	SUBCOMPONENT @55544
REQUIRE_COMPONENT ~c#brandock.tp2~ ~0~ @55543

ACTION_IF GAME_IS ~bg2 tob bgt~ BEGIN

COPY ~C#Brandock/Portrait/Alt2/bg2/C#BrandL.bmp~ ~override~
COPY ~C#Brandock/Portrait/Alt2/bg2/C#BrandM.bmp~ ~override~
COPY ~C#Brandock/Portrait/Alt2/bg2/C#BrandS.bmp~ ~override~

END

ACTION_IF GAME_IS ~bgee~ BEGIN

COPY ~C#Brandock/Portrait/Alt2/bgee/C#BrandL.bmp~ ~override~
COPY ~C#Brandock/Portrait/Alt2/bgee/C#BrandM.bmp~ ~override/C#BrandM.bmp~
COPY ~C#Brandock/Portrait/Alt2/bgee/C#BrandM.bmp~ ~override/C#BrandS.bmp~

END

ACTION_IF GAME_IS ~bg2ee eet~ BEGIN

COPY ~C#Brandock/Portrait/Alt2/bg2ee/C#BrandL.bmp~ ~override~
COPY ~C#Brandock/Portrait/Alt2/bg2ee/C#BrandM.bmp~ ~override/C#BrandM.bmp~
COPY ~C#Brandock/Portrait/Alt2/bg2ee/C#BrandM.bmp~ ~override/C#BrandS.bmp~

END

BEGIN @55547 /* ~Alternative #3: Juvenile, by Acifer~ */ DESIGNATED 22 
	SUBCOMPONENT @55544 
LABEL BrandockTheMage-Portrait_Juvenile
REQUIRE_COMPONENT ~c#brandock.tp2~ ~0~ @55543

ACTION_IF GAME_IS ~bg2 tob bgt~ BEGIN

COPY ~C#Brandock/Portrait/Alt3/bg2/C#BrandL.bmp~ ~override~
COPY ~C#Brandock/Portrait/Alt3/bg2/C#BrandM.bmp~ ~override~
COPY ~C#Brandock/Portrait/Alt3/bg2/C#BrandS.bmp~ ~override~

END

ACTION_IF GAME_IS ~bgee bg2ee eet~ BEGIN

COPY ~C#Brandock/Portrait/Alt3/bgee/C#BrandL.bmp~ ~override~
COPY ~C#Brandock/Portrait/Alt3/bgee/C#BrandM.bmp~ ~override/C#BrandM.bmp~
COPY ~C#Brandock/Portrait/Alt3/bgee/C#BrandM.bmp~ ~override/C#BrandS.bmp~

END

/*
ACTION_IF GAME_IS ~bg2ee eet~ BEGIN

COPY ~C#Brandock/Portrait/Alt3/bg2ee/C#BrandL.bmp~ ~override~
COPY ~C#Brandock/Portrait/Alt3/bg2ee/C#BrandM.bmp~ ~override/C#BrandM.bmp~
COPY ~C#Brandock/Portrait/Alt3/bg2ee/C#BrandM.bmp~ ~override/C#BrandS.bmp~

END
*/



BEGIN @55548 /* ~Default Portrait: Insecure, by Acifer (is included in the main component)~ */ DESIGNATED 23  
LABEL BrandockTheMage-Portrait_Insecure
	SUBCOMPONENT @55544
REQUIRE_COMPONENT ~c#brandock.tp2~ ~0~ @55543

ACTION_IF GAME_IS ~bg2 tob bgt~ BEGIN

COPY ~C#Brandock/Portrait/bg2/C#BrandL.bmp~ ~override~
COPY ~C#Brandock/Portrait/bg2/C#BrandM.bmp~ ~override~
COPY ~C#Brandock/Portrait/bg2/C#BrandS.bmp~ ~override~

END

ACTION_IF GAME_IS ~bgee~ BEGIN

COPY ~C#Brandock/Portrait/bgee/C#BrandL.bmp~ ~override~
COPY ~C#Brandock/Portrait/bgee/C#BrandM.bmp~ ~override/C#BrandM.bmp~
COPY ~C#Brandock/Portrait/bgee/C#BrandM.bmp~ ~override/C#BrandS.bmp~

END

ACTION_IF GAME_IS ~bg2ee eet~ BEGIN

COPY ~C#Brandock/Portrait/bg2ee/C#BrandL.bmp~ ~override~
COPY ~C#Brandock/Portrait/bg2ee/C#BrandM.bmp~ ~override/C#BrandM.bmp~
COPY ~C#Brandock/Portrait/bg2ee/C#BrandM.bmp~ ~override/C#BrandS.bmp~

END

///////////////////////////////////////////////////////////
// DEPRECATED Use Dialogue Style for SoD Banter //
/////////////////////////////////////////////////////////
BEGIN @55553 /* ~Use Dialogue Style for SoD Banter~ */ 
DESIGNATED 30 
LABEL BrandockTheMage-Dialogue_Style_SoD_Banter
DEPRECATED @55592 


///////////////////////////////////////////////////////////////
/* Crossmod with aTweaks "Allow Mages to scribe memorized spells onto scrolls" */
//////////////////////////////////////////////////////////////

/* First option: deactivate aTweak's scribe scroll ability for Brandock */
BEGIN @55582 /* ~Deactivate aTweak's scribe scroll ability for Brandock~ */ DESIGNATED 40  
LABEL BrandockTheMage-aTweaks-Crossmod-Option1
	SUBCOMPONENT @55584 /* Crossmod with aTweaks "Allow Mages to scribe memorized spells onto scrolls" */
REQUIRE_COMPONENT ~c#brandock.tp2~ ~0~ @55543
REQUIRE_PREDICATE (MOD_IS_INSTALLED ~setup-atweaks.tp2~ ~115~) OR (MOD_IS_INSTALLED ~setup-atweaks.tp2~ ~117~) @55585 /* aTweaks "Allow Mages to scribe memorized spells onto scrolls" needs to be installed. */

<<<<<<<< .../c#brand_atweaks.baf
/* remove the extra ability button from aTweaks */
/* needs to run every day anew or any time Brandock gets the ability assigned via the engine (e.g. upon levelling up), so no variable */

IF
	OR(2) InParty(Myself) Global("C#BrandockJoined","GLOBAL",2)
	Class(Myself,MAGE_ALL)
//	LevelGT(Myself,8)
	HaveSpellRES("fl#MSCRL")
	CombatCounter(0)
	!See([ENEMY])
THEN
	RESPONSE #100
		RemoveSpellRES("fl#MSCRL")
//		DisplayStringHead(Myself,~Testline: removed Scribe Scroll Ability from aTweaks.~)
		SetGlobal("C#Br_Scrollscribing_aTweaks","GLOBAL",1)
END

/* Brandock made memorized spell scroll - we are not done yet. Restart dialogue: */
IF
	OR(2) InParty(Myself) Global("C#BrandockJoined","GLOBAL",2)
	Global("C#Br_Scrollscribing_aTweaks","GLOBAL",2)
	Global("c#brscrl","GLOBAL",3)
THEN
	RESPONSE #100
		DisplayStringHead(Myself,@3020)
		StartDialogOverride("c#brfl#s","C#Brandock")
END
>>>>>>>>
ACTION_IF GAME_IS ~bgee eet bgt~ BEGIN
  EXTEND_BOTTOM ~c#brando.bcs~ ~.../c#brand_atweaks.baf~ EVALUATE_BUFFER USING ~c#brandock/tra/autotra/%LANGUAGE%/C#BRAND_DIALOGUES.tra~
END
ACTION_IF GAME_INCLUDES ~sod~ BEGIN
  EXTEND_BOTTOM ~c#brands.bcs~ ~.../c#brand_atweaks.baf~ EVALUATE_BUFFER USING ~c#brandock/tra/autotra/%LANGUAGE%/C#BRAND_DIALOGUES.tra~
END
ACTION_IF GAME_IS ~tob bg2ee eet~ BEGIN
  EXTEND_BOTTOM ~c#brand2.bcs~ ~.../c#brand_atweaks.baf~ EVALUATE_BUFFER USING ~c#brandock/tra/autotra/%LANGUAGE%/C#BRAND_DIALOGUES.tra~
END

/* double the aTweaks spell dialogue so we can work with it */
COPY_EXISTING ~fl#SCRL.dlg~ ~override/c#brfl#s.dlg~
      PATCH_IF SOURCE_SIZE > 0x34 BEGIN
	DECOMPILE_AND_PATCH BEGIN
		SPRINT textToReplace ~fl#SCRL~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~c#brfl#s~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
		SPRINT textToReplace ~Myself~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~Player1~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
		SPRINT textToReplace ~\(GiveItemCreate\)~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~SetGlobal("C#Br_Scrollscribing_aTweaks","GLOBAL",2)
\1~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
      END
END
BUT_ONLY
<<<<<<<< .../inlined/c#brand_atweaks.d

REPLACE_STATE_TRIGGER c#brfl#s 0 ~False()~

REPLACE_STATE_TRIGGER c#brfl#s 1 ~False()~

ADD_STATE_TRIGGER c#brfl#s 2 ~True()~

ADD_TRANS_TRIGGER c#brfl#s 2 ~LevelGT("C#Brandock",2)~ DO 1
ADD_TRANS_TRIGGER c#brfl#s 2 ~LevelGT("C#Brandock",4)~ DO 2
ADD_TRANS_TRIGGER c#brfl#s 2 ~LevelGT("C#Brandock",6)~ DO 3
ADD_TRANS_TRIGGER c#brfl#s 2 ~LevelGT("C#Brandock",8)~ DO 4
ADD_TRANS_TRIGGER c#brfl#s 2 ~LevelGT("C#Brandock",11)~ DO 5
ADD_TRANS_TRIGGER c#brfl#s 2 ~LevelGT("C#Brandock",13)~ DO 6
ADD_TRANS_TRIGGER c#brfl#s 2 ~LevelGT("C#Brandock",15)~ DO 7
ADD_TRANS_TRIGGER c#brfl#s 2 ~LevelGT("C#Brandock",17)~ DO 8
ADD_TRANS_TRIGGER c#brfl#s 2 ~False()~ DO 9

EXTEND_BOTTOM c#brfl#s 2
++ @3106 DO ~SetGlobal("c#brscrl","GLOBAL",1)
StartDialogNoSet("C#Brandock")
~ EXIT
END

APPEND c#brfl#s 
IF WEIGHT #-1
~Global("C#Br_Scrollscribing_aTweaks","GLOBAL",2)~ atweaks_again
SAY @3018
IF ~~ THEN DO ~SetGlobal("C#Br_Scrollscribing_aTweaks","GLOBAL",1)~ + 2
END
END //APPEND

EXTEND_TOP c#brandj %scribe_scoll_02%
+ ~Global("C#Br_Scrollscr_aTweaks_Info","LOCALS",0)~ + @3107 DO ~SetGlobal("C#Br_Scrollscr_aTweaks_Info","LOCALS",1)~ + atweaks_info
+ ~Global("C#Br_Scrollscr_aTweaks_Info","LOCALS",1)~ + @3107 DO ~SetGlobal("c#brscrl","GLOBAL",3)
ActionOverride("C#Brandock",StartDialogOverride("c#brfl#s","C#Brandock"))~ EXIT
END

APPEND c#brandj
IF ~~ THEN atweaks_info
SAY @3108 /* ~Yes, I can do that. It means I'll have one spell less memorized for today, but it won't drain me so I could write another scroll after that. It will cost gold, though.~ */
IF ~~ THEN DO ~SetGlobal("c#brscrl","GLOBAL",3)
ActionOverride("C#Brandock",StartDialogOverride("c#brfl#s","C#Brandock"))~ EXIT
END
END //APPEND
>>>>>>>>

// Get state for c#brandj %scribe_scoll_02% 
/* ~What do you want me to scribe, <CHARNAME>?~
*/
OUTER_SET scribe_scoll_02 = STATE_WHICH_SAYS 3023 IN ~c#brandock/tra/autotra/%s/C#BRAND_DIALOGUES.tra~ FROM ~c#brandj~

COMPILE EVALUATE_BUFFER ~.../inlined/c#brand_atweaks.d~ USING ~c#brandock/tra/autotra/%LANGUAGE%/C#BRAND_DIALOGUES.tra~




/* Second option: integrate aTweak's scribe scroll ability into Brandock's original one */
BEGIN @55583 /* ~Integrate aTweak's scribe scroll ability into Brandock's original one~ */ DESIGNATED 41  
LABEL BrandockTheMage-aTweaks-Crossmod-Option2
	SUBCOMPONENT @55584 /* Crossmod with aTweaks "Allow Mages to scribe memorized spells onto scrolls" */
REQUIRE_COMPONENT ~c#brandock.tp2~ ~0~ @55543
REQUIRE_PREDICATE (MOD_IS_INSTALLED ~setup-atweaks.tp2~ ~115~) OR (MOD_IS_INSTALLED ~setup-atweaks.tp2~ ~117~) @55585 /* aTweaks "Allow Mages to scribe memorized spells onto scrolls" needs to be installed. */

<<<<<<<< .../c#brand_atweaks.baf
/* remove the extra ability button from aTweaks */
/* disable normal spell choices from meue for level < 9 */
IF
	OR(2) InParty(Myself) Global("C#BrandockJoined","GLOBAL",2)
	Class(Myself,MAGE_ALL)
	Global("C#Br_Scrollscribing_aTweaks","GLOBAL",0)
	CombatCounter(0)
	!See([ENEMY])
THEN
	RESPONSE #100
		SetGlobal("C#Br_Scrollscribing_aTweaks","GLOBAL",3)
END

/* needs to run every day anew or any time Brandock gets the ability assigned via the engine (e.g. upon levelling up), so no variable */
IF
	OR(2) InParty(Myself) Global("C#BrandockJoined","GLOBAL",2)
	Class(Myself,MAGE_ALL)
//	LevelGT(Myself,8)
	HaveSpellRES("fl#MSCRL")
	CombatCounter(0)
	!See([ENEMY])
THEN
	RESPONSE #100
		RemoveSpellRES("fl#MSCRL")
//		DisplayStringHead(Myself,~Testline: removed Scribe Scroll Ability from aTweaks.~)
		SetGlobal("C#Br_Scrollscribing_aTweaks","GLOBAL",3)
END

/* Brandock made memorized spell scroll - we are not done yet. Restart dialogue: */
IF
	OR(2) InParty(Myself) Global("C#BrandockJoined","GLOBAL",2)
	Global("C#Br_Scrollscribing_aTweaks","GLOBAL",4)
	Global("c#brscrl","GLOBAL",3)
THEN
	RESPONSE #100
		DisplayStringHead(Myself,@3020)
		StartDialogOverride("c#brfl#s","C#Brandock")
END

IF
	OR(2) InParty(Myself) Global("C#BrandockJoined","GLOBAL",2)
	Global("C#Br_Scrollscribing_aTweaks","GLOBAL",5)
	Global("c#brscrl","GLOBAL",3)
THEN
	RESPONSE #100
		DisplayStringHead(Myself,@3020)
		SetGlobal("C#Br_Scrollscribing_aTweaks","GLOBAL",3)
END
>>>>>>>>
ACTION_IF GAME_IS ~bgee eet bgt~ BEGIN
  EXTEND_BOTTOM ~c#brando.bcs~ ~.../c#brand_atweaks.baf~ EVALUATE_BUFFER USING ~c#brandock/tra/autotra/%LANGUAGE%/C#BRAND_DIALOGUES.tra~
END
ACTION_IF GAME_INCLUDES ~sod~ BEGIN
  EXTEND_BOTTOM ~c#brands.bcs~ ~.../c#brand_atweaks.baf~ EVALUATE_BUFFER USING ~c#brandock/tra/autotra/%LANGUAGE%/C#BRAND_DIALOGUES.tra~
END
ACTION_IF GAME_IS ~tob bg2ee eet~ BEGIN
  EXTEND_BOTTOM ~c#brand2.bcs~ ~.../c#brand_atweaks.baf~ EVALUATE_BUFFER USING ~c#brandock/tra/autotra/%LANGUAGE%/C#BRAND_DIALOGUES.tra~
END

/* double the aTweaks spell dialogue so we can work with it */
COPY_EXISTING ~fl#SCRL.dlg~ ~override/c#brfl#s.dlg~
      PATCH_IF SOURCE_SIZE > 0x34 BEGIN
	DECOMPILE_AND_PATCH BEGIN
		SPRINT textToReplace ~fl#SCRL~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~c#brfl#s~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
		SPRINT textToReplace ~Myself~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~Player1~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
		SPRINT textToReplace ~\(GiveItemCreate\)~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~SetGlobal("C#Br_Scrollscribing_aTweaks","GLOBAL",4)
\1~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
      END
END
BUT_ONLY

/* trible the aTweaks spell dialogue so we can work with it */
COPY_EXISTING ~fl#SCRL.dlg~ ~override/c#brfl#2.dlg~
      PATCH_IF SOURCE_SIZE > 0x34 BEGIN
	DECOMPILE_AND_PATCH BEGIN
		SPRINT textToReplace ~fl#SCRL~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~c#brfl#2~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
		SPRINT textToReplace ~Myself~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~Player1~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
		SPRINT textToReplace ~RemoveSpell~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~//RemoveSpell~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
		SPRINT textToReplace ~\(GiveItemCreate\)~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~SetGlobal("C#Br_Scrollscribing_aTweaks","GLOBAL",5)
\1~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
      END
END
BUT_ONLY

ACTION_IF GAME_IS ~eet bg2ee bgee~ THEN BEGIN

COPY_EXISTING ~c#brfl#2.dlg~ ~override~
      PATCH_IF SOURCE_SIZE > 0x34 BEGIN
	DECOMPILE_AND_PATCH BEGIN
		SPRINT textToReplace ~HaveSpell~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~HaveKnownSpell~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
      END
END
BUT_ONLY

END

<<<<<<<< .../inlined/c#brand_atweaks.d

REPLACE_STATE_TRIGGER c#brfl#s 0 ~False()~

REPLACE_STATE_TRIGGER c#brfl#s 1 ~False()~

ADD_STATE_TRIGGER c#brfl#s 2 ~True()~

ADD_TRANS_TRIGGER c#brfl#s 2 ~LevelGT("C#Brandock",2)~ DO 1
ADD_TRANS_TRIGGER c#brfl#s 2 ~LevelGT("C#Brandock",4)~ DO 2
ADD_TRANS_TRIGGER c#brfl#s 2 ~LevelGT("C#Brandock",6)~ DO 3
ADD_TRANS_TRIGGER c#brfl#s 2 ~LevelGT("C#Brandock",8)~ DO 4
ADD_TRANS_TRIGGER c#brfl#s 2 ~LevelGT("C#Brandock",11)~ DO 5
ADD_TRANS_TRIGGER c#brfl#s 2 ~LevelGT("C#Brandock",13)~ DO 6
ADD_TRANS_TRIGGER c#brfl#s 2 ~LevelGT("C#Brandock",15)~ DO 7
ADD_TRANS_TRIGGER c#brfl#s 2 ~LevelGT("C#Brandock",17)~ DO 8
ADD_TRANS_TRIGGER c#brfl#s 2 ~False()~ DO 9

EXTEND_BOTTOM c#brfl#s 2
++ @3106 DO ~SetGlobal("c#brscrl","GLOBAL",1)
StartDialogNoSet("C#Brandock")
~ EXIT
END

APPEND c#brfl#s 
IF WEIGHT #-1
~Global("C#Br_Scrollscribing_aTweaks","GLOBAL",4)~ atweaks_again
SAY @3018
IF ~~ THEN DO ~SetGlobal("C#Br_Scrollscribing_aTweaks","GLOBAL",3)~ + 2
END
END //APPEND

EXTEND_TOP c#brandj %scribe_scoll_02%
+ ~Global("C#Br_Scrollscr_aTweaks_Info","LOCALS",0)~ + @3107 DO ~SetGlobal("C#Br_Scrollscr_aTweaks_Info","LOCALS",1)~ + atweaks_info
+ ~Global("C#Br_Scrollscr_aTweaks_Info","LOCALS",1)~ + @3107 DO ~SetGlobal("c#brscrl","GLOBAL",3)
ActionOverride("C#Brandock",StartDialogOverride("c#brfl#s","C#Brandock"))~ EXIT
++ @3109 DO ~SetGlobal("c#brscrl","GLOBAL",3)
ActionOverride("C#Brandock",StartDialogOverride("c#brfl#2","C#Brandock"))~ EXIT
END

APPEND c#brandj
IF ~~ THEN atweaks_info
SAY @3108 /* ~Yes, I can do that. It means I'll have one spell less memorized for today, but it won't drain me so I could write another scroll after that. It will cost gold, though.~ */
IF ~~ THEN DO ~SetGlobal("c#brscrl","GLOBAL",3)
ActionOverride("C#Brandock",StartDialogOverride("c#brfl#s","C#Brandock"))~ EXIT
END
END //APPEND

REPLACE_STATE_TRIGGER c#brfl#2 0 ~False()~

REPLACE_STATE_TRIGGER c#brfl#2 1 ~False()~

ADD_STATE_TRIGGER c#brfl#2 2 ~True()~

ADD_TRANS_TRIGGER c#brfl#2 2 ~LevelGT("C#Brandock",2)~ DO 1
ADD_TRANS_TRIGGER c#brfl#2 2 ~LevelGT("C#Brandock",4)~ DO 2
ADD_TRANS_TRIGGER c#brfl#2 2 ~LevelGT("C#Brandock",6)~ DO 3
ADD_TRANS_TRIGGER c#brfl#2 2 ~LevelGT("C#Brandock",8)~ DO 4
ADD_TRANS_TRIGGER c#brfl#2 2 ~LevelGT("C#Brandock",11)~ DO 5
ADD_TRANS_TRIGGER c#brfl#2 2 ~LevelGT("C#Brandock",13)~ DO 6
ADD_TRANS_TRIGGER c#brfl#2 2 ~LevelGT("C#Brandock",15)~ DO 7
ADD_TRANS_TRIGGER c#brfl#2 2 ~LevelGT("C#Brandock",17)~ DO 8

ADD_TRANS_TRIGGER c#brfl#2 2 ~False()~ DO 9

EXTEND_BOTTOM c#brfl#2 2
++ @3104 DO ~SetGlobal("c#brscrl","GLOBAL",1)
StartDialogNoSet("C#Brandock")
~ EXIT
END
>>>>>>>>

// Get state for c#brandj %scribe_scoll_02% 
/* ~What do you want me to scribe, <CHARNAME>?~
*/
OUTER_SET scribe_scoll_02 = STATE_WHICH_SAYS 3023 IN ~c#brandock/tra/autotra/%s/C#BRAND_DIALOGUES.tra~ FROM ~c#brandj~

COMPILE EVALUATE_BUFFER ~.../inlined/c#brand_atweaks.d~ USING ~c#brandock/tra/autotra/%LANGUAGE%/C#BRAND_DIALOGUES.tra~

///////////////////////////////////////////////////////////////
/* Make Cutscene in Thalantyr's Abode Short */
//////////////////////////////////////////////////////////////

BEGIN @55586 /* ~Make Cutscene in Thalantyr's Abode Short~ */ DESIGNATED 50 
LABEL BrandockTheMage-Make_Cutscene_Short
REQUIRE_COMPONENT ~c#brandock.tp2~ ~0~ @55543
REQUIRE_PREDICATE (GAME_IS ~bgee eet bgt~) @55541

COPY ~c#brandock/scripts/c#brcut3_short.baf~ ~c#brandock/install/c#brcut3.baf~
COMPILE EVALUATE_BUFFER ~c#brandock/install/c#brcut3.baf~

/* Make Cutscene in Thalantyr's Abode Skippable. We need to patch this one, too. */
ACTION_IF GAME_IS ~bgee eet~ THEN BEGIN

COPY_EXISTING ~c#brcut3.BCS~ ~override~
	DECOMPILE_AND_PATCH BEGIN
		SPRINT textToReplace ~\(MultiPlayerSync()\)~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~\1 
		SetAreaScript("c#brskp1",OVERRIDE)
		SetGlobal("C#BR_CUTSCENE_BREAKABLE","GLOBAL",1) 				SetCutSceneBreakable(TRUE)~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
		SPRINT textToReplace ~\(SmallWait(10)\)~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~\1 
		SetCutSceneBreakable(FALSE)
		SetGlobal("C#BR_CUTSCENE_BREAKABLE","GLOBAL",0)
		SetAreaScript("",OVERRIDE)~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
	END
BUT_ONLY
END


